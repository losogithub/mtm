<div ng-controller="TopicCtrl" style="height: 100%;"
     ng-init="topic = <%= JSON.stringify(locals.topic) %>;init();">
  <div class="Band text-inverse" ng-class="{'background-danger': fail, 'background-warning': isXHR()}">
    <div class="Band_Btn text-right prs">
      <% if (!topic.publishDate) { %>
      <button name="publish" class="btn btn-xs btn-primary"
              ng-click="publishTopic()" ng-disabled="publishingTopic"
              type="button">发布 <i class='fa fa-spinner fa-spin' ng-show="publishingTopic"></i>
      </button>
      <% } %>
      <a name="done"
         class='btn btn-xs btn-default'
         href="<%= topic.publishDate ? '/topic/' + topic._id : '/works' %>">
        返回
      </a>
    </div>
    <div class="Band_Ttl">
      <h1 style="width: 653px; margin: 0 auto;">
        <b>策展中<%= topic.publishDate ? '' : '（草稿）' %></b>
        <span ng-show="isDirty()">*</span>
        <span ng-show="isXHR()">- 正在通信，请稍候 <i class='fa fa-spinner fa-spin'></i></span>
        <span ng-show="fail">- 操作失败，请刷新页面 <i class="fa fa-exclamation-circle"></i></span>
        <small ng-show="!isDirty() && !isXHR() && !fail">- 已自动保存 <i class="fa fa-check"></i></small>
      </h1>
    </div>
  </div>

  <!--内容-->
  <div class="EditArea background-clouds">
    <div class="Main background-white" style="border-radius: 6px;">
      <div style="position: relative; border-radius: 6px 6px 0 0;"
           ng-show="!coverEditing">
        <div class="Cover" style="border-radius: 6px 6px 0 0; min-height: 280px; cursor: pointer;"
             ng-click="editCover()">
          <img onerror="shizier.errorImage(this, 'default_120x120', true);"
               ng-src="{{topic.cover_url}}" ng-show="topic.cover_url"
               style="border-radius: 6px 6px 0 0; width: 100%;">
        </div>
        <h1 class="h5 HeadTtl mbn pal hidden-xs text-inverse"
            style="{{titleEditing ? 'display: none !important;' : ''}}position: absolute; bottom: 0; left: 0; right: 0; background-color: rgba(0, 0, 0, 0.6);">
          {{topic.title}}
        </h1>
      </div>
      <div ng-if="coverEditing"
           ng-init="init()" ng-controller="CoverCtrl">
        <div class="Cover" style="border-radius: 6px 6px 0 0; cursor: pointer;"
             ng-click="cancelEdit()">
          <img onerror="shizier.errorImage(this, 'default_120x120', true);"
               ng-src="{{searchedCoverUrl}}" ng-show="searchedCoverUrl"
               style="border-radius: 6px 6px 0 0; width: 100%;">
        </div>
        <form name="form" class="pal background-clouds-darken"
              ng-style="!searchedCoverUrl && {'border-radius':'6px 6px 0 0'}">
          <button type="button" class="btn btn-link" style="display: block; margin: 0 auto 20px;"
                  ng-click="showSearchImage()">
            <i class="fa fa-search"></i> 搜索图片
          </button>
          <div class="form-group">
            <input name="url" class="form-control flat AUTO_FOCUS"
                   ng-model="$parent.$parent.cover_url"
                   placeholder="策展封面URL" id="_top_url" type="text">
            <label class="input-icon fa fa-link" for="_top_url"></label>
          </div>
          <div class="text-right">
            <button name="save" class="btn btn-primary"
                    ng-disabled="xhr"
                    type="submit">保存 <i class='fa fa-spinner fa-spin' ng-show="xhr"></i>
            </button>
            <button name="reset" class="btn btn-default"
                    ng-click="cancelEdit()"
                    type="button">取消</button>
          </div>
        </form>
      </div>
      <div class="phl pbm" ng-show="!titleEditing" style="position: relative;">
        <h1 class="h5 mtl HeadTtl visible-xs">{{topic.title}}</h1>

        <p class="HeadDesc mtm mbn">{{topic.description || ''}}</p>
        <div class="clearfix">
          <div class="pull-right">
            <button name="edit" class="btn btn-link text-muted mrs" type="button"
                    ng-click="editTitle()"
                    style="vertical-align: baseline;padding: 0;font-size: 18px;"
                    title="编辑封面、标题、简介"><i
              class="fa fa-pencil"></i></button>

            <% include _deleteBtn.html %>

          </div>

        </div>
        <div class="AddUtil">

          <% include _menu.html %>

        </div>
      </div>
      <form name="form" class="phl background-clouds-darken"
            ng-if="titleEditing" ng-init="init()"
            ng-controller="TopicTitleCtrl">
        <div class="pvl">
          <div class="form-group"
               ng-init="titleLimit = 50;"
               ng-class="{ 'has-error' : title.length > titleLimit }">
            <div class="Required"></div>
            <input name="title" type="text" class="form-control flat AUTO_FOCUS"
                   ng-model="title"
                   ng-init="title = topic.title;"
                   placeholder="策展标题（5~50字）"/>
            <div class="LetterCounter">{{title.length || 0}}/{{titleLimit}}</div>
          </div>
          <div class="form-group"
               ng-init="descriptionLimit = 140;"
               ng-class="{ 'has-error' : description.length > descriptionLimit }">
            <textarea msd-elastic name="description" class="form-control flat"
                      ng-model="description"
                      ng-init="description = topic.description;"
                      placeholder="策展描述（140字以内，换行符无效）"></textarea>
            <div class="LetterCounter">{{description.length || 0}}/{{descriptionLimit}}</div>
          </div>

          <div class="text-right">
            <button name="save" class="btn btn-primary"
                    type="submit">保存</button>
            <button name="reset" class="btn btn-default"
                    ng-click="cancelEdit()"
                    type="button">取消</button>
          </div>

        </div>
      </form>

      <ul class="WidgetItemList WidgetItemList-Main" ui-sortable="sortableOptions"
          ng-model="items"
          ng-init="items = <%= JSON.stringify(locals.items) %>">
        <li ng-repeat="item in items">
          <div class="AddUtil">

            <% include _menu.html %>

          </div>
          <div class="Hoverable">

            <div class="Item pal"
                 ng-switch="item.type" ng-if="editingId != item._id">

              <h2 class="Content TITLE h6"
                  ng-switch-when="TITLE">
                {{item.title}}
              </h2>
              <div class="Content TEXT"
                   ng-switch-when="TEXT" ng-bind-html="getHtml(item.text)">
              </div>
              <div class="Content IMAGE pam"
                   ng-switch-when="IMAGE">
                <div class="Image text-center">
                  <a target="_blank" class="fancybox" rel="gallery" href="{{item.url}}"
                     title="{{(item.title || '') + (item.title && item.description ? ' -- ' : '') + (item.description || '')}}">
                    <img onerror="shizier.errorImage(this,'default_120x120');"
                         ng-src="{{item.url}}" alt="{{item.title || ''}}">
                  </a>
                </div>

                <div class="Title text-center mts">{{item.title || ''}}</div>
                <div class="Description text-asbestos text-center small mtx"
                     ng-bind-html="getHtml(item.description)"></div>
                <div class="Quote" ng-if="item.quote">
                  出自 <i class="fa fa-globe"></i>
                  <a target="_blank" href="{{item.quote}}">
                    {{item.quoteDomain || ''}}
                  </a>
                </div>
              </div>
              <div class="Content CITE"
                   ng-switch-when="CITE">
                <div class="Cite">
                  <i class="fa fa-quote-left text-muted"></i>
                  <q ng-bind-html="getHtml(item.cite)"></q>
                </div>

                <div class="Quote" ng-if="item.url">
                  出自 <i class="fa fa-globe"></i>
                  <a target="_blank" href="{{item.url}}">{{item.title || item.url}}</a>
                </div>
                <div class="Description text-asbestos small mtx"
                     ng-if="item.description" ng-bind-html="getHtml(item.description)"></div>
              </div>
              <div class="Content LINK pam"
                   ng-switch-when="LINK">
                <div class="Title" title="{{item.snippet || ''}}">
                  <img class="Fav" ng-src="{{item.fav}}"
                       ui-event="{ error : 'onFavError(item)' }">
                  <a target="_blank" class="LINK_URL" href='{{item.url}}'>{{item.title || ''}}</a>
                </div>
                <div class="Quote">
                  <i class="fa fa-globe"></i>
                  <a target="_blank" class="LINK_URL" href="{{item.url}}">
                    {{item.url}}
                  </a>
                </div>
                <div class="Description text-asbestos mts small"
                     ng-if="item.description" ng-bind-html="getHtml(item.description)"></div>
                <div class="clearfix"></div>
              </div>
              <div class="Content VIDEO pam"
                   ng-switch-when="VIDEO">

                <button class="Cover btn btn-link" type="button"
                        ng-if="!item.playing" ng-click="playVideo(item)"
                        ng-style="item.cover && {'background-image':'url({{item.cover}})'}">
                  <div class="Background">
                    <i class="fa fa-play-circle"></i>
                  </div>
                </button>
                <div class="Player" ng-if="item.playing" ng-show="item.show">
                  <button name="close" class="btn btn-link mbx pan"
                          ng-click="item.playing = false;item.show = false;"
                          type="button"><i class="fa fa-caret-up"></i> 收起</button>
                  <!--src为空会导致ie一直等待，localhost响应最快-->
                  <embed style="display: block;"
                         src="about:blank"
                         ng-src="{{getVideoSrc(item)}}"
                         flashvars="{{getVideoVars(item)}}"
                         width="{{item.width}}"
                         height="{{item.height}}"
                         type="application/x-shockwave-flash"
                         allowscriptaccess="always"
                         allowfullscreen="true"
                         wmode="opaque"
                         quality="high"></embed>
                </div>

                <div class="Quote">
                  <i class="fa fa-globe"></i>
                  <a target="_blank" class="VIDEO_URL" href="{{item.url}}">
                    {{ item.quote || item.url }}
                  </a>
                </div>
                <div class="Title mtx" ng-if="item.title">
                  <a target="_blank" class="VIDEO_URL" href="{{item.url}}">
                    {{item.title || ''}}
                  </a>
                </div>
                <div class="Description text-asbestos small mtx"
                     ng-if="item.description" ng-bind-html="getHtml(item.description)"></div>
              </div>
              <div class="Content WEIBO pam"
                   ng-switch-when="WEIBO">

                <div class="clearfix">
                  <a target="_blank"  class="Avatar AuthorUrl img-circle"
                     href="http://weibo.com/{{item.user.profile_url}}">
                    <img class="img-circle"
                         ng-src="{{item.user.profile_image_url}}"
                         alt="{{item.user.screen_name}}">
                  </a>

                  <div style="overflow: hidden;">
                    <a target="_blank" class="ScreenName AuthorUrl"
                       href="http://weibo.com/{{item.user.profile_url}}">
                      <span class="ScreenName">{{item.user.screen_name}}</span>
                    </a>
                    <a target="_blank" class="Verify"
                       ng-class="!item.user.verified ? '' : item.user.verified_type ? 'ORG' : 'PERSONAL'"
                       href="http://verified.weibo.com/verify"><b>V</b></a>
                  </div>
                </div>

                <div class="Text" ng-bind-html="getWeiboHtml(item.parsed_text)"></div>
                <div class="Pic clearfix" ng-if="item.pic_urls && item.pic_urls.length"
                     style="{{item.pic_urls && item.pic_urls.length == 4 ? 'width: 170px;' : ''}}">
                  <a target="_blank" class="WeiboImage fancybox" rel="gallery"
                     ng-if="item.pic_urls.length == 1 && item.pic_urls[0]"
                     href="{{item.pic_urls[0].thumbnail_pic.replace('/thumbnail/', '/large/')}}"><img
                    ng-src="{{item.pic_urls[0].thumbnail_pic}}"></a>
                  <a target="_blank" class="WeiboImage fancybox" rel="gallery"
                     ng-if="item.pic_urls.length > 1 && pic"
                     ng-repeat="pic in item.pic_urls"
                     href="{{pic.thumbnail_pic.replace('/thumbnail/', '/large/')}}"><img
                    ng-src="{{pic.thumbnail_pic.replace('/thumbnail/', '/square/')}}"></a>
                </div>
                <div class="Retweeted clearfix" ng-init="reItem = item.retweeted_status;"
                     ng-if="item.retweeted_status && item.retweeted_status.idstr">
                  <a target="_blank" class="Author AuthorUrl"
                     href="http://weibo.com/{{reItem.user.profile_url}}">
                    @<span class="ScreenName">{{reItem.user.screen_name}}</span>
                  </a>
                  <a target="_blank" class="Verify"
                     ng-class="!reItem.user.verified ? '' : reItem.user.verified_type ? 'ORG' : 'PERSONAL'"
                     href="http://verified.weibo.com/verify"><b>V</b></a>
                  <div class="Text" ng-bind-html="getWeiboHtml(reItem.parsed_text)"></div>
                  <div class="Pic clearfix" ng-if="reItem.pic_urls && reItem.pic_urls.length"
                       style="{{reItem.pic_urls && reItem.pic_urls.length == 4 ? 'width: 170px;' : ''}}">
                    <a target="_blank" class="WeiboImage fancybox" rel="gallery"
                       ng-if="reItem.pic_urls.length == 1 && reItem.pic_urls[0]"
                       href="{{reItem.pic_urls[0].thumbnail_pic.replace('/thumbnail/', '/large/')}}"><img
                      ng-src="{{reItem.pic_urls[0].thumbnail_pic}}"></a>
                    <a target="_blank" class="WeiboImage fancybox" rel="gallery"
                       ng-if="reItem.pic_urls.length > 1 && pic"
                       ng-repeat="pic in reItem.pic_urls"
                       href="{{pic.thumbnail_pic.replace('/thumbnail/', '/large/')}}"><img
                      ng-src="{{pic.thumbnail_pic.replace('/thumbnail/', '/square/')}}"></a>
                  </div>
                  <a target="_blank" class="Time text-muted pull-left"
                     href="http://weibo.com/{{reItem.user.idstr}}/{{reItem.mid62}}"
                    >{{reItem.time}}</a>
                  <div class="Handle">
                    <a target="_blank" class="Forward text-muted mrs"
                       href="http://weibo.com/{{reItem.user.idstr}}/{{reItem.mid62}}?type=repost"
                      ><i class="fa fa-share"></i> 转发</a>
                    <a target="_blank" class="Comment text-muted"
                       href="http://weibo.com/{{reItem.user.idstr}}/{{reItem.mid62}}"
                      ><i class="fa fa-comment-o"></i> 评论</a>
                  </div>
                  <div class="clearfix"></div>
                </div>
                <a target="_blank" class="Time text-muted pull-left"
                   href="http://weibo.com/{{item.user.idstr}}/{{item.mid62}}">{{item.time}}</a>
                <div class="Handle">
                  <a target="_blank" class="Forward text-muted mrs"
                     href="http://weibo.com/{{item.user.idstr}}/{{item.mid62}}?type=repost"
                    ><i class="fa fa-share"></i> 转发</a>
                  <a target="_blank" class="Comment text-muted"
                     href="http://weibo.com/{{item.user.idstr}}/{{item.mid62}}"
                    ><i class="fa fa-comment-o"></i> 评论</a>
                </div>
                <div class="clearfix"></div>
                <div class="Description text-asbestos small mtx"
                     ng-if="item.description" ng-bind-html="getHtml(item.description)"></div>
              </div>

              <button class="COLLECT btn btn-default btn-xs"
                      ng-click="collectItem(item)"
                      title="采集素材"
                      type="button">采集</button>
              <div class="EditUtil pull-right pas plm">
                <button class="EDIT btn btn-link mrx" type="button" title="修改石子儿"
                        ng-click="editItem(item._id)"><i class="fa fa-pencil"></i> 修改</button>
                <button class="DELETE btn btn-link" type="button" title="删除石子儿"
                        ng-click="deleteItem(item)"><i class="fa fa-trash-o"></i></button>
              </div>
            </div>

            <form class="Widget pal" name="form"
                  ng-switch="item.type" ng-if="editingId == item._id">

              <div class="Content TITLE"
                   ng-switch-when="TITLE" ng-controller="TitleCtrl" ng-init="init()">
                <div class="form-group"
                     ng-class="{ 'has-error' : title.length > titleMaxLength }">
                  <div class="Required"></div>
                  <input name="title" class="form-control flat AUTO_FOCUS"
                         ng-model="title" ng-init="title = item.title" ng-focus="true"
                         placeholder="标题" type="text">
                  <div class="LetterCounter">{{title.length || 0}}/{{titleMaxLength}}</div>
                </div>

                <% include _widget_BtnSet.html %>

              </div>

              <div class="Content TEXT"
                   ng-switch-when="TEXT" ng-controller="TextCtrl" ng-init="init()">
                <div class="form-group"
                     ng-class="{ 'has-error' : text.length > textMaxLength }">
                  <div class="Required"></div>
                  <textarea msd-elastic name="text" class="form-control flat AUTO_FOCUS"
                            ng-model="text" ng-init="text = item.text"
                            placeholder="文本"></textarea>
                  <div class="LetterCounter">{{text.length || 0}}/{{textMaxLength}}</div>
                </div>

                <% include _widget_BtnSet.html %>

              </div>

              <div class="Content IMAGE pam"
                   ng-switch-when="IMAGE" ng-controller="ImageCtrl" ng-init="init()">
                <div class="Image text-center">
                  <a target="_blank" class="fancybox" rel="gallery" href="{{item.url}}"
                     title="{{(item.title || '') + (item.title && item.description ? ' -- ' : '') + (item.description || '')}}">
                    <img onerror="shizier.errorImage(this,'default_120x120');"
                         ng-src="{{item.url}}" alt="{{item.title || ''}}">
                  </a>
                </div>
                <div class="Quote" ng-if="item.quote">
                  出自 <i class="fa fa-globe"></i>
                  <a target="_blank" href="{{item.quote}}">
                    {{item.quoteDomain || ''}}
                  </a>
                </div>
                <div class="mtx"></div>

                <div class="form-group"
                     ng-class="{ 'has-error' : title.length > titleMaxLength }">
                  <input name="title" class="form-control flat text-center AUTO_FOCUS"
                         ng-model="title" ng-init="title = item.title"
                         placeholder="图片标题" type="text">
                  <div class="LetterCounter">{{title.length || 0}}/{{titleMaxLength}}</div>
                </div>
                <div class="form-group"
                     ng-class="{ 'has-error' : description.length > descriptionMaxLength }">
                  <textarea msd-elastic name="description" class="form-control flat text-center"
                            ng-model="description" ng-init="description = item.description"
                            placeholder="图片介绍、评论"></textarea>
                  <div class="LetterCounter">{{description.length || 0}}/{{descriptionMaxLength}}</div>
                </div>

                <% include _widget_BtnSet.html %>

              </div>

              <div class="Content CITE"
                   ng-switch-when="CITE" ng-controller="CiteCtrl" ng-init="init()">
                <div class="Cite">
                  <i class="fa fa-quote-left text-muted"></i>
                  <q ng-bind-html="getHtml(item.cite)"></q>
                </div>
                <div class="Quote" ng-if="item.url">
                  出自 <i class="fa fa-globe"></i>
                  <a target="_blank" href="{{item.url}}">{{item.title || item.url}}</a>
                </div>
                <div class="form-group mtx"
                     ng-class="{ 'has-error' : description.length > descriptionMaxLength }">
                  <textarea msd-elastic class="form-control flat AUTO_FOCUS" name="description"
                            ng-model="description" ng-init="description = item.description"
                            placeholder="引文介绍、评论"></textarea>
                  <div class="LetterCounter">{{description.length || 0}}/{{descriptionMaxLength}}</div>
                </div>

                <% include _widget_BtnSet.html %>

              </div>

              <div class="Content LINK_CREATE pam"
                   ng-switch-when="LINK_CREATE" ng-controller="LinkCreateCtrl" ng-init="init()">
                <div class="InfoHint text-muted">
                  <span class="text-default" style="font-size: 14px;"><i class="fa fa-play-circle"></i> 视频</span>：目前已支持<b>优酷</b>、<b>土豆</b>、<b>爱奇艺</b>、<b>PPS</b>、<b>搜狐视频</b>、<b>腾讯视频</b>、
                  <b>新浪视频</b>、<b>凤凰视频</b>、<b>乐视</b>、<b>PPTV</b>、<b>酷6</b>、<b>56</b>、<b>爆米花</b>、
                  <b>音悦台</b>、<b>AcFun</b>、<b>bilibili</b>等视频网站的视频播放页链接。
                </div>
                <div class="InfoHint text-muted">
                  <span class="text-default" style="font-size: 14px;"><i class="fa fa-weibo"></i> 微博</span>：由于受隐私设置保护，有些微博将无法引用
                </div>
                <div class="InfoHint text-muted">
                  <span class="text-default" style="font-size: 14px;"><i class="fa fa-globe"></i> 网页</span>
                </div>
                <div class="form-group">
                  <div class="Required"></div>
                  <input name="url" class="form-control flat AUTO_FOCUS"
                         ng-model="url"
                         placeholder="视频、微博或网页URL" id="_link_url" type="text">
                  <label class="input-icon fa fa-link" for="_link_url"></label>
                </div>

                <% include _widget_BtnSet.html %>

              </div>

              <div class="Content LINK pam"
                   ng-switch-when="LINK" ng-controller="LinkCtrl" ng-init="init()">
                <div class="Title" title="{{item.snippet || ''}}">
                  <img class="Fav" ng-src="{{item.fav}}"
                       ui-event="{ error : 'onFavError(item)' }">
                  <a target="_blank" class="LINK_URL" href='{{item.url}}'>{{item.title || ''}}</a>
                </div>
                <div class="Quote">
                  <i class="fa fa-globe"></i>
                  <a target="_blank" class="LINK_URL" href="{{item.url}}">
                    {{item.url}}
                  </a>
                </div>

                <div class="form-group mtx"
                     ng-class="{ 'has-error' : description.length > descriptionMaxLength }">
                  <textarea msd-elastic name="description" class="form-control flat AUTO_FOCUS"
                            ng-model="description" ng-init="description = item.description"
                            placeholder="链接评论"></textarea>
                  <div class="LetterCounter">{{description.length || 0}}/{{descriptionMaxLength}}</div>
                </div>

                <% include _widget_BtnSet.html %>

              </div>

              <div class="Content VIDEO pam"
                   ng-switch-when="VIDEO" ng-controller="VideoCtrl" ng-init="init()">

                <button class="Cover btn btn-link" type="button"
                        ng-if="!item.playing" ng-click="playVideo(item)"
                        ng-style="{'background-image':'url({{item.cover}})'}">
                  <div class="Background">
                    <i class="fa fa-play-circle"></i>
                  </div>
                </button>
                <div class="Player" ng-if="item.playing" ng-show="item.show">
                  <button name="close" class="btn btn-link mbx pan"
                          ng-click="item.playing = false;item.show = false;"
                          type="button"><i class="fa fa-caret-up"></i> 收起</button>
                  <!--src为空会导致ie一直等待，localhost响应最快-->
                  <embed style="display: block;"
                         src="about:blank"
                         ng-src="{{getVideoSrc(item)}}"
                         flashvars="{{getVideoVars(item)}}"
                         width="{{item.width}}"
                         height="{{item.height}}"
                         type="application/x-shockwave-flash"
                         allowscriptaccess="always"
                         allowfullscreen="true"
                         wmode="opaque"
                         quality="high"></embed>
                </div>

                <div class="Quote">
                  <i class="fa fa-globe"></i>
                  <a target="_blank" class="VIDEO_URL" href="{{item.url}}">
                    {{ item.quote || item.url }}
                  </a>
                </div>

                <div class="Title mtx" ng-if="item.title">
                  <a target="_blank" class="VIDEO_URL" href="{{item.url}}">
                    {{item.title || ''}}
                  </a>
                </div>
                <div class="form-group mtx"
                     ng-class="{ 'has-error' : description.length > descriptionMaxLength }">
                  <textarea msd-elastic class="form-control flat AUTO_FOCUS" name="description"
                            ng-model="description" ng-init="description = item.description"
                            placeholder="视频介绍、评论"></textarea>
                  <div class="LetterCounter">{{description.length || 0}}/{{descriptionMaxLength}}</div>
                </div>

                <% include _widget_BtnSet.html %>

              </div>

              <div class="Content WEIBO pam"
                   ng-switch-when="WEIBO" ng-controller="WeiboCtrl" ng-init="init()">

                <div class="clearfix">
                  <a target="_blank"  class="Avatar AuthorUrl img-circle"
                     href="http://weibo.com/{{item.user.profile_url}}">
                    <img class="img-circle"
                         ng-src="{{item.user.profile_image_url}}"
                         alt="{{item.user.screen_name}}">
                  </a>

                  <div style="overflow: hidden;">
                    <a target="_blank" class="ScreenName AuthorUrl"
                       href="http://weibo.com/{{item.user.profile_url}}">
                      <span class="ScreenName">{{item.user.screen_name}}</span>
                    </a>
                    <a target="_blank" class="Verify"
                       ng-class="!item.user.verified ? '' : item.user.verified_type ? 'ORG' : 'PERSONAL'"
                       href="http://verified.weibo.com/verify"><b>V</b></a>
                  </div>
                </div>

                <div class="Text" ng-bind-html="getWeiboHtml(item.parsed_text)"></div>
                <div class="Pic clearfix" ng-if="item.pic_urls && item.pic_urls.length"
                     style="{{item.pic_urls && item.pic_urls.length == 4 ? 'width: 170px;' : ''}}">
                  <a target="_blank" class="WeiboImage fancybox" rel="gallery"
                     ng-if="item.pic_urls.length == 1 && item.pic_urls[0]"
                     href="{{item.pic_urls[0].thumbnail_pic.replace('/thumbnail/', '/large/')}}"><img
                    ng-src="{{item.pic_urls[0].thumbnail_pic}}"></a>
                  <a target="_blank" class="WeiboImage fancybox" rel="gallery"
                     ng-if="item.pic_urls.length > 1 && pic"
                     ng-repeat="pic in item.pic_urls"
                     href="{{pic.thumbnail_pic.replace('/thumbnail/', '/large/')}}"><img
                    ng-src="{{pic.thumbnail_pic.replace('/thumbnail/', '/square/')}}"></a>
                </div>
                <div class="Retweeted clearfix" ng-init="reItem = item.retweeted_status;"
                     ng-if="item.retweeted_status && item.retweeted_status.idstr">
                  <a target="_blank" class="Author AuthorUrl"
                     href="http://weibo.com/{{reItem.user.profile_url}}">
                    @<span class="ScreenName">{{reItem.user.screen_name}}</span>
                  </a>
                  <a target="_blank" class="Verify"
                     ng-class="!reItem.user.verified ? '' : reItem.user.verified_type ? 'ORG' : 'PERSONAL'"
                     href="http://verified.weibo.com/verify"><b>V</b></a>
                  <div class="Text" ng-bind-html="getWeiboHtml(reItem.parsed_text)"></div>
                  <div class="Pic clearfix" ng-if="reItem.pic_urls && reItem.pic_urls.length"
                       style="{{reItem.pic_urls && reItem.pic_urls.length == 4 ? 'width: 170px;' : ''}}">
                    <a target="_blank" class="WeiboImage fancybox" rel="gallery"
                       ng-if="reItem.pic_urls.length == 1 && reItem.pic_urls[0]"
                       href="{{reItem.pic_urls[0].thumbnail_pic.replace('/thumbnail/', '/large/')}}"><img
                      ng-src="{{reItem.pic_urls[0].thumbnail_pic}}"></a>
                    <a target="_blank" class="WeiboImage fancybox" rel="gallery"
                       ng-if="reItem.pic_urls.length > 1 && pic"
                       ng-repeat="pic in reItem.pic_urls"
                       href="{{pic.thumbnail_pic.replace('/thumbnail/', '/large/')}}"><img
                      ng-src="{{pic.thumbnail_pic.replace('/thumbnail/', '/square/')}}"></a>
                  </div>
                  <a target="_blank" class="Time text-muted pull-left"
                     href="http://weibo.com/{{reItem.user.idstr}}/{{reItem.mid62}}"
                    >{{reItem.time}}</a>
                  <div class="Handle">
                    <a target="_blank" class="Forward text-muted mrs"
                       href="http://weibo.com/{{reItem.user.idstr}}/{{reItem.mid62}}?type=repost"
                      ><i class="fa fa-share"></i> 转发</a>
                    <a target="_blank" class="Comment text-muted"
                       href="http://weibo.com/{{reItem.user.idstr}}/{{reItem.mid62}}"
                      ><i class="fa fa-comment-o"></i> 评论</a>
                  </div>
                  <div class="clearfix"></div>
                </div>
                <a target="_blank" class="Time text-muted pull-left"
                   href="http://weibo.com/{{item.user.idstr}}/{{item.mid62}}">{{item.time}}</a>
                <div class="Handle">
                  <a target="_blank" class="Forward text-muted mrs"
                     href="http://weibo.com/{{item.user.idstr}}/{{item.mid62}}?type=repost"
                    ><i class="fa fa-share"></i> 转发</a>
                  <a target="_blank" class="Comment text-muted"
                     href="http://weibo.com/{{item.user.idstr}}/{{item.mid62}}"
                    ><i class="fa fa-comment-o"></i> 评论</a>
                </div>
                <div class="clearfix"></div>

                <div class="form-group"
                     ng-class="{ 'has-error' : description.length > descriptionMaxLength }">
                  <textarea msd-elastic name="description" class="form-control flat AUTO_FOCUS"
                            ng-model="description" ng-init="description = item.description"
                            placeholder="微博介绍、评论"></textarea>
                  <div class="LetterCounter">{{description.length || 0}}/{{descriptionMaxLength}}</div>
                </div>

                <% include _widget_BtnSet.html %>

              </div>

            </form>

            <div class="SortUtil text-inverse background-muted">
              <span class="MoveUtil" title="移动"></span>

              <div>
                <!--<i class="fa fa-angle-double-up"-->
                   <!--ng-click="sortItemTop($index)"-->
                   <!--title="移到顶部"></i>-->
                <i class="fa fa-angle-up"
                   ng-click="sortItemUp($index)"
                   title="上移一行"></i>
              </div>
              <div>
                <i class="fa fa-angle-down"
                   ng-click="sortItemDown($index)"
                   title="下移一行"></i>
                <!--<i class="fa fa-angle-double-down"-->
                   <!--ng-click="sortItemBottom($index)"-->
                   <!--title="移到底部"></i>-->
              </div>
            </div>

          </div>
        </li>
      </ul>
    </div>

    <div id="_scrollUtil2" class="btn-group-vertical">
      <button class="ToTop btn btn-link" title="返回顶部">
        <i class="fa fa-angle-up"></i>
      </button>
      <button class="ToBottom btn btn-link" title="滚到底部">
        <i class="fa fa-angle-down"></i>
      </button>
    </div>

  </div>

  <div class="Collection"
       ng-controller="CollectionCtrl"
       ng-init="init(<%= JSON.stringify(locals.collectionItems) %>);">
    <div class="Categories btn-group btn-group-sm background-muted">
      <button class="btn btn-default" type="button"
              ng-click="setType('ALL')"
              ng-class="{active: type == 'ALL'}">
        采集的石子儿
        <span class="Counter">({{items.length}})</span>
      </button>
      <button class="btn btn-default" type="button"
              ng-click="setType('BOOKMARKLET')"
              ng-class="{active: type == 'BOOKMARKLET'}"><i class="fa fa-magic"></i></button>
    </div>
    <div class="Scrollable background-white" ng-show="type == 'BOOKMARKLET'">
      <div class="pal text-center text-muted" style="font-size: 14px;">
        我是石子儿采集助手<br>
        为方便您在浏览任意网页时<br>
        都能“一键”采集石子儿<br>
        您只需要：<br>
        1.将我
        <a href="javascript:(function () {var _my_script = document.createElement('SCRIPT');_my_script.type = 'text/javascript';
                              _my_script.src = 'http://shizier.com/javascripts/bookmarklet.js';document.getElementsByTagName('head')[0].appendChild(_my_script);}());"
           style="cursor: move;"
           class="mvm btn btn-sm btn-primary">★采集石子儿</a>
        <i class="fa fa-level-up"></i> 拖放到书签栏<br>
        2.在任意网页点击我<br>
        就能“一键”采集：<br>
        <i class="fa fa-picture-o"></i> 图片、
        <i class="fa fa-play-circle"></i> 视频、
        <i class="fa fa-quote-left"></i> 引文、
        <i class="fa fa-weibo"></i> 微博、
        <i class="fa fa-globe"></i> 网页
      </div>
    </div>
    <div class="CollectionItems Scrollable background-white" ng-show="type != 'BOOKMARKLET'">
      <div ng-model="items">
        <ul class="WidgetItemList WidgetItemList-Sub"
            ng-controller="SortableCtrl"
            ng-model="item2" ui-sortable="sortableOptions"
            ng-repeat="item in items">
          <li class="Hoverable">

            <div class="Item pal"
                 ng-switch="item.type" ng-if="editingId != item._id">

              <h2 class="Content TITLE h6"
                  ng-switch-when="TITLE">
                {{item.title}}
              </h2>
              <div class="Content TEXT"
                   ng-switch-when="TEXT" ng-bind-html="getHtml(item.text)">
              </div>
              <div class="Content IMAGE pam"
                   ng-switch-when="IMAGE">
                <div class="Image text-center">
                  <a target="_blank" class="fancybox" rel="gallery" href="{{item.url}}"
                     title="{{(item.title || '') + (item.title && item.description ? ' -- ' : '') + (item.description || '')}}">
                    <img onerror="shizier.errorImage(this,'default_120x120');"
                         ng-src="{{item.url}}" alt="{{item.title || ''}}">
                  </a>
                </div>

                <div class="Title text-center mts">{{item.title || ''}}</div>
                <div class="Description text-asbestos text-center small mtx"
                     ng-bind-html="getHtml(item.description)"></div>
                <div class="Quote" ng-if="item.quote">
                  出自 <i class="fa fa-globe"></i>
                  <a target="_blank" href="{{item.quote}}">
                    {{item.quoteDomain || ''}}
                  </a>
                </div>
              </div>
              <div class="Content CITE"
                   ng-switch-when="CITE">
                <div class="Cite">
                  <i class="fa fa-quote-left text-muted"></i>
                  <q ng-bind-html="getHtml(item.cite)"></q>
                </div>

                <div class="Quote" ng-if="item.url">
                  出自 <i class="fa fa-globe"></i>
                  <a target="_blank" href="{{item.url}}">{{item.title || item.url}}</a>
                </div>
                <div class="Description text-asbestos small mtx"
                     ng-if="item.description" ng-bind-html="getHtml(item.description)"></div>
              </div>
              <div class="Content LINK pam"
                   ng-switch-when="LINK">
                <div class="Title" title="{{item.snippet || ''}}">
                  <img class="Fav" ng-src="{{item.fav}}"
                       ui-event="{ error : 'onFavError(item)' }">
                  <a target="_blank" class="LINK_URL" href='{{item.url}}'>{{item.title || ''}}</a>
                </div>
                <div class="Quote">
                  <i class="fa fa-globe"></i>
                  <a target="_blank" class="LINK_URL" href="{{item.url}}">
                    {{item.url}}
                  </a>
                </div>
                <div class="Description text-asbestos mts small"
                     ng-if="item.description" ng-bind-html="getHtml(item.description)"></div>
                <div class="clearfix"></div>
              </div>
              <div class="Content VIDEO pam"
                   ng-switch-when="VIDEO">

                <button class="Cover btn btn-link" type="button" ng-if="!item.playing"
                        ng-click="playVideo(item)"
                        ng-style="{'background-image':'url({{item.cover}})'}">
                  <div class="Background">
                    <i class="fa fa-play-circle"></i>
                  </div>
                </button>
                <div class="Player" ng-if="item.playing" ng-show="item.show">
                  <button name="close" class="btn btn-link mbx pan"
                          ng-click="item.playing = false;item.show = false;"
                          type="button"><i class="fa fa-caret-up"></i> 收起</button>
                  <!--src为空会导致ie一直等待，localhost响应最快-->
                  <embed style="display: block;"
                         src="about:blank"
                         ng-src="{{getVideoSrc(item)}}"
                         flashvars="{{getVideoVars(item)}}"
                         width="{{item.width}}"
                         height="{{item.height}}"
                         type="application/x-shockwave-flash"
                         allowscriptaccess="always"
                         allowfullscreen="true"
                         wmode="opaque"
                         quality="high"></embed>
                </div>

                <div class="Quote">
                  <i class="fa fa-globe"></i>
                  <a target="_blank" class="VIDEO_URL" href="{{item.url}}">
                    {{ item.quote || item.url }}
                  </a>
                </div>
                <div class="Title mtx" ng-if="item.title">
                  <a target="_blank" class="VIDEO_URL" href="{{item.url}}">
                    {{item.title || ''}}
                  </a>
                </div>
                <div class="Description text-asbestos small mtx"
                     ng-if="item.description" ng-bind-html="getHtml(item.description)"></div>
              </div>
              <div class="Content WEIBO pam"
                   ng-switch-when="WEIBO">

                <div class="clearfix">
                  <a target="_blank"  class="Avatar AuthorUrl img-circle"
                     href="http://weibo.com/{{item.user.profile_url}}">
                    <img class="img-circle"
                         ng-src="{{item.user.profile_image_url}}"
                         alt="{{item.user.screen_name}}">
                  </a>

                  <div style="overflow: hidden;">
                    <a target="_blank" class="ScreenName AuthorUrl"
                       href="http://weibo.com/{{item.user.profile_url}}">
                      <span class="ScreenName">{{item.user.screen_name}}</span>
                    </a>
                    <a target="_blank" class="Verify"
                       ng-class="!item.user.verified ? '' : item.user.verified_type ? 'ORG' : 'PERSONAL'"
                       href="http://verified.weibo.com/verify"><b>V</b></a>
                  </div>
                </div>

                <div class="Text" ng-bind-html="getWeiboHtml(item.parsed_text)"></div>
                <div class="Pic clearfix" ng-if="item.pic_urls && item.pic_urls.length"
                     style="{{item.pic_urls && item.pic_urls.length == 4 ? 'width: 170px;' : ''}}">
                  <a target="_blank" class="WeiboImage fancybox" rel="gallery"
                     ng-if="item.pic_urls.length == 1 && item.pic_urls[0]"
                     href="{{item.pic_urls[0].thumbnail_pic.replace('/thumbnail/', '/large/')}}"><img
                    ng-src="{{item.pic_urls[0].thumbnail_pic}}"></a>
                  <a target="_blank" class="WeiboImage fancybox" rel="gallery"
                     ng-if="item.pic_urls.length > 1 && pic"
                     ng-repeat="pic in item.pic_urls"
                     href="{{pic.thumbnail_pic.replace('/thumbnail/', '/large/')}}"><img
                    ng-src="{{pic.thumbnail_pic.replace('/thumbnail/', '/square/')}}"></a>
                </div>
                <div class="Retweeted clearfix" ng-init="reItem = item.retweeted_status;"
                     ng-if="item.retweeted_status && item.retweeted_status.idstr">
                  <a target="_blank" class="Author AuthorUrl"
                     href="http://weibo.com/{{reItem.user.profile_url}}">
                    @<span class="ScreenName">{{reItem.user.screen_name}}</span>
                  </a>
                  <a target="_blank" class="Verify"
                     ng-class="!reItem.user.verified ? '' : reItem.user.verified_type ? 'ORG' : 'PERSONAL'"
                     href="http://verified.weibo.com/verify"><b>V</b></a>
                  <div class="Text" ng-bind-html="getWeiboHtml(reItem.parsed_text)"></div>
                  <div class="Pic clearfix" ng-if="reItem.pic_urls && reItem.pic_urls.length"
                       style="{{reItem.pic_urls && reItem.pic_urls.length == 4 ? 'width: 170px;' : ''}}">
                    <a target="_blank" class="WeiboImage fancybox" rel="gallery"
                       ng-if="reItem.pic_urls.length == 1 && reItem.pic_urls[0]"
                       href="{{reItem.pic_urls[0].thumbnail_pic.replace('/thumbnail/', '/large/')}}"><img
                      ng-src="{{reItem.pic_urls[0].thumbnail_pic}}"></a>
                    <a target="_blank" class="WeiboImage fancybox" rel="gallery"
                       ng-if="reItem.pic_urls.length > 1 && pic"
                       ng-repeat="pic in reItem.pic_urls"
                       href="{{pic.thumbnail_pic.replace('/thumbnail/', '/large/')}}"><img
                      ng-src="{{pic.thumbnail_pic.replace('/thumbnail/', '/square/')}}"></a>
                  </div>
                  <a target="_blank" class="Time text-muted pull-left"
                     href="http://weibo.com/{{reItem.user.idstr}}/{{reItem.mid62}}"
                    >{{reItem.time}}</a>
                  <div class="Handle">
                    <a target="_blank" class="Forward text-muted mrs"
                       href="http://weibo.com/{{reItem.user.idstr}}/{{reItem.mid62}}?type=repost"
                      ><i class="fa fa-share"></i> 转发</a>
                    <a target="_blank" class="Comment text-muted"
                       href="http://weibo.com/{{reItem.user.idstr}}/{{reItem.mid62}}"
                      ><i class="fa fa-comment-o"></i> 评论</a>
                  </div>
                  <div class="clearfix"></div>
                </div>
                <a target="_blank" class="Time text-muted pull-left"
                   href="http://weibo.com/{{item.user.idstr}}/{{item.mid62}}">{{item.time}}</a>
                <div class="Handle">
                  <a target="_blank" class="Forward text-muted mrs"
                     href="http://weibo.com/{{item.user.idstr}}/{{item.mid62}}?type=repost"
                    ><i class="fa fa-share"></i> 转发</a>
                  <a target="_blank" class="Comment text-muted"
                     href="http://weibo.com/{{item.user.idstr}}/{{item.mid62}}"
                    ><i class="fa fa-comment-o"></i> 评论</a>
                </div>
                <div class="clearfix"></div>
                <div class="Description text-asbestos small mtx"
                     ng-if="item.description" ng-bind-html="getHtml(item.description)"></div>
              </div>

              <div class="EditUtil AppendUtil pas prm">
                <button class="APPEND btn btn-link" type="button" title="添加到末尾"
                        ng-click="appendItem(item)"><i class="fa fa-caret-left"></i> 到末尾</button>
              </div>
              <div class="EditUtil pas plm">
                <button class="DELETE btn btn-link" type="button" title="删除石子儿"
                        ng-click="deleteItem(item)"><i class="fa fa-trash-o"></i></button>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="LoginDialog modal fade" style="overflow: hidden;"
       ng-controller="SearchImageCtrl" id="_searchImage" tabindex="-1">
    <div class="modal-dialog container" ng-style="images.length && {height: '90%'}"
         ng-class="{ 'LoginDialog-Wide': images.length }">
      <div class="modal-content" style="height: 100%; overflow: hidden;">
        <form class="modal-header"
              ng-submit="submit()"
              style="border-radius: 6px 6px 0 0;">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <div class="form-group" style="max-width: 200px; margin: 0 auto;">
            <input class="form-control AutoFocus" id="_searchImageKeyword"
                   ng-model="searchImageKeyword"
                   placeholder="搜索图片" type="text">
            <label class="input-icon fa fa-search" for="_searchImageKeyword"></label>
          </div>
        </form>
        <div class="modal-body clearfix SelectImage"
             style="border-radius: 0 0 6px 6px; padding-right: 10px; padding-bottom: 100px; height: 100%; overflow: hidden;">
          <button class="btn mrm mbm"
                  ng-click="selectImage(image)"
                  ng-repeat="image in images" type="button">
            <img ng-src="{{image.url}}"
                 ng-controller="SearchedImageCtrl"
                 ui-event="{ error : 'onError(image)', load : 'onLoad(image)' }">
          </button>
        </div>
      </div>
    </div>
  </div>
</div>