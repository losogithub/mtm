<!--内容-->
<div style="background-color: #ecf0f1;">
  <div class="container">
    <% if (locals.isAdmin) { %>
    <div class="row ptl">
      <div class="col-xs-12">
        <div class="btn-group">
          <a class="btn btn-primary" href="/">综合</a>
          <a class="btn btn-primary <%- topic.category == '娱乐' ? 'active' : '' %>"
             href="/entertainment">娱乐</a>
          <a class="btn btn-primary <%- topic.category == '科技' ? 'active' : '' %>"
             href="/tech">科技</a>
          <a class="btn btn-primary <%- topic.category == '新闻' ? 'active' : '' %>"
             href="/news">新闻</a>
          <a class="btn btn-primary <%- topic.category == '时尚' ? 'active' : '' %>"
             href="/fashion">时尚</a>
          <a class="btn btn-primary <%- topic.category == '未分类' ? 'active' : '' %>"
             href="/unclassified">未分类</a>
          <a class="btn btn-primary"
             href="/new">最新</a>
        </div>
      </div>
    </div>
    <% } %>
    <div class="row pbl">
      <div class="col-sm-offset-1 col-sm-10 col-md-offset-0 col-md-8 col-lg-7 mtl">
        <% if (locals.isAdmin) { %>
        <div class="row">
          <div class="col-sm-3 mbl">
            <div class="Category dropdown" ng-controller="CategoryCtrl">
              <button class="btn btn-primary dropdown-toggle btn-block" data-toggle="dropdown"
                      type="button"><span class="Current">{{current}}</span><span class="caret"></span></button>
              <span class="dropdown-arrow dropdown-arrow-inverse"></span>
              <ul class="dropdown-menu dropdown-inverse">
                <li ng-repeat="item in items">
                  <a ng-class="{ highlighted: current == item }" href="##"
                    ng-click="saveCategory(item)">{{item}}</a>
                </li>

                <script>
                  function CategoryCtrl($scope, $timeout) {
                    $scope.current = '<%= topic.category %>';
                    $scope.items = [
                      '娱乐',
                      '科技',
                      '新闻',
                      '时尚',
                      '未分类'
                    ];
                    $scope.saveCategory = function (category) {
                      var xhr = $scope.xhr;
                      if (xhr) {
                        xhr.abort();
                      }
                      console.log(location);
                      $scope.xhr = $.ajax('/topic/category', {
                        type: 'PUT',
                        data: {
                          topicId: '<%= topic._id %>',
                          category: category
                        }
                      })
                        .done(function () {
                          $timeout(function() {
                            $scope.current = category;
                          });
                        });
                    };
                  }
                </script>
              </ul>
            </div>
          </div>
        </div>
        <% } %>
        <div style="background-color: white; border-radius: 6px;">
          <div style="position: relative; min-height: 140px; border-radius: 6px 6px 0 0;">
            <a class="fancybox" rel="gallery" href="<%= topic.coverUrl %>" title="<%= topic.title %>">
              <img onerror="$(this).hide();" src="<%= topic.coverUrl %>"
                   style="width: 100%; border-radius: 6px 6px 0 0; <%= topic.coverUrl ? '' : 'display: none;' %>">
            </a>
            <h5 class="mbn pal hidden-xs" style="position: absolute; bottom: 0; left: 0; right: 0; background-color: rgba(0, 0, 0, 0.6);">
              <a class="text-inverse" href="/topic/<%= topic._id %>"><%= topic.title %></a>
            </h5>
          </div>

          <div class="phl">
            <h5 class="visible-xs"><a href="/topic/<%= topic._id %>"><%= topic.title %></a></h5>

            <div class="clearfix mtm mbm">
              <div class="pull-left">
                <a href="/u/<%= topic.author %>" title="<%= topic.author %>">
                  <span class="mrs" style="display: inline-block; width: 30px; height: 30px;">
                    <img width="30" height="30" class="img-circle"
                       src="<%= authorInfo.imgUrl || '/images/no_img/user_80x80.png' %>"
                       onerror="shizier.errorImage(this,'user_80x80');">
                  </span><span><%= topic.author %></span>
                </a>
                <span class="text-muted small mls">
                  <i class="fa fa-edit"></i>
                  <%= topic.updateAt %>
                </span>
              </div>
              <div class="pull-right">
                <% if (locals.isAuthor) { %>
                <a class="mrs btn btn-primary"
                   style="padding: 0 5px; font-size: 18px; vertical-align: baseline;"
                   href="/topic/<%= topic._id %>/edit" title="编辑"><i class="fa fa-pencil"></i></a>
                <% include _deleteBtn.html %>
                <% } %>
                <a class="mls text-info mls" target="_blank"
                   href="/topic/<%= topic._id %>/share_chang" title="分享"><i
                  class="fa fa-share"></i></a>
                <button name="favorite" class="<%- locals.liked ? 'ExSelected' : '' %> btn btn-default mls"
                        style="padding: 0 5px;vertical-align: baseline;font-size: 18px;"
                        data-favorite='{"topicId":"<%= topic._id %>"}' title="喜欢">
                  <i class="fa fa-star StarIcon"></i> <span class="FVCount"><%= topic.FVCount %></span>
                </button>
                <span class="text-muted mls"><i class="fa fa-eye"></i> <%= topic.PVCount %></span>
              </div>
            </div>

            <p style="<%= !topic.description ? 'display: none;' : '' %>">
              <%= topic.description || '' %>
            </p>

            <% if (!locals.items || !items.length) { %>
            <div class="text-muted text-center" style="padding: 140px 0px;">
              <i class="fa fa-file-o" style="font-size: 50px;"></i>

              <div>此策展还没有内容</div>
            </div>
            <% } %>
          </div>

          <% include _ul.html %>

          <!--模板-->
          <div class="TEMPLATES" style="display:none;">

            <% include _video_player.html %>

          </div>

        </div>
      </div>
      <div class="col-sm-offset-1 col-sm-10 col-md-offset-0 col-md-4 col-lg-5 mtl">
        <div class="pal" style="background-color: #34495e;color:white;border-radius: 6px;">
          <div class="clearfix">
            <a class="pull-left mrl img-circle-border" title="<%= topic.author %>" target="_blank"
               href="/u/<%= topic.author %>"
               title="<%= topic.author %>"
               style="display: block; width: 80px; height: 80px;">
              <img class="img-circle" width="70" height="70" id="_thumb"
                   onerror="shizier.errorImage(this, 'image_95x95')"
                   src="<%= authorInfo.imgUrl || '/images/no_img/user_80x80.png' %>">
            </a>

            <h6 style="margin-top: 0;">
              <a href="/u/<%= topic.author %>" title="<%= topic.author %>">
                <%= topic.author %>
              </a>
            </h6>
            <% if (authorInfo.personalSite) { %>
            <% var site = authorInfo.personalSite || ''; %>
            <p class="mtm">
              <a target="_blank" href="<%= site %>"
                 title="<%= site %>"
                 style="word-break: break-all;">
                <i class="fa fa-home"></i>
                <%= site %>
              </a>
            </p>
            <% } %>
          </div>
          <% if (authorInfo.description) { %>
          <div class="mtm"><%- authorInfo.description || '' %></div>
          <% } %>
        </div>
      </div>
      <div class="col-sm-offset-1 col-sm-10 col-md-offset-0 col-md-8 col-lg-7 mtl">
        <a class="btn btn-primary btn-block btn-hg" href="/" title="石子儿首页">回首页，更多精彩“策展”</a>
      </div>
    </div>
  </div>
</div>

<% include ../_toTop.html %>