
<% locals.categoryType_pre = topic.category; %>
<% include ../_band.html %>

<!--内容-->
<div style="background-color: #ecf0f1;">
  <div class="container">
    <div class="row pbl">
      <div class="col-sm-offset-1 col-sm-10 col-md-offset-0 col-md-8 col-lg-7 mtl">
        <% if (locals.isAdmin) { %>
        <div class="mbl">
          <% include _category_selector.html %>
        </div>
        <% } %>
        <div style="background-color: white; border-radius: 6px;">
          <div class="TopicHead" style="position: relative; min-height: 140px; border-radius: 6px 6px 0 0;">
            <a class="fancybox" rel="gallery" href="<%= topic.cover_url %>" title="<%= topic.title %>">
              <img onerror="$(this).hide();" src="<%= topic.cover_url %>" alt="<%= topic.title %>"
                   style="width: 100%; border-radius: 6px 6px 0 0; <%= topic.cover_url ? '' : 'display: none;' %>">
            </a>
            <h1 class="Title mbn hidden-xs" >
              <a class="text-inverse pal h5" style="display: block;" href="/topic/<%= topic._id %>"><%= topic.title %></a>
            </h1>
          </div>

          <div class="phl">
            <h1 class="h5 mtl visible-xs"><a href="/topic/<%= topic._id %>"><%= topic.title %></a></h1>

            <div class="clearfix mtm mbm">
              <div class="pull-left">
                <a href="/u/<%= topic.author_name %>" title="<%= topic.author_name %>">
                  <span class="mrs" style="display: inline-block; width: 30px; height: 30px;">
                    <img width="30" height="30" class="img-circle"
                       src="<%= authorInfo.imgUrl || '/images/no_img/user_80x80.png' %>"
                       alt="<%= topic.author_name %>"
                       onerror="shizier.errorImage(this,'user_80x80');">
                  </span><span><%= topic.author_name %></span>
                </a>
                <span class="text-muted small mls">
                  <i class="fa fa-edit"></i>
                  <%= topic.update_at.getFullYear() + '-'
                        + (topic.update_at.getMonth() + 1) + '-'
                        + topic.update_at.getDate() %>
                </span>
              </div>
              <div class="pull-right">
                <% if (locals.isAuthor) { %>
                <a class="mrs btn btn-primary"
                   style="padding: 0 5px; font-size: 18px; vertical-align: baseline;"
                   href="/topic/<%= topic._id %>/edit" title="编辑"><i class="fa fa-pencil"></i></a>
                <% include _deleteBtn.html %>
                <% } %>
                <a class="mls text-info mls" target="_blank"
                   href="/topic/<%= topic._id %>/share_chang" title="分享"><i
                  class="fa fa-share"></i></a>
                <button name="favoriteTopic" class="<%- locals.liked ? 'ExSelected' : '' %> btn btn-default mls"
                        style="padding: 0 5px;vertical-align: baseline;font-size: 18px;"
                        data-favorite='{"topicId":"<%= topic._id %>"}' title="喜欢">
                  <i class="fa fa-star StarIcon"></i> <span class="FVCount"><%= topic.FVCount %></span>
                </button>
                <script>
                  $(function () {
                    $('button[name="favoriteTopic"]').click(function () {
                      var $this = $(this);
                      var topicId = $this.data('favorite').topicId;
                      var toLike = !$this.is('.ExSelected');
                      $.post('/topic/favorite', {
                        topicId: topicId,
                        toLike: toLike
                      })
                        .done(function (data) {
                          console.log('done');
                          if (toLike) {
                            $this.addClass('ExSelected');
                          } else {
                            $this.removeClass('ExSelected');
                          }
                          $this.find('.FVCount').text(data.FVCount);
                        });
                    });
                  });
                </script>
                <span class="text-muted mls"><i class="fa fa-eye"></i> <%= topic.PV_count %></span>
              </div>
            </div>

            <p style="<%= !topic.description ? 'display: none;' : '' %>">
              <%= topic.description || '' %>
            </p>

            <% if (!locals.items || !items.length) { %>
            <div class="text-muted text-center" style="padding: 140px 0px;">
              <i class="fa fa-file-o" style="font-size: 50px;"></i>

              <div>此策展还没有内容</div>
            </div>
            <% } %>
          </div>

          <% include _ul.html %>

          <!--模板-->
          <div class="TEMPLATES" style="display:none;">

            <% include _video_player.html %>

          </div>

        </div>
      </div>
      <div class="col-sm-offset-1 col-sm-10 col-md-offset-0 col-md-4 col-lg-5 mtl">
        <div class="pal" style="background-color: #34495e;color:white;border-radius: 6px;">
          <div class="clearfix">
            <a class="pull-left mrl img-circle-border" title="<%= topic.author_name %>" target="_blank"
               href="/u/<%= topic.author_name %>"
               title="<%= topic.author_name %>"
               style="display: block; width: 80px; height: 80px;">
              <img class="img-circle" width="70" height="70" id="_thumb"
                   onerror="shizier.errorImage(this, 'image_95x95')"
                   src="<%= authorInfo.imgUrl || '/images/no_img/user_80x80.png' %>"
                   alt="<%= topic.author_name %>">
            </a>

            <h1 class="h6 mvn">
              <a class="text-inverse" href="/u/<%= topic.author_name %>" title="<%= topic.author_name %>">
                <%= topic.author_name %>
              </a>
            </h1>
            <% if (authorInfo.personalSite) { %>
            <% var site = authorInfo.personalSite || ''; %>
            <p class="mtm">
              <a target="_blank" href="<%= site %>"
                 title="<%= site %>"
                 style="word-break: break-all;">
                <i class="fa fa-home"></i>
                <%= site %>
              </a>
            </p>
            <% } %>
          </div>
          <% if (authorInfo.description) { %>
          <div class="mtm"><%- authorInfo.description || '' %></div>
          <% } %>
          <div class="mtl">
            <button name="favoriteUser" class="<%= locals.likedBefore ? 'ExSelected' : '' %> btn btn-default"
                    data-favorite='{"authorName":"<%= authorInfo.author %>"}' title="喜欢">
              <i class="fa fa-star StarIcon"></i>
              <span class="FVCount"><%= authorInfo.favourite || '0' %></span>
            </button>

            <% include ../_favoriteUser.html %>

          </div>
        </div>
      </div>
      <div class="col-sm-offset-1 col-sm-10 col-md-offset-0 col-md-8 col-lg-7 mtl">
        <a class="btn btn-primary btn-block btn-hg" href="/" title="石子儿首页">回首页，更多精彩“策展”</a>
      </div>
    </div>
  </div>
</div>

<% include ../_toTop.html %>