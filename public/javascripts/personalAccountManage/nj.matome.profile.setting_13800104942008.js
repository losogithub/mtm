(function(window,$,undefined){var $event=$.event,resizeTimeout;
$event.special.smartresize={setup:function(){$(this).bind("resize",$event.special.smartresize.handler);
},teardown:function(){$(this).unbind("resize",$event.special.smartresize.handler);
},handler:function(event,execAsap){var context=this,args=arguments;
event.type="smartresize";
if(resizeTimeout){clearTimeout(resizeTimeout);
}resizeTimeout=setTimeout(function(){jQuery.event.handle.apply(context,args);
},execAsap==="execAsap"?0:100);
}};
$.fn.smartresize=function(fn){return fn?this.bind("smartresize",fn):this.trigger("smartresize",["execAsap"]);
};
$.Mason=function(options,element){this.element=$(element);
this._create(options);
this._init();
};
var masonryContainerStyles=["position","height"];
$.Mason.settings={isResizable:true,isAnimated:false,animationOptions:{queue:false,duration:500},gutterWidth:0,isRTL:false,isFitWidth:false};
$.Mason.prototype={_filterFindBricks:function($elems){var selector=this.options.itemSelector;
return !selector?$elems:$elems.filter(selector).add($elems.find(selector));
},_getBricks:function($elems){var $bricks=this._filterFindBricks($elems).css({position:"absolute"}).addClass("masonry-brick");
return $bricks;
},_create:function(options){this.options=$.extend(true,{},$.Mason.settings,options);
this.styleQueue=[];
this.reloadItems();
var elemStyle=this.element[0].style;
this.originalStyle={};
for(var i=0,len=masonryContainerStyles.length;
i<len;
i++){var prop=masonryContainerStyles[i];
this.originalStyle[prop]=elemStyle[prop]||"";
}this.element.css({position:"relative"});
this.horizontalDirection=this.options.isRTL?"right":"left";
this.offset={};
var $cursor=$(document.createElement("div"));
this.element.prepend($cursor);
this.offset.y=Math.round($cursor.position().top);
if(!this.options.isRTL){this.offset.x=Math.round($cursor.position().left);
}else{$cursor.css({"float":"right",display:"inline-block"});
this.offset.x=Math.round(this.element.outerWidth()-$cursor.position().left);
}$cursor.remove();
var instance=this;
setTimeout(function(){instance.element.addClass("masonry");
},0);
if(this.options.isResizable){$(window).bind("smartresize.masonry",function(){instance.resize();
});
}},_init:function(callback){this._getColumns("masonry");
this._reLayout(callback);
},option:function(key,value){if($.isPlainObject(key)){this.options=$.extend(true,this.options,key);
}},layout:function($bricks,callback){var $brick,colSpan,groupCount,groupY,groupColY,j;
for(var i=0,len=$bricks.length;
i<len;
i++){$brick=$($bricks[i]);
colSpan=Math.ceil($brick.outerWidth(true)/this.columnWidth);
colSpan=Math.min(colSpan,this.cols);
if(colSpan===1){this._placeBrick($brick,this.colYs);
}else{groupCount=this.cols+1-colSpan;
groupY=[];
for(j=0;
j<groupCount;
j++){groupColY=this.colYs.slice(j,j+colSpan);
groupY[j]=Math.max.apply(Math,groupColY);
}this._placeBrick($brick,groupY);
}}var containerSize={};
containerSize.height=Math.max.apply(Math,this.colYs)-this.offset.y;
if(this.options.isFitWidth){containerSize.width=this.cols*this.columnWidth-this.options.gutterWidth;
}this.styleQueue.push({$el:this.element,style:containerSize});
var styleFn=!this.isLaidOut?"css":(this.options.isAnimated?"animate":"css"),animOpts=this.options.animationOptions;
var obj;
for(i=0,len=this.styleQueue.length;
i<len;
i++){obj=this.styleQueue[i];
obj.$el[styleFn](obj.style,animOpts);
}this.styleQueue=[];
if(callback){callback.call($bricks);
}this.isLaidOut=true;
},_getColumns:function(){var container=this.options.isFitWidth?this.element.parent():this.element,containerWidth=container.width();
this.columnWidth=this.options.columnWidth||this.$bricks.outerWidth(true)||containerWidth;
this.columnWidth+=this.options.gutterWidth;
this.cols=Math.floor((containerWidth+this.options.gutterWidth)/this.columnWidth);
this.cols=Math.max(this.cols,1);
},_placeBrick:function($brick,setY){var minimumY=Math.min.apply(Math,setY),shortCol=0;
for(var i=0,len=setY.length;
i<len;
i++){if(setY[i]===minimumY){shortCol=i;
break;
}}var position={top:minimumY};
position[this.horizontalDirection]=this.columnWidth*shortCol+this.offset.x;
this.styleQueue.push({$el:$brick,style:position});
var setHeight=minimumY+$brick.outerHeight(true),setSpan=this.cols+1-len;
for(i=0;
i<setSpan;
i++){this.colYs[shortCol+i]=setHeight;
}},resize:function(){var prevColCount=this.cols;
this._getColumns("masonry");
if(this.cols!==prevColCount){this._reLayout();
}},_reLayout:function(callback){var i=this.cols;
this.colYs=[];
while(i--){this.colYs.push(this.offset.y);
}this.layout(this.$bricks,callback);
},reloadItems:function(){this.$bricks=this._getBricks(this.element.children());
},reload:function(callback){this.reloadItems();
this._init(callback);
},appended:function($content,isAnimatedFromBottom,callback){if(isAnimatedFromBottom){this._filterFindBricks($content).css({top:this.element.height()});
var instance=this;
setTimeout(function(){instance._appended($content,callback);
},1);
}else{this._appended($content,callback);
}},_appended:function($content,callback){var $newBricks=this._getBricks($content);
this.$bricks=this.$bricks.add($newBricks);
this.layout($newBricks,callback);
},remove:function($content){this.$bricks=this.$bricks.not($content);
$content.remove();
},destroy:function(){this.$bricks.removeClass("masonry-brick").each(function(){this.style.position="";
this.style.top="";
this.style.left="";
});
var elemStyle=this.element[0].style;
for(var i=0,len=masonryContainerStyles.length;
i<len;
i++){var prop=masonryContainerStyles[i];
elemStyle[prop]=this.originalStyle[prop];
}this.element.unbind(".masonry").removeClass("masonry").removeData("masonry");
$(window).unbind(".masonry");
}};
/*!
   * jQuery imagesLoaded plugin v1.0.3
   * http://github.com/desandro/imagesloaded
   *
   * MIT License. by Paul Irish et al.
   */
$.fn.imagesLoaded=function(callback){var $this=this,$images=$this.find("img").add($this.filter("img")),len=$images.length,blank="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
function triggerCallback(){callback.call($this,$images);
}function imgLoaded(){if(--len<=0&&this.src!==blank){setTimeout(triggerCallback);
$images.unbind("load error",imgLoaded);
}}if(!len){triggerCallback();
}$images.bind("load error",imgLoaded).each(function(){if(this.complete||this.complete===undefined){var src=this.src;
this.src=blank;
this.src=src;
}});
return $this;
};
var logError=function(message){if(this.console){console.error(message);
}};
$.fn.masonry=function(options){if(typeof options==="string"){var args=Array.prototype.slice.call(arguments,1);
this.each(function(){var instance=$.data(this,"masonry");
if(!instance){logError("cannot call methods on masonry prior to initialization; attempted to call method '"+options+"'");
return;
}if(!$.isFunction(instance[options])||options.charAt(0)==="_"){logError("no such method '"+options+"' for masonry instance");
return;
}instance[options].apply(instance,args);
});
}else{this.each(function(){var instance=$.data(this,"masonry");
if(instance){instance.option(options||{});
instance._init();
}else{$.data(this,"masonry",new $.Mason(options,this));
}});
}return this;
};
})(window,jQuery);
(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory);
}else{factory(jQuery);
}}(function($){var d=[],doc=$(document),ie6=$.browser.msie&&parseInt($.browser.version)===6&&typeof window.XMLHttpRequest!=="object",ie7=$.browser.msie&&parseInt($.browser.version)===7,ieQuirks=null,wndw=$(window),w=[];
$.modal=function(data,options){return $.modal.impl.init(data,options);
};
$.modal.close=function(){$.modal.impl.close();
};
$.modal.focus=function(pos){$.modal.impl.focus(pos);
};
$.modal.setContainerDimensions=function(){$.modal.impl.setContainerDimensions();
};
$.modal.setPosition=function(){$.modal.impl.setPosition();
};
$.modal.update=function(height,width){$.modal.impl.update(height,width);
};
$.fn.modal=function(options){return $.modal.impl.init(this,options);
};
$.modal.defaults={appendTo:"body",focus:true,opacity:50,overlayId:"simplemodal-overlay",overlayCss:{},containerId:"simplemodal-container",containerCss:{},dataId:"simplemodal-data",dataCss:{},minHeight:null,minWidth:null,maxHeight:null,maxWidth:null,autoResize:false,autoPosition:true,zIndex:1000,close:true,closeHTML:'<a class="modalCloseImg" title="Close"></a>',closeClass:"simplemodal-close",escClose:true,overlayClose:false,fixed:true,position:null,persist:false,modal:true,onOpen:null,onShow:null,onClose:null};
$.modal.impl={d:{},init:function(data,options){var s=this;
if(s.d.data){return false;
}ieQuirks=$.browser.msie&&!$.support.boxModel;
s.o=$.extend({},$.modal.defaults,options);
s.zIndex=s.o.zIndex;
s.occb=false;
if(typeof data==="object"){data=data instanceof $?data:$(data);
s.d.placeholder=false;
if(data.parent().parent().size()>0){data.before($("<span></span>").attr("id","simplemodal-placeholder").css({display:"none"}));
s.d.placeholder=true;
s.display=data.css("display");
if(!s.o.persist){s.d.orig=data.clone(true);
}}}else{if(typeof data==="string"||typeof data==="number"){data=$("<div></div>").html(data);
}else{alert("SimpleModal Error: Unsupported data type: "+typeof data);
return s;
}}s.create(data);
data=null;
s.open();
if($.isFunction(s.o.onShow)){s.o.onShow.apply(s,[s.d]);
}return s;
},create:function(data){var s=this;
s.getDimensions();
if(s.o.modal&&ie6){s.d.iframe=$('<iframe src="javascript:false;"></iframe>').css($.extend(s.o.iframeCss,{display:"none",opacity:0,position:"fixed",height:w[0],width:w[1],zIndex:s.o.zIndex,top:0,left:0})).appendTo(s.o.appendTo);
}s.d.overlay=$("<div></div>").attr("id",s.o.overlayId).addClass("simplemodal-overlay").css($.extend(s.o.overlayCss,{display:"none",opacity:s.o.opacity/100,height:s.o.modal?d[0]:0,width:s.o.modal?d[1]:0,position:"fixed",left:0,top:0,zIndex:s.o.zIndex+1})).appendTo(s.o.appendTo);
s.d.container=$("<div></div>").attr("id",s.o.containerId).addClass("simplemodal-container").css($.extend({position:s.o.fixed?"fixed":"absolute"},s.o.containerCss,{display:"none",zIndex:s.o.zIndex+2})).append(s.o.close&&s.o.closeHTML?$(s.o.closeHTML).addClass(s.o.closeClass):"").appendTo(s.o.appendTo);
s.d.wrap=$("<div></div>").attr("tabIndex",-1).addClass("simplemodal-wrap").css({height:"100%",outline:0,width:"100%"}).appendTo(s.d.container);
s.d.data=data.attr("id",data.attr("id")||s.o.dataId).addClass("simplemodal-data").css($.extend(s.o.dataCss,{display:"none"})).appendTo("body");
data=null;
s.setContainerDimensions();
s.d.data.appendTo(s.d.wrap);
if(ie6||ieQuirks){s.fixIE();
}},bindEvents:function(){var s=this;
$("."+s.o.closeClass).bind("click.simplemodal",function(e){e.preventDefault();
s.close();
});
if(s.o.modal&&s.o.close&&s.o.overlayClose){s.d.overlay.bind("click.simplemodal",function(e){e.preventDefault();
s.close();
});
}doc.bind("keydown.simplemodal",function(e){if(s.o.modal&&e.keyCode===9){s.watchTab(e);
}else{if((s.o.close&&s.o.escClose)&&e.keyCode===27){e.preventDefault();
s.close();
}}});
wndw.bind("resize.simplemodal orientationchange.simplemodal",function(){s.getDimensions();
s.o.autoResize?s.setContainerDimensions():s.o.autoPosition&&s.setPosition();
if(ie6||ieQuirks){s.fixIE();
}else{if(s.o.modal){s.d.iframe&&s.d.iframe.css({height:w[0],width:w[1]});
s.d.overlay.css({height:d[0],width:d[1]});
}}});
},unbindEvents:function(){$("."+this.o.closeClass).unbind("click.simplemodal");
doc.unbind("keydown.simplemodal");
wndw.unbind(".simplemodal");
this.d.overlay.unbind("click.simplemodal");
},fixIE:function(){var s=this,p=s.o.position;
$.each([s.d.iframe||null,!s.o.modal?null:s.d.overlay,s.d.container.css("position")==="fixed"?s.d.container:null],function(i,el){if(el){var bch="document.body.clientHeight",bcw="document.body.clientWidth",bsh="document.body.scrollHeight",bsl="document.body.scrollLeft",bst="document.body.scrollTop",bsw="document.body.scrollWidth",ch="document.documentElement.clientHeight",cw="document.documentElement.clientWidth",sl="document.documentElement.scrollLeft",st="document.documentElement.scrollTop",s=el[0].style;
s.position="absolute";
if(i<2){s.removeExpression("height");
s.removeExpression("width");
s.setExpression("height",""+bsh+" > "+bch+" ? "+bsh+" : "+bch+' + "px"');
s.setExpression("width",""+bsw+" > "+bcw+" ? "+bsw+" : "+bcw+' + "px"');
}else{var te,le;
if(p&&p.constructor===Array){var top=p[0]?typeof p[0]==="number"?p[0].toString():p[0].replace(/px/,""):el.css("top").replace(/px/,"");
te=top.indexOf("%")===-1?top+" + (t = "+st+" ? "+st+" : "+bst+') + "px"':parseInt(top.replace(/%/,""))+" * (("+ch+" || "+bch+") / 100) + (t = "+st+" ? "+st+" : "+bst+') + "px"';
if(p[1]){var left=typeof p[1]==="number"?p[1].toString():p[1].replace(/px/,"");
le=left.indexOf("%")===-1?left+" + (t = "+sl+" ? "+sl+" : "+bsl+') + "px"':parseInt(left.replace(/%/,""))+" * (("+cw+" || "+bcw+") / 100) + (t = "+sl+" ? "+sl+" : "+bsl+') + "px"';
}}else{te="("+ch+" || "+bch+") / 2 - (this.offsetHeight / 2) + (t = "+st+" ? "+st+" : "+bst+') + "px"';
le="("+cw+" || "+bcw+") / 2 - (this.offsetWidth / 2) + (t = "+sl+" ? "+sl+" : "+bsl+') + "px"';
}s.removeExpression("top");
s.removeExpression("left");
s.setExpression("top",te);
s.setExpression("left",le);
}}});
},focus:function(pos){var s=this,p=pos&&$.inArray(pos,["first","last"])!==-1?pos:"first";
var input=$(":input:enabled:visible:"+p,s.d.wrap);
setTimeout(function(){input.length>0?input.focus():s.d.wrap.focus();
},10);
},getDimensions:function(){var s=this,h=typeof window.innerHeight==="undefined"?wndw.height():window.innerHeight;
d=[doc.height(),doc.width()];
w=[h,wndw.width()];
},getVal:function(v,d){return v?(typeof v==="number"?v:v==="auto"?0:v.indexOf("%")>0?((parseInt(v.replace(/%/,""))/100)*(d==="h"?w[0]:w[1])):parseInt(v.replace(/px/,""))):null;
},update:function(height,width){var s=this;
if(!s.d.data){return false;
}s.d.origHeight=s.getVal(height,"h");
s.d.origWidth=s.getVal(width,"w");
s.d.data.hide();
height&&s.d.container.css("height",height);
width&&s.d.container.css("width",width);
s.setContainerDimensions();
s.d.data.show();
s.o.focus&&s.focus();
s.unbindEvents();
s.bindEvents();
},setContainerDimensions:function(){var s=this,badIE=ie6||ie7;
var ch=s.d.origHeight?s.d.origHeight:$.browser.opera?s.d.container.height():s.getVal(badIE?s.d.container[0].currentStyle.height:s.d.container.css("height"),"h"),cw=s.d.origWidth?s.d.origWidth:$.browser.opera?s.d.container.width():s.getVal(badIE?s.d.container[0].currentStyle.width:s.d.container.css("width"),"w"),dh=s.d.data.outerHeight(true),dw=s.d.data.outerWidth(true);
s.d.origHeight=s.d.origHeight||ch;
s.d.origWidth=s.d.origWidth||cw;
var mxoh=s.o.maxHeight?s.getVal(s.o.maxHeight,"h"):null,mxow=s.o.maxWidth?s.getVal(s.o.maxWidth,"w"):null,mh=mxoh&&mxoh<w[0]?mxoh:w[0],mw=mxow&&mxow<w[1]?mxow:w[1];
var moh=s.o.minHeight?s.getVal(s.o.minHeight,"h"):"auto";
if(!ch){if(!dh){ch=moh;
}else{if(dh>mh){ch=mh;
}else{if(s.o.minHeight&&moh!=="auto"&&dh<moh){ch=moh;
}else{ch=dh;
}}}}else{ch=s.o.autoResize&&ch>mh?mh:ch<moh?moh:ch;
}var mow=s.o.minWidth?s.getVal(s.o.minWidth,"w"):"auto";
if(!cw){if(!dw){cw=mow;
}else{if(dw>mw){cw=mw;
}else{if(s.o.minWidth&&mow!=="auto"&&dw<mow){cw=mow;
}else{cw=dw;
}}}}else{cw=s.o.autoResize&&cw>mw?mw:cw<mow?mow:cw;
}s.d.container.css({height:ch,width:cw});
s.d.wrap.css({overflow:(dh>ch||dw>cw)?"auto":"visible"});
s.o.autoPosition&&s.setPosition();
},setPosition:function(){var s=this,top,left,hc=(w[0]/2)-(s.d.container.outerHeight(true)/2),vc=(w[1]/2)-(s.d.container.outerWidth(true)/2),st=s.d.container.css("position")!=="fixed"?wndw.scrollTop():0;
if(s.o.position&&Object.prototype.toString.call(s.o.position)==="[object Array]"){top=st+(s.o.position[0]||hc);
left=s.o.position[1]||vc;
}else{top=st+hc;
left=vc;
}s.d.container.css({left:left,top:top});
},watchTab:function(e){var s=this;
if($(e.target).parents(".simplemodal-container").length>0){s.inputs=$(":input:enabled:visible:first, :input:enabled:visible:last",s.d.data[0]);
if((!e.shiftKey&&e.target===s.inputs[s.inputs.length-1])||(e.shiftKey&&e.target===s.inputs[0])||s.inputs.length===0){e.preventDefault();
var pos=e.shiftKey?"last":"first";
s.focus(pos);
}}else{e.preventDefault();
s.focus();
}},open:function(){var s=this;
s.d.iframe&&s.d.iframe.show();
if($.isFunction(s.o.onOpen)){s.o.onOpen.apply(s,[s.d]);
}else{s.d.overlay.show();
s.d.container.show();
s.d.data.show();
}s.o.focus&&s.focus();
s.bindEvents();
},close:function(){var s=this;
if(!s.d.data){return false;
}s.unbindEvents();
if($.isFunction(s.o.onClose)&&!s.occb){s.occb=true;
s.o.onClose.apply(s,[s.d]);
}else{if(s.d.placeholder){var ph=$("#simplemodal-placeholder");
if(s.o.persist){ph.replaceWith(s.d.data.removeClass("simplemodal-data").css("display",s.display));
}else{s.d.data.hide().remove();
ph.replaceWith(s.d.orig);
}}else{s.d.data.hide().remove();
}s.d.container.hide().remove();
s.d.overlay.hide();
s.d.iframe&&s.d.iframe.hide().remove();
s.d.overlay.remove();
s.d={};
}}};
}));
(function(){var fCreate=$.modal.impl.create;
$.modal.impl.create=function(){var that=this;
fCreate.apply(this,arguments);
setTimeout(function(){that.d.container.njLayerSupport();
},0);
};
})();
(function($){var LAYER_CLASS="FnLayerSupportOverlay";
$.widget("ui.njLayerSupport",{_init:function(){if(!$.browser.msie){return;
}if(($("embed").length||$("object").length)&&!this.element.find("."+LAYER_CLASS).length){this._setIframe();
}},_setIframe:function(){var $iframe=$("<iframe></iframe>"),$el,sPos;
this._$iframe&&this._$iframe.remove();
$iframe.attr({frameborder:0,scrolling:"no"}).css({width:"100%",height:"100%",position:"absolute",top:0,left:0,background:"#000",opacity:"-1000"}).addClass(LAYER_CLASS);
this.element.children().each(function(){$el=$(this);
sPos=$el.css("position");
if(sPos!=="absolute"){$el.css("position","relative").data("beforePosition",sPos);
}});
this.element.prepend($iframe);
this._$iframe=$iframe;
},remove:function(){var $el,sPos;
this._$iframe&&this._$iframe.remove();
this.element.children().each(function(){$el=$(this);
sPos=$el.data("beforePosition");
$el.css("position",sPos).data("beforePosition","");
});
}});
})(jQuery);
(function($){$.Jcrop=function(obj,opt){var options=$.extend({},$.Jcrop.defaults),docOffset,lastcurs,ie6mode=false;
function px(n){return parseInt(n,10)+"px";
}function pct(n){return parseInt(n,10)+"%";
}function cssClass(cl){return options.baseClass+"-"+cl;
}function supportsColorFade(){return $.fx.step.hasOwnProperty("backgroundColor");
}function getPos(obj){var pos=$(obj).offset();
return[pos.left,pos.top];
}function mouseAbs(e){return[(e.pageX-docOffset[0]),(e.pageY-docOffset[1])];
}function setOptions(opt){if(typeof(opt)!=="object"){opt={};
}options=$.extend(options,opt);
if(typeof(options.onChange)!=="function"){options.onChange=function(){};
}if(typeof(options.onSelect)!=="function"){options.onSelect=function(){};
}if(typeof(options.onRelease)!=="function"){options.onRelease=function(){};
}}function myCursor(type){if(type!==lastcurs){Tracker.setCursor(type);
lastcurs=type;
}}function startDragMode(mode,pos){docOffset=getPos($img);
Tracker.setCursor(mode==="move"?mode:mode+"-resize");
if(mode==="move"){return Tracker.activateHandlers(createMover(pos),doneSelect);
}var fc=Coords.getFixed();
var opp=oppLockCorner(mode);
var opc=Coords.getCorner(oppLockCorner(opp));
Coords.setPressed(Coords.getCorner(opp));
Coords.setCurrent(opc);
Tracker.activateHandlers(dragmodeHandler(mode,fc),doneSelect);
}function dragmodeHandler(mode,f){return function(pos){if(!options.aspectRatio){switch(mode){case"e":pos[1]=f.y2;
break;
case"w":pos[1]=f.y2;
break;
case"n":pos[0]=f.x2;
break;
case"s":pos[0]=f.x2;
break;
}}else{switch(mode){case"e":pos[1]=f.y+1;
break;
case"w":pos[1]=f.y+1;
break;
case"n":pos[0]=f.x+1;
break;
case"s":pos[0]=f.x+1;
break;
}}Coords.setCurrent(pos);
Selection.update();
};
}function createMover(pos){var lloc=pos;
KeyManager.watchKeys();
return function(pos){Coords.moveOffset([pos[0]-lloc[0],pos[1]-lloc[1]]);
lloc=pos;
Selection.update();
};
}function oppLockCorner(ord){switch(ord){case"n":return"sw";
case"s":return"nw";
case"e":return"nw";
case"w":return"ne";
case"ne":return"sw";
case"nw":return"se";
case"se":return"nw";
case"sw":return"ne";
}}function createDragger(ord){return function(e){if(options.disabled){return false;
}if((ord==="move")&&!options.allowMove){return false;
}btndown=true;
startDragMode(ord,mouseAbs(e));
e.stopPropagation();
e.preventDefault();
return false;
};
}function presize($obj,w,h){var nw=$obj.width(),nh=$obj.height();
if((nw>w)&&w>0){nw=w;
nh=(w/$obj.width())*$obj.height();
}if((nh>h)&&h>0){nh=h;
nw=(h/$obj.height())*$obj.width();
}xscale=$obj.width()/nw;
yscale=$obj.height()/nh;
$obj.width(nw).height(nh);
}function unscale(c){return{x:parseInt(c.x*xscale,10),y:parseInt(c.y*yscale,10),x2:parseInt(c.x2*xscale,10),y2:parseInt(c.y2*yscale,10),w:parseInt(c.w*xscale,10),h:parseInt(c.h*yscale,10)};
}function doneSelect(pos){var c=Coords.getFixed();
if((c.w>options.minSelect[0])&&(c.h>options.minSelect[1])){Selection.enableHandles();
Selection.done();
}else{Selection.release();
}Tracker.setCursor(options.allowSelect?"crosshair":"default");
}function newSelection(e){if(options.disabled){return false;
}if(!options.allowSelect){return false;
}btndown=true;
docOffset=getPos($img);
Selection.disableHandles();
myCursor("crosshair");
var pos=mouseAbs(e);
Coords.setPressed(pos);
Selection.update();
Tracker.activateHandlers(selectDrag,doneSelect);
KeyManager.watchKeys();
e.stopPropagation();
e.preventDefault();
return false;
}function selectDrag(pos){Coords.setCurrent(pos);
Selection.update();
}function newTracker(){var trk=$("<div></div>").addClass(cssClass("tracker"));
if($.browser.msie){trk.css({opacity:0,backgroundColor:"white"});
}return trk;
}if($.browser.msie&&($.browser.version.split(".")[0]==="6")){ie6mode=true;
}if(typeof(obj)!=="object"){obj=$(obj)[0];
}if(typeof(opt)!=="object"){opt={};
}setOptions(opt);
var img_css={border:"none",margin:0,padding:0,position:"absolute"};
var $origimg=$(obj);
var $img=$origimg.clone().removeAttr("id").css(img_css);
$img.width($origimg.width());
$img.height($origimg.height());
$origimg.after($img).hide();
presize($img,options.boxWidth,options.boxHeight);
var boundx=$img.width(),boundy=$img.height(),$div=$("<div />").width(boundx).height(boundy).addClass(cssClass("holder")).css({position:"relative",backgroundColor:options.bgColor}).insertAfter($origimg).append($img);
delete (options.bgColor);
if(options.addClass){$div.addClass(options.addClass);
}var $img2=$("<img />").attr("src",$img.attr("src")).css(img_css).width(boundx).height(boundy),$img_holder=$("<div />").width(pct(100)).height(pct(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append($img2),$hdl_holder=$("<div />").width(pct(100)).height(pct(100)).css("zIndex",320),$sel=$("<div />").css({position:"absolute",zIndex:300}).insertBefore($img).append($img_holder,$hdl_holder);
if(ie6mode){$sel.css({overflowY:"hidden"});
}var bound=options.boundary;
var $trk=newTracker().width(boundx+(bound*2)).height(boundy+(bound*2)).css({position:"absolute",top:px(-bound),left:px(-bound),zIndex:290}).mousedown(newSelection);
var bgopacity=options.bgOpacity,xlimit,ylimit,xmin,ymin,xscale,yscale,enabled=true,btndown,animating,shift_down;
docOffset=getPos($img);
var Touch=(function(){function hasTouchSupport(){var support={},events=["touchstart","touchmove","touchend"],el=document.createElement("div"),i;
try{for(i=0;
i<events.length;
i++){var eventName=events[i];
eventName="on"+eventName;
var isSupported=(eventName in el);
if(!isSupported){el.setAttribute(eventName,"return;");
isSupported=typeof el[eventName]=="function";
}support[events[i]]=isSupported;
}return support.touchstart&&support.touchend&&support.touchmove;
}catch(err){return false;
}}function detectSupport(){if((options.touchSupport===true)||(options.touchSupport===false)){return options.touchSupport;
}else{return hasTouchSupport();
}}return{createDragger:function(ord){return function(e){e.pageX=e.originalEvent.changedTouches[0].pageX;
e.pageY=e.originalEvent.changedTouches[0].pageY;
if(options.disabled){return false;
}if((ord==="move")&&!options.allowMove){return false;
}btndown=true;
startDragMode(ord,mouseAbs(e));
e.stopPropagation();
e.preventDefault();
return false;
};
},newSelection:function(e){e.pageX=e.originalEvent.changedTouches[0].pageX;
e.pageY=e.originalEvent.changedTouches[0].pageY;
return newSelection(e);
},isSupported:hasTouchSupport,support:detectSupport()};
}());
var Coords=(function(){var x1=0,y1=0,x2=0,y2=0,ox,oy;
function setPressed(pos){pos=rebound(pos);
x2=x1=pos[0];
y2=y1=pos[1];
}function setCurrent(pos){pos=rebound(pos);
ox=pos[0]-x2;
oy=pos[1]-y2;
x2=pos[0];
y2=pos[1];
}function getOffset(){return[ox,oy];
}function moveOffset(offset){var ox=offset[0],oy=offset[1];
if(0>x1+ox){ox-=ox+x1;
}if(0>y1+oy){oy-=oy+y1;
}if(boundy<y2+oy){oy+=boundy-(y2+oy);
}if(boundx<x2+ox){ox+=boundx-(x2+ox);
}x1+=ox;
x2+=ox;
y1+=oy;
y2+=oy;
}function getCorner(ord){var c=getFixed();
switch(ord){case"ne":return[c.x2,c.y];
case"nw":return[c.x,c.y];
case"se":return[c.x2,c.y2];
case"sw":return[c.x,c.y2];
}}function getFixed(){if(!options.aspectRatio){return getRect();
}var aspect=options.aspectRatio,min_x=options.minSize[0]/xscale,max_x=options.maxSize[0]/xscale,max_y=options.maxSize[1]/yscale,rw=x2-x1,rh=y2-y1,rwa=Math.abs(rw),rha=Math.abs(rh),real_ratio=rwa/rha,xx,yy;
if(max_x===0){max_x=boundx*10;
}if(max_y===0){max_y=boundy*10;
}if(real_ratio<aspect){yy=y2;
w=rha*aspect;
xx=rw<0?x1-w:w+x1;
if(xx<0){xx=0;
h=Math.abs((xx-x1)/aspect);
yy=rh<0?y1-h:h+y1;
}else{if(xx>boundx){xx=boundx;
h=Math.abs((xx-x1)/aspect);
yy=rh<0?y1-h:h+y1;
}}}else{xx=x2;
h=rwa/aspect;
yy=rh<0?y1-h:y1+h;
if(yy<0){yy=0;
w=Math.abs((yy-y1)*aspect);
xx=rw<0?x1-w:w+x1;
}else{if(yy>boundy){yy=boundy;
w=Math.abs(yy-y1)*aspect;
xx=rw<0?x1-w:w+x1;
}}}if(xx>x1){if(xx-x1<min_x){xx=x1+min_x;
}else{if(xx-x1>max_x){xx=x1+max_x;
}}if(yy>y1){yy=y1+(xx-x1)/aspect;
}else{yy=y1-(xx-x1)/aspect;
}}else{if(xx<x1){if(x1-xx<min_x){xx=x1-min_x;
}else{if(x1-xx>max_x){xx=x1-max_x;
}}if(yy>y1){yy=y1+(x1-xx)/aspect;
}else{yy=y1-(x1-xx)/aspect;
}}}if(xx<0){x1-=xx;
xx=0;
}else{if(xx>boundx){x1-=xx-boundx;
xx=boundx;
}}if(yy<0){y1-=yy;
yy=0;
}else{if(yy>boundy){y1-=yy-boundy;
yy=boundy;
}}return makeObj(flipCoords(x1,y1,xx,yy));
}function rebound(p){if(p[0]<0){p[0]=0;
}if(p[1]<0){p[1]=0;
}if(p[0]>boundx){p[0]=boundx;
}if(p[1]>boundy){p[1]=boundy;
}return[p[0],p[1]];
}function flipCoords(x1,y1,x2,y2){var xa=x1,xb=x2,ya=y1,yb=y2;
if(x2<x1){xa=x2;
xb=x1;
}if(y2<y1){ya=y2;
yb=y1;
}return[Math.round(xa),Math.round(ya),Math.round(xb),Math.round(yb)];
}function getRect(){var xsize=x2-x1,ysize=y2-y1,delta;
if(xlimit&&(Math.abs(xsize)>xlimit)){x2=(xsize>0)?(x1+xlimit):(x1-xlimit);
}if(ylimit&&(Math.abs(ysize)>ylimit)){y2=(ysize>0)?(y1+ylimit):(y1-ylimit);
}if(ymin/yscale&&(Math.abs(ysize)<ymin/yscale)){y2=(ysize>0)?(y1+ymin/yscale):(y1-ymin/yscale);
}if(xmin/xscale&&(Math.abs(xsize)<xmin/xscale)){x2=(xsize>0)?(x1+xmin/xscale):(x1-xmin/xscale);
}if(x1<0){x2-=x1;
x1-=x1;
}if(y1<0){y2-=y1;
y1-=y1;
}if(x2<0){x1-=x2;
x2-=x2;
}if(y2<0){y1-=y2;
y2-=y2;
}if(x2>boundx){delta=x2-boundx;
x1-=delta;
x2-=delta;
}if(y2>boundy){delta=y2-boundy;
y1-=delta;
y2-=delta;
}if(x1>boundx){delta=x1-boundy;
y2-=delta;
y1-=delta;
}if(y1>boundy){delta=y1-boundy;
y2-=delta;
y1-=delta;
}return makeObj(flipCoords(x1,y1,x2,y2));
}function makeObj(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]};
}return{flipCoords:flipCoords,setPressed:setPressed,setCurrent:setCurrent,getOffset:getOffset,moveOffset:moveOffset,getCorner:getCorner,getFixed:getFixed};
}());
var Selection=(function(){var awake,hdep=370;
var borders={};
var handle={};
var seehandles=false;
var hhs=options.handleOffset;
function insertBorder(type){var jq=$("<div />").css({position:"absolute",opacity:options.borderOpacity}).addClass(cssClass(type));
$img_holder.append(jq);
return jq;
}function dragDiv(ord,zi){var jq=$("<div />").mousedown(createDragger(ord)).css({cursor:ord+"-resize",position:"absolute",zIndex:zi});
if(Touch.support){jq.bind("touchstart",Touch.createDragger(ord));
}$hdl_holder.append(jq);
return jq;
}function insertHandle(ord){return dragDiv(ord,hdep++).css({top:px(-hhs+1),left:px(-hhs+1),opacity:options.handleOpacity}).addClass(cssClass("handle"));
}function insertDragbar(ord){var s=options.handleSize,h=s,w=s,t=hhs,l=hhs;
switch(ord){case"n":case"s":w=pct(100);
break;
case"e":case"w":h=pct(100);
break;
}return dragDiv(ord,hdep++).width(w).height(h).css({top:px(-t+1),left:px(-l+1)});
}function createHandles(li){var i;
for(i=0;
i<li.length;
i++){handle[li[i]]=insertHandle(li[i]);
}}function moveHandles(c){var midvert=Math.round((c.h/2)-hhs),midhoriz=Math.round((c.w/2)-hhs),north=-hhs+1,west=-hhs+1,east=c.w-hhs,south=c.h-hhs,x,y;
if(handle.e){handle.e.css({top:px(midvert),left:px(east)});
handle.w.css({top:px(midvert)});
handle.s.css({top:px(south),left:px(midhoriz)});
handle.n.css({left:px(midhoriz)});
}if(handle.ne){handle.ne.css({left:px(east)});
handle.se.css({top:px(south),left:px(east)});
handle.sw.css({top:px(south)});
}if(handle.b){handle.b.css({top:px(south)});
handle.r.css({left:px(east)});
}}function moveto(x,y){$img2.css({top:px(-y),left:px(-x)});
$sel.css({top:px(y),left:px(x)});
}function resize(w,h){$sel.width(w).height(h);
}function refresh(){var c=Coords.getFixed();
Coords.setPressed([c.x,c.y]);
Coords.setCurrent([c.x2,c.y2]);
updateVisible();
}function updateVisible(){if(awake){return update();
}}function update(){var c=Coords.getFixed();
resize(c.w,c.h);
moveto(c.x,c.y);
if(seehandles){moveHandles(c);
}if(!awake){show();
}options.onChange.call(api,unscale(c));
}function show(){$sel.show();
if(options.bgFade){$img.fadeTo(options.fadeTime,bgopacity);
}else{$img.css("opacity",bgopacity);
}awake=true;
}function release(){disableHandles();
$sel.hide();
if(options.bgFade){$img.fadeTo(options.fadeTime,1);
}else{$img.css("opacity",1);
}awake=false;
options.onRelease.call(api);
}function showHandles(){if(seehandles){moveHandles(Coords.getFixed());
$hdl_holder.show();
}}function enableHandles(){seehandles=true;
if(options.allowResize){moveHandles(Coords.getFixed());
$hdl_holder.show();
return true;
}}function disableHandles(){seehandles=false;
$hdl_holder.hide();
}function animMode(v){if(animating===v){disableHandles();
}else{enableHandles();
}}function done(){animMode(false);
refresh();
}if(options.drawBorders){borders={top:insertBorder("hline"),bottom:insertBorder("hline bottom"),left:insertBorder("vline"),right:insertBorder("vline right")};
}if(options.dragEdges){handle.t=insertDragbar("n");
handle.b=insertDragbar("s");
handle.r=insertDragbar("e");
handle.l=insertDragbar("w");
}if(options.sideHandles){createHandles(["n","s","e","w"]);
}if(options.cornerHandles){createHandles(["sw","nw","ne","se"]);
}var $track=newTracker().mousedown(createDragger("move")).css({cursor:"move",position:"absolute",zIndex:360});
if(Touch.support){$track.bind("touchstart.jcrop",Touch.createDragger("move"));
}$img_holder.append($track);
disableHandles();
return{updateVisible:updateVisible,update:update,release:release,refresh:refresh,isAwake:function(){return awake;
},setCursor:function(cursor){$track.css("cursor",cursor);
},enableHandles:enableHandles,enableOnly:function(){seehandles=true;
},showHandles:showHandles,disableHandles:disableHandles,animMode:animMode,done:done};
}());
var Tracker=(function(){var onMove=function(){},onDone=function(){},trackDoc=options.trackDocument;
function toFront(){$trk.css({zIndex:450});
if(trackDoc){$(document).bind("mousemove",trackMove).bind("mouseup",trackUp);
}}function toBack(){$trk.css({zIndex:290});
if(trackDoc){$(document).unbind("mousemove",trackMove).unbind("mouseup",trackUp);
}}function trackMove(e){onMove(mouseAbs(e));
return false;
}function trackUp(e){e.preventDefault();
e.stopPropagation();
if(btndown){btndown=false;
onDone(mouseAbs(e));
if(Selection.isAwake()){options.onSelect.call(api,unscale(Coords.getFixed()));
}toBack();
onMove=function(){};
onDone=function(){};
}return false;
}function activateHandlers(move,done){btndown=true;
onMove=move;
onDone=done;
toFront();
return false;
}function trackTouchMove(e){e.pageX=e.originalEvent.changedTouches[0].pageX;
e.pageY=e.originalEvent.changedTouches[0].pageY;
return trackMove(e);
}function trackTouchEnd(e){e.pageX=e.originalEvent.changedTouches[0].pageX;
e.pageY=e.originalEvent.changedTouches[0].pageY;
return trackUp(e);
}function setCursor(t){$trk.css("cursor",t);
}if(Touch.support){$(document).bind("touchmove",trackTouchMove).bind("touchend",trackTouchEnd);
}if(!trackDoc){$trk.mousemove(trackMove).mouseup(trackUp).mouseout(trackUp);
}$img.before($trk);
return{activateHandlers:activateHandlers,setCursor:setCursor};
}());
var KeyManager=(function(){var $keymgr=$('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}),$keywrap=$("<div />").css({position:"absolute",overflow:"hidden"}).append($keymgr);
function watchKeys(){if(options.keySupport){$keymgr.show();
$keymgr.focus();
}}function onBlur(e){$keymgr.hide();
}function doNudge(e,x,y){if(options.allowMove){Coords.moveOffset([x,y]);
Selection.updateVisible();
}e.preventDefault();
e.stopPropagation();
}function parseKey(e){if(e.ctrlKey){return true;
}shift_down=e.shiftKey?true:false;
var nudge=shift_down?10:1;
switch(e.keyCode){case 37:doNudge(e,-nudge,0);
break;
case 39:doNudge(e,nudge,0);
break;
case 38:doNudge(e,0,-nudge);
break;
case 40:doNudge(e,0,nudge);
break;
case 27:Selection.release();
break;
case 9:return true;
}return false;
}if(options.keySupport){$keymgr.keydown(parseKey).blur(onBlur);
if(ie6mode||!options.fixedSupport){$keymgr.css({position:"absolute",left:"-20px"});
$keywrap.append($keymgr).insertBefore($img);
}else{$keymgr.insertBefore($img);
}}return{watchKeys:watchKeys};
}());
function setClass(cname){$div.removeClass().addClass(cssClass("holder")).addClass(cname);
}function animateTo(a,callback){var x1=parseInt(a[0],10)/xscale,y1=parseInt(a[1],10)/yscale,x2=parseInt(a[2],10)/xscale,y2=parseInt(a[3],10)/yscale;
if(animating){return;
}var animto=Coords.flipCoords(x1,y1,x2,y2),c=Coords.getFixed(),initcr=[c.x,c.y,c.x2,c.y2],animat=initcr,interv=options.animationDelay,ix1=animto[0]-initcr[0],iy1=animto[1]-initcr[1],ix2=animto[2]-initcr[2],iy2=animto[3]-initcr[3],pcent=0,velocity=options.swingSpeed;
x=animat[0];
y=animat[1];
x2=animat[2];
y2=animat[3];
Selection.animMode(true);
var anim_timer;
function queueAnimator(){window.setTimeout(animator,interv);
}var animator=(function(){return function(){pcent+=(100-pcent)/velocity;
animat[0]=x+((pcent/100)*ix1);
animat[1]=y+((pcent/100)*iy1);
animat[2]=x2+((pcent/100)*ix2);
animat[3]=y2+((pcent/100)*iy2);
if(pcent>=99.8){pcent=100;
}if(pcent<100){setSelectRaw(animat);
queueAnimator();
}else{Selection.done();
if(typeof(callback)==="function"){callback.call(api);
}}};
}());
queueAnimator();
}function setSelect(rect){setSelectRaw([parseInt(rect[0],10)/xscale,parseInt(rect[1],10)/yscale,parseInt(rect[2],10)/xscale,parseInt(rect[3],10)/yscale]);
}function setSelectRaw(l){Coords.setPressed([l[0],l[1]]);
Coords.setCurrent([l[2],l[3]]);
Selection.update();
}function tellSelect(){return unscale(Coords.getFixed());
}function tellScaled(){return Coords.getFixed();
}function setOptionsNew(opt){setOptions(opt);
interfaceUpdate();
}function disableCrop(){options.disabled=true;
Selection.disableHandles();
Selection.setCursor("default");
Tracker.setCursor("default");
}function enableCrop(){options.disabled=false;
interfaceUpdate();
}function cancelCrop(){Selection.done();
Tracker.activateHandlers(null,null);
}function destroy(){$div.remove();
$origimg.show();
$(obj).removeData("Jcrop");
}function setImage(src,callback){Selection.release();
disableCrop();
var img=new Image();
img.onload=function(){var iw=img.width;
var ih=img.height;
var bw=options.boxWidth;
var bh=options.boxHeight;
$img.width(iw).height(ih);
$img.attr("src",src);
$img2.attr("src",src);
presize($img,bw,bh);
boundx=$img.width();
boundy=$img.height();
$img2.width(boundx).height(boundy);
$trk.width(boundx+(bound*2)).height(boundy+(bound*2));
$div.width(boundx).height(boundy);
enableCrop();
if(typeof(callback)==="function"){callback.call(api);
}};
img.src=src;
}function interfaceUpdate(alt){if(options.allowResize){if(alt){Selection.enableOnly();
}else{Selection.enableHandles();
}}else{Selection.disableHandles();
}Tracker.setCursor(options.allowSelect?"crosshair":"default");
Selection.setCursor(options.allowMove?"move":"default");
if(options.hasOwnProperty("setSelect")){setSelect(options.setSelect);
Selection.done();
delete (options.setSelect);
}if(options.hasOwnProperty("trueSize")){xscale=options.trueSize[0]/boundx;
yscale=options.trueSize[1]/boundy;
}if(options.hasOwnProperty("bgColor")){if(supportsColorFade()&&options.fadeTime){$div.animate({backgroundColor:options.bgColor},{queue:false,duration:options.fadeTime});
}else{$div.css("backgroundColor",options.bgColor);
}delete (options.bgColor);
}if(options.hasOwnProperty("bgOpacity")){bgopacity=options.bgOpacity;
if(Selection.isAwake()){if(options.fadeTime){$img.fadeTo(options.fadeTime,bgopacity);
}else{$div.css("opacity",options.opacity);
}}delete (options.bgOpacity);
}xlimit=options.maxSize[0]||0;
ylimit=options.maxSize[1]||0;
xmin=options.minSize[0]||0;
ymin=options.minSize[1]||0;
if(options.hasOwnProperty("outerImage")){$img.attr("src",options.outerImage);
delete (options.outerImage);
}Selection.refresh();
}if(Touch.support){$trk.bind("touchstart",Touch.newSelection);
}$hdl_holder.hide();
interfaceUpdate(true);
var api={setImage:setImage,animateTo:animateTo,setSelect:setSelect,setOptions:setOptionsNew,tellSelect:tellSelect,tellScaled:tellScaled,setClass:setClass,disable:disableCrop,enable:enableCrop,cancel:cancelCrop,release:Selection.release,destroy:destroy,focus:KeyManager.watchKeys,getBounds:function(){return[boundx*xscale,boundy*yscale];
},getWidgetSize:function(){return[boundx,boundy];
},getScaleFactor:function(){return[xscale,yscale];
},ui:{holder:$div,selection:$sel}};
if($.browser.msie){$div.bind("selectstart",function(){return false;
});
}$origimg.data("Jcrop",api);
return api;
};
$.fn.Jcrop=function(options,callback){function attachWhenDone(from){var opt=(typeof(options)==="object")?options:{};
var loadsrc=opt.useImg||from.src;
var img=new Image();
img.onload=function(){function attachJcrop(){var api=$.Jcrop(from,opt);
if(typeof(callback)==="function"){callback.call(api);
}}function attachAttempt(){if(!img.width||!img.height){window.setTimeout(attachAttempt,50);
}else{attachJcrop();
}}window.setTimeout(attachAttempt,50);
};
img.src=loadsrc;
}this.each(function(){if($(this).data("Jcrop")){if(options==="api"){return $(this).data("Jcrop");
}else{$(this).data("Jcrop").setOptions(options);
}}else{attachWhenDone(this);
}});
return this;
};
$.Jcrop.defaults={allowSelect:true,allowMove:true,allowResize:true,trackDocument:true,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,bgFade:false,borderOpacity:0.4,handleOpacity:0.5,handleSize:9,handleOffset:5,aspectRatio:0,keySupport:true,cornerHandles:true,sideHandles:true,drawBorders:true,dragEdges:true,fixedSupport:true,touchSupport:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onRelease:function(){}};
}(jQuery));
(function(){$.widget("ui.stopScroll",{_create:function(){if(this.element[0]===document.body){this._$html=$("html");
this._$win=$(window);
this._oCacheData={};
this._bIsMac=/mac/.test(navigator.platform.toLowerCase());
this._bIsWinFF=!this._bIsMac&&$.browser.mozilla;
}},_init:function(){this._disableKeyboardScrolling();
this._overflow(false);
},release:function(){this._enableKeyboardScrolling();
this._overflow(true);
},_overflow:function(bVisible){var nScrollTop,oCacheData=this._oCacheData,fChangeHeight;
if(bVisible){this.element.css("overflow-y",oCacheData.element.overflowY);
if(this._$html){this._$html.css("overflow-y",oCacheData.html.overflowY);
if($.browser.mozilla||this._bIsMac){this._$html.css({position:oCacheData.html.position,width:oCacheData.html.width});
this.element.css({position:oCacheData.element.position,top:oCacheData.element.top,width:oCacheData.element.width});
if(this._bIsMac){this._$html.css("height",oCacheData.html.height);
this.element.css("height",oCacheData.element.height);
this._$win.unbind("resize.stopScroll");
}this._$win.scrollTop(oCacheData.win.scrollTop);
}}}else{oCacheData.element={};
oCacheData.win={};
oCacheData.win.scrollTop=this._$win.scrollTop();
oCacheData.element.overflowY=this.element.css("overflow-y");
if(!this._bIsWinFF){this.element.css("overflow-y","hidden");
}if(this._$html){oCacheData.html={};
oCacheData.html.overflowY=this._$html.css("overflow-y");
this._$html.css("overflow-y","hidden");
if($.browser.mozilla||this._bIsMac){oCacheData.html.position=this._$html.css("position")||"";
oCacheData.html.width=this._$html[0].style.width||"";
oCacheData.element.position=this.element.css("absolute")||"";
oCacheData.element.top=this.element.css("top")||"";
oCacheData.element.width=this.element[0].style.width||"";
this._$html.css({position:"relative",width:"100%"});
this.element.css({position:"absolute",top:-oCacheData.win.scrollTop,width:oCacheData.element.width?oCacheData.element.width:"100%"});
if(this._bIsMac){oCacheData.html.height=this._$html[0].style.height||"";
oCacheData.element.height=this.element[0].style.height||"";
this._$html.css("height","100%");
fChangeHeight=(function($el,$win){return function(){$el.css("height",$win.height()+oCacheData.win.scrollTop);
};
})(this.element,this._$win);
fChangeHeight();
this._$win.bind("resize.stopScroll",fChangeHeight).trigger("resize");
}}}}this._oCacheData=oCacheData;
},_disableKeyboardScrolling:function(){this.element.bind("keydown",this._preventScrolling);
},_enableKeyboardScrolling:function(){this.element.unbind("keydown",this._preventScrolling);
},_preventScrolling:function(e){var keyCode=e.keyCode,keys=$.ui.keyCode;
if(e.type=="keypress"){return;
}if(keyCode===keys.DOWN||keyCode===keys.UP){var $el=$(e.target);
if(!isConsumesKeyboardEvents($el)){e.preventDefault();
}}}});
function isConsumesKeyboardEvents($e){return !($e.is(":button"))&&($e.is(":input")||$e.is("[contentEditable]"));
}$.extend((function(){var _$body,stopScrollBody;
stopScrollBody=function(){if(!_$body){_$body=$(document.body);
}_$body.stopScroll();
};
stopScrollBody.release=function(){if(!_$body){return;
}_$body.stopScroll("release");
};
return{stopScrollBody:stopScrollBody};
})());
})();
/*!!*
 * SWFObject v1.5: Flash Player detection and embed - http://blog.deconcept.com/swfobject/
 *
 * SWFObject is (c) 2007 Geoff Stearns and is released under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 *
 */
if(typeof deconcept=="undefined"){var deconcept=new Object();
}if(typeof deconcept.util=="undefined"){deconcept.util=new Object();
}if(typeof deconcept.SWFObjectUtil=="undefined"){deconcept.SWFObjectUtil=new Object();
}deconcept.SWFObject=function(_1,id,w,h,_5,c,_7,_8,_9,_a){if(!document.getElementById){return;
}this.DETECT_KEY=_a?_a:"detectflash";
this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);
this.params=new Object();
this.variables=new Object();
this.attributes=new Array();
if(_1){this.setAttribute("swf",_1);
}if(id){this.setAttribute("id",id);
}if(w){this.setAttribute("width",w);
}if(h){this.setAttribute("height",h);
}if(_5){this.setAttribute("version",new deconcept.PlayerVersion(_5.toString().split(".")));
}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();
if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true;
}if(c){this.addParam("bgcolor",c);
}var q=_7?_7:"high";
this.addParam("quality",q);
this.setAttribute("useExpressInstall",false);
this.setAttribute("doExpressInstall",false);
var _c=(_8)?_8:window.location;
this.setAttribute("xiRedirectUrl",_c);
this.setAttribute("redirectUrl","");
if(_9){this.setAttribute("redirectUrl",_9);
}};
deconcept.SWFObject.prototype={useExpressInstall:function(_d){this.xiSWFPath=!_d?"expressinstall.swf":_d;
this.setAttribute("useExpressInstall",true);
},setAttribute:function(_e,_f){this.attributes[_e]=_f;
},getAttribute:function(_10){return this.attributes[_10];
},addParam:function(_11,_12){this.params[_11]=_12;
},getParams:function(){return this.params;
},addVariable:function(_13,_14){this.variables[_13]=_14;
},getVariable:function(_15){return this.variables[_15];
},getVariables:function(){return this.variables;
},getVariablePairs:function(){var _16=new Array();
var key;
var _18=this.getVariables();
for(key in _18){_16[_16.length]=key+"="+_18[key];
}return _16;
},getSWFHTML:function(){var _19="";
if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");
this.setAttribute("swf",this.xiSWFPath);
}_19='<embed type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'"';
_19+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';
var _1a=this.getParams();
for(var key in _1a){_19+=[key]+'="'+_1a[key]+'" ';
}var _1c=this.getVariablePairs().join("&");
if(_1c.length>0){_19+='flashvars="'+_1c+'"';
}_19+="/>";
}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");
this.setAttribute("swf",this.xiSWFPath);
}_19='<object id="'+this.getAttribute("id")+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'">';
_19+='<param name="movie" value="'+this.getAttribute("swf")+'" />';
var _1d=this.getParams();
for(var key in _1d){_19+='<param name="'+key+'" value="'+_1d[key]+'" />';
}var _1f=this.getVariablePairs().join("&");
if(_1f.length>0){_19+='<param name="flashvars" value="'+_1f+'" />';
}_19+="</object>";
}return _19;
},write:function(_20){if(this.getAttribute("useExpressInstall")){var _21=new deconcept.PlayerVersion([6,0,65]);
if(this.installedVer.versionIsValid(_21)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);
this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));
document.title=document.title.slice(0,47)+" - Flash Player Installation";
this.addVariable("MMdoctitle",document.title);
}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var n=(typeof _20=="string")?document.getElementById(_20):_20;
n.innerHTML=this.getSWFHTML();
return true;
}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"));
}}return false;
}};
deconcept.SWFObjectUtil.getPlayerVersion=function(){var _23=new deconcept.PlayerVersion([0,0,0]);
if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];
if(x&&x.description){_23=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."));
}}else{if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;
var _26=3;
while(axo){try{_26++;
axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+_26);
_23=new deconcept.PlayerVersion([_26,0,0]);
}catch(e){axo=null;
}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");
}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");
_23=new deconcept.PlayerVersion([6,0,21]);
axo.AllowScriptAccess="always";
}catch(e){if(_23.major==6){return _23;
}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");
}catch(e){}}if(axo!=null){_23=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","));
}}}return _23;
};
deconcept.PlayerVersion=function(_29){this.major=_29[0]!=null?parseInt(_29[0]):0;
this.minor=_29[1]!=null?parseInt(_29[1]):0;
this.rev=_29[2]!=null?parseInt(_29[2]):0;
};
deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major){return false;
}if(this.major>fv.major){return true;
}if(this.minor<fv.minor){return false;
}if(this.minor>fv.minor){return true;
}if(this.rev<fv.rev){return false;
}return true;
};
deconcept.util={getRequestParameter:function(_2b){var q=document.location.search||document.location.hash;
if(_2b==null){return q;
}if(q){var _2d=q.substring(1).split("&");
for(var i=0;
i<_2d.length;
i++){if(_2d[i].substring(0,_2d[i].indexOf("="))==_2b){return _2d[i].substring((_2d[i].indexOf("=")+1));
}}}return"";
}};
deconcept.SWFObjectUtil.cleanupSWFs=function(){var _2f=document.getElementsByTagName("OBJECT");
for(var i=_2f.length-1;
i>=0;
i--){_2f[i].style.display="none";
for(var x in _2f[i]){if(typeof _2f[i][x]=="function"){_2f[i][x]=function(){};
}}}};
if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};
__flash_savedUnloadHandler=function(){};
window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs);
};
window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);
deconcept.unloadSet=true;
}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id];
};
}var getQueryParamValue=deconcept.util.getRequestParameter;
var FlashObject=deconcept.SWFObject;
var SWFObject=deconcept.SWFObject;
(function($){var NjPlaceholder,OPTIONS,jqueryVal,_isFirefox,_isIE,_isIE10,_isNative,_isOldPlh,_isOpera,_isWinSafari,_ua;
if($.fn.njPlaceholder){return;
}_ua=navigator.userAgent.toLowerCase();
_isIE=_ua.indexOf("msie")!==-1;
_isIE10=false;
_isFirefox=_ua.indexOf("firefox")!==-1;
_isOpera=_ua.indexOf("opera")!==-1;
_isWinSafari=navigator.appVersion.match(/windows.*\ version\/5.* safari\/5/i)?true:false;
_isNative=!_isIE&&!_isFirefox&&!_isOpera&&!_isWinSafari;
_isOldPlh=_isIE10;
OPTIONS={css:"ExPlaceholder",autoTrim:true};
NjPlaceholder=function(el,options){var $s,o;
this.options=$.extend({},OPTIONS,options);
this.$el=$(el);
o=this.options;
$s=null;
this.$el.removeClass(o.css);
if(this.$el.val().length===0){this._show();
}if(_isOldPlh){this._setOldPlaceholder();
}else{this._setNewPlaceholder();
}return this;
};
jqueryVal=$.fn.val;
$.fn.val=function(s){var res,_MyNjPlaceholder;
_MyNjPlaceholder=this.data("MyNjPlaceholder");
if(_MyNjPlaceholder){if(s!=null){_MyNjPlaceholder.setValue(s);
res=this;
}else{res=_MyNjPlaceholder.getValue();
}}else{res=jqueryVal.apply(this,arguments);
}return res;
};
NjPlaceholder.prototype={_setNewPlaceholder:function(){var o,_this=this;
o=this.options;
this.$el.bind("focus.njPlaceholder",function(){if(_this.$el.hasClass(o.css)){return _this._caretTop();
}}).bind("keyup.njPlaceholder",function(){if(_this.getValue().length<1){_this._show();
return _this._caretTop();
}}).bind("keydown.njPlaceholder",function(e){var isPlaceholder,keycode,vLength,value;
isPlaceholder=_this.$el.hasClass(o.css);
value=_this.getValue();
vLength=e.keyCode===8||e.keyCode===46?value.length-1:value.length+1;
keycode=e.keyCode;
if(isPlaceholder&&(keycode===37||keycode===38||keycode===39||keycode===40||keycode===16||keycode===17||keycode===18)){return false;
}if(!isPlaceholder&&vLength<1){return _this.$el.addClass(o.css);
}else{if(isPlaceholder&&vLength>0){return _this._hide(value);
}}});
if(!_isNative){this.$el.bind("blur.njPlaceholder",function(){if(_this.getValue().length<1){return _this._show();
}}).bind("mouseup.njPlaceholder",function(){if(_this.$el.hasClass(o.css)){return _this._caretTop();
}});
}return this;
},_setOldPlaceholder:function(){var o,_this=this;
o=this.options;
return this.$el.bind("focus.njPlaceholder",function(){if(_this.$el.hasClass(o.css)){return _this._hide("");
}}).bind("blur.njPlaceholder",function(){if(!_this.$el.hasClass(o.css)&&_this.getValue().length===0){return _this._show();
}});
},_show:function(){var o,_phValue;
o=this.options;
this.$el.addClass(o.css);
_phValue=this._getPlaceholder();
if(o.explaceholder){$(o.explaceholder).addClass(o.css).text(_phValue);
}if(_isNative){return this;
}if(_phValue){this._val(_phValue);
}return this;
},_hide:function(value){var o;
o=this.options;
this.$el.removeClass(o.css);
if(o.explaceholder){$(o.explaceholder).removeClass(o.css).text(value);
}if(_isNative){return this;
}if(value!==void 0){this._val(value);
}return this;
},_getPlaceholder:function(){return this.$el.attr("placeholder")||this.$el.data("input_text")||null;
},_caretTop:function(){var Caret,_el,_this=this;
if(_isNative){return this;
}_el=this.$el[0];
if(_el.setSelectionRange){setTimeout(function(){var e;
try{return _el.setSelectionRange(0,0);
}catch(_error){e=_error;
}},1);
}else{if(_el.createTextRange){Caret=_el.createTextRange();
Caret.collapse();
Caret.moveEnd("character",0);
Caret.moveStart("character",0);
Caret.select();
}}return this;
},destroy:function(){this.$el.unbind("focus.njPlaceholder").unbind("blur.njPlaceholder").unbind("keydown.njPlaceholder").unbind("keyup.njPlaceholder").unbind("mouseup.njPlaceholder");
return this;
},_val:function(){var res;
res=jqueryVal.apply(this.$el,arguments);
return res;
},getValue:function(){var isPlaceholder,o,phValue,value;
o=this.options;
value=this._val();
phValue=this._getPlaceholder();
isPlaceholder=this.$el.hasClass(o.css);
value=phValue&&isPlaceholder?value.replace(phValue,""):this._val();
return value;
},setValue:function(s){this._val(s);
if(s.length===0){this._show();
}else{this._hide();
}return this;
},clearValue:function(){this._val("").blur();
this._show();
return this;
},changePlaceholder:function(text){if(this.$el[0].placeholder!=null){this.$el.attr("placeholder",text);
}else{this.$el.data("input_text",text);
}if(this.getValue().length===0){this._show();
}return this;
}};
$.extend($.fn,{njPlaceholder:function(options,attr1){var isTrim,value,_MyNjPlaceholder,_this=this;
_isIE10=$.fn.njPlaceholder.isIe10;
_isOldPlh=_isIE10;
if(options==="getValue"){_MyNjPlaceholder=this.eq(0).data("MyNjPlaceholder");
value=_MyNjPlaceholder.getValue();
isTrim=_MyNjPlaceholder.options.autoTrim;
if(isTrim){return fnMatome.trim(value,true);
}else{return value;
}}else{if(options==="setValue"||options==="clearValue"||options==="changePlaceholder"){attr1=attr1?attr1:"";
this.each(function(i,s){var $s;
$s=$(s);
_MyNjPlaceholder=$s.data("MyNjPlaceholder");
return _MyNjPlaceholder[options](attr1);
});
return this;
}else{if(options==="destroy"){this.each(function(i,s){var $s;
$s=$(s);
_MyNjPlaceholder=$s.data("MyNjPlaceholder");
if(_MyNjPlaceholder){_MyNjPlaceholder.destroy();
return _MyNjPlaceholder=null;
}});
return this;
}else{this.each(function(i,s){var $s;
$s=$(s);
_MyNjPlaceholder=$s.data("MyNjPlaceholder");
_MyNjPlaceholder=new NjPlaceholder($s,options);
$s.data("MyNjPlaceholder",_MyNjPlaceholder);
});
return this;
}}}},njGetPlaceholderValue:function(){var isTrim,value,_MyNjPlaceholder;
_MyNjPlaceholder=this.eq(0).data("MyNjPlaceholder");
if(_MyNjPlaceholder){value=_MyNjPlaceholder.getValue();
isTrim=_MyNjPlaceholder.options.autoTrim;
if(isTrim){return fnMatome.trim(value,true);
}else{return value;
}}else{return this.eq(0).val();
}},njSetPlaceholderValue:function(s){this.each(function(){var $el,_MyNjPlaceholder;
$el=$(this);
_MyNjPlaceholder=$el.data("MyNjPlaceholder");
if(_MyNjPlaceholder){return _MyNjPlaceholder.setValue(s);
}else{return $el.val(s);
}});
return this;
},njChangePlaceholder:function(phValue){var _this=this;
this.each(function(i,s){var $s,_MyNjPlaceholder;
$s=$(s);
_MyNjPlaceholder=$s.data("MyNjPlaceholder");
if(_MyNjPlaceholder){return _MyNjPlaceholder.changePlaceholder(phValue);
}});
return this;
},njClearPlaceholder:function(){var _this=this;
this.each(function(i,s){var $s,_MyNjPlaceholder;
$s=$(s);
_MyNjPlaceholder=$s.data("MyNjPlaceholder");
if(_MyNjPlaceholder){return _MyNjPlaceholder.clearValue();
}});
return this;
}});
eval("/*@cc_on\n@if(@_jscript_version == 10)\n	$.fn.njPlaceholder.isIe10 = true;\n@end\n@*/");
$.fn.njPlaceholder.isIe10=$.fn.njPlaceholder.isIe10===true?true:false;
})(jQuery);
(function($){$.widget("ui.watchinput",{lastVal:"",timer:null,_create:function(){var self=this;
self.disable(false);
if(typeof document.activeElement!="unknown"&&document.activeElement==this.element[0]){setTimeout($.proxy(self._focus,self),0);
}},disable:function(isDisable){var self=this;
if(isDisable){clearInterval(this.timer);
this.element.unbind("blur",self._blur).unbind("focus",self._focus).unbind("keypress",self._keypress);
}else{this.lastVal=this.element.val();
this.element.bind("blur",$.proxy(self._blur,self)).bind("focus",$.proxy(self._focus,self)).bind("keypress",$.proxy(self._keypress,self));
}},_keypress:function(event){if(event.keyCode>=112&&event.keyCode<=123){return;
}this._watchAndFire(event);
},_blur:function(event){setTimeout($.proxy(this._watchAndFire,this),0);
clearInterval(this.timer);
},_focus:function(event){var self=this;
this.lastVal=this.element.val();
this.timer=setInterval($.proxy(self._watchAndFire,self),200);
},_watchAndFire:function(event){var self=this;
if(this.element.val()==this.lastVal){return false;
}this.lastVal=this.element.val();
setTimeout(function(){self._trigger("input",event,{value:self.element.val()});
},0);
return true;
}});
}(jQuery));
(function($){window.__tmpFunc={};
nj.directUploader={fileFilter:function(){return[["Images (*.jpg, *jpeg, *.gif, *.png)","*.jpg;*.jpeg;*.gif;*.png;"]];
}};
$.widget("ui.njUploader",(function(){var WIDGET_NAME="ui.njUploader";
var CONST={NSTAT:{DIRECT_UPLOAD:"NC:directupload",CROP_LAYER:"NA:uploader_crop_layer",CROP_UPLOAD:"NC:cropupload",CROP_SET:"NC:cropset",MULTI_LAYER:"NA:uploader_multi_layer",MULTI_UPLOAD:"NC:multiupload",MULTI_SET:"NC:multiset"},TEMPLATE:{DIRECT:'<span id="_nj_uploader_direct_swf" class="_nj_uploader_direct_div" style="position: absolute; width: %directWidht%px; margin-left: -35.5px; overflow: hidden; z-index: 10000; opacity: 1;"></span>',DIRECT_INPUT:'<input class="_nj_uploader_direct_input" type="file" name="Filedata"  style="font-size: 14px; width: 100%; height: 100%; position: absolute; top: 0px; right: 0px; cursor: pointer;" />',CROP:function(sServer){return'<div  class="layerTemplate cropper" id="cropLayer" data-na="'+CONST.NSTAT.CROP_LAYER+'"><div class="shadow"><div class="shadowSide"><div class="subLayerTemplate"><h3>画像アップロード</h3><div class="layerContents" id="layerContent"><ul><li>画像アップロード後、画面に表示された <img height="15" width="12" alt="" src="'+sServer+'/matome_ver4/img/js/njUploader/cropper_ico_pointer.gif"/> 部分をマウスでドラッグして、切り取りたい領域を選択してください。</li><li class="attention">著作権や他人の権利を侵害する画像をアップロードした場合、利用規約および関連法規により処罰を受けることがあります。</li></ul><div class="btnImgSelect"><img class="_jWriteImageUploadBtn1" height="24" width="95" alt="アップロード" src="'+sServer+'/matome_ver4/img/common/btn_upload.png"/></div><div class="cropperColgroup"><div class="preViewArea"><div class="crop_preview"><img id="_nj_uploader_crop_preview" alt="" src="'+sServer+'/myAdmin/img/cropper_blank.gif"/></div><h4>選択領域プレビュー</h4><h5>画像編集ヘルプ</h5><ul><li><img height="11" width="11" alt="" src="'+sServer+'/matome_ver4/img/js/njUploader/cropper_ico_position.gif"/> 選択領域表示</li><li><img height="11" width="11" alt="" src="'+sServer+'/matome_ver4/img/js/njUploader/cropper_ico_move.gif"/> 選択領域移動</li><li><img height="11" width="11" alt="" src="'+sServer+'/matome_ver4/img/js/njUploader/cropper_ico_size.gif"/> 大きさ調節</li></ul></div><div class="bgCropper"><div class="img_cropper"><p>1024KB未満の　JPG、JPEG、GIF、PNGファイルだけアップロードできます。</p><div class="img_scroll"><img alt="" src="'+sServer+'/matome_ver4/img/js/njUploader/blank.gif" class="background"/></div><img height="" width="" alt="" class="mask" src="'+sServer+'/matome_ver4/img/js/njUploader/blank.gif"/><div class="crop_area jsCrop drag"><div class="crop_object"><img alt="" src="'+sServer+'/matome_ver4/img/js/njUploader/blank.gif"/></div><button class="drag_point top_left jsCrop resize" type="button">カット調節点 1 北西</button><button class="drag_point top_right jsCrop resize" type="button">カット調節点 2 北東</button><button class="drag_point bottom_left jsCrop resize" type="button">カット調節点 3 南西</button><button class="drag_point bottom_right jsCrop resize" type="button">カット調節点 4 南東</button></div><img class="crop_hidden" alt="hidden" src="'+sServer+'/matome_ver4/img/js/njUploader/blank.gif"/></div></div></div><div class="btns"><button class="btnUpload" data-na="'+CONST.NSTAT.CROP_SET+'"><span>登録</span></button></div></div><a class="layerClose" href="#"><img src="'+sServer+'/matome_ver4/img/js/njUploader/btn_close2.gif" width="19" height="19" alt="閉じる" /></a></div></div></div></div>';
},MULTI:function(sServer){return'<div id="userImageLayer" class="layerTemplate itemEditorImage multiUploader" data-na="'+CONST.NSTAT.MULTI_LAYER+'"><div class="shadow"><div class="shadowSide"><div class="subLayerTemplate"><div class="uploadStatus"><span class="statusWrapper"></span><p>画像アップロード中<span class="uploadStatusInfo"><em>4</em>/20</span></p></div><div class="uploadStatus02" style="display:none;"><span class="statusWrapper"></span><p><span class="uploadStatus02Loading"></span>アイテム追加中</p></div><h3>画像を追加する</h3><div class="layerContents"><dl><dt class="multiUpload">画像のアップロード</dt><dd class="multiUpload"><ul class="note"><li>1枚あたり10MB未満の画像のみ対応しています。<a href="http://help.naver.jp/faq?itemNo=429">対応フォーマットはこちら</a></li><li class="attention">著作権や他人の権利を侵害する画像をアップロードした場合、利用規約および関連法規により処罰を受けることがあります。</li></ul><div class="btnUpload"><div style="position: absolute; overflow: hidden;  width: 96px; height: 24px;" id="_jFlashUploader"></div><img src="'+sServer+'/matome_ver4/img/common/btn_upload.png" width="95" height="24" alt="ファイルを選択"></div><ol class="imagesList"></ol><p class="locationSetting"><label><input type="checkbox" />画像に含まれる位置情報を表示する</label></p></dd><dt class="imageTitle">画像タイトル</dt><dd class="imageTitle"><div class="inTxtWrapper"><input type="text" placeholder="タイトルを入力してください"></div></dd><dt class="introduction">紹介コメント</dt><dd class="introduction"><div class="inTxtWrapper"><textarea  cols="20" rows="3" placeholder="紹介コメントを入力してください"></textarea></div></dd></dl><p class="note">画像タイトルと紹介コメントは、追加される全ての画像で共通となります。</p><div class="btns"><button class="btnEnd"  data-na="'+CONST.NSTAT.MULTI_SET+'"><span>完了</span></button></div></div><a href="#" class="layerClose"><img src="'+sServer+'/matome_ver4/img/js/njUploader/btn_close2.gif" alt="閉じる"></a></div></div></div></div>';
}},upload:{FILE_TYPE:[["Images (*.jpg, *jpeg, *.gif, *.png, *.bmp, その他)","*.jpg;*.jpeg;*.gif;*.png;*.bmp;*.pcx;*.ras;*.pbm;*.pgm;*.ppm"]]},MESSAGE:{REQUIRED:"タイトルを入力してください。",SELECT_IMAGE:"「ファイルを選択」ボタンをクリックして、登録する画像を選んでください。",OVER_TITLE:"タイトルは、100文字以内で入力してください。",OVER_COMMENT:"紹介コメントは、300文字以内で入力してください。",OVER_URL:"URLは、500文字以内で入力してください。",UPLOAD_EXT:"%SIZE%未満のJPG、JPEG、GIF、PNGのみに対応しています。",UPLOAD_FAIL:"アップロードに失敗した画像があります。"}};
var _flashSrc=/alpha/.test(location.host)?"http://static.alpha.naver.jp/matome_ver4/swf/naver_multiUploader_1.0.1.swf":"http://static.naver.jp/matome_ver4/swf/naver_multiUploader_1.0.1.swf";
return{options:{mode:"direct",_parentMode:"",fileSizeMax:10485760,url:"/media/upload",cropSize:"95x95",mode:"multi",flashVars:{},flashSize:{w:"100%",h:"100%"},onUploadComplete:undefined,onUploadError:function(e,res){alert(CONST.MESSAGE.UPLOAD_FAIL);
},onFileSelect:undefined,submit:function(){alert("submit");
}},_oUploader:undefined,_uploadFlash:undefined,_uploadBtn:undefined,_template:undefined,_cropImageSize:undefined,_cropLayer:undefined,failFileName:[],_create:function(){var self=this,element=this.element;
this._uploadBtn=$(element);
this._uploadBtn.bind("click.njUploader",function(e){e.preventDefault();
});
switch(this.options.mode){case"direct":this._setDirect();
break;
case"crop":this._setCrop();
break;
case"multi":this._setMulti();
break;
default:break;
}},_destroy:function(){var self=this;
nj.directUploader["call"+self._h+"_success"]=undefined;
nj.directUploader["call"+self._h+"_error"]=undefined;
nj.directUploader["time"+self._h]=undefined;
},_setDirect:function(){var self=this,o=this.options;
var uploadBtn=this._uploadBtn;
this._uploadBtn.before(CONST.TEMPLATE.DIRECT);
var _njUDiv=this._uploadBtn.prev();
var $base=$(".lyContentsWrap");
var nBaseLeft=0;
var nBaseMarginLeft=0;
if(!$base.length){$base=$(".LyContents");
nBaseLeft=12.5;
nBaseMarginLeft=this._uploadBtn.width()/2*-1;
}if(o._parentMode=="crop"){nBaseLeft=$base.hasClass("lyContentsWrap")?0:this._uploadBtn.width()/2;
}else{nBaseLeft+=this._uploadBtn.offset().left-$base.offset().left;
}var _h=new Date().getTime();
this._h=_h;
_njUDiv.attr("id",_njUDiv.attr("id")+_h);
_njUDiv.css({width:this._uploadBtn.width(),marginLeft:nBaseMarginLeft,height:this._uploadBtn.height(),left:nBaseLeft});
nj.directUploader["call"+_h+"_success"]=$.proxy(this._directUploadComplete,self);
nj.directUploader["call"+_h+"_error"]=$.proxy(this.options.onUploadError,self);
nj.directUploader["call"+_h+"_select"]=$.proxy(this._selectFileInfo,this);
nj.directUploader["time"+_h]=_h;
var sServer=(typeof STATIC_SERVER!=="undefined")?STATIC_SERVER:"";
var eUser=(typeof encodeUser!=="undefined")?"&s="+encodeUser:"";
var encodeUrl=encodeURIComponent((o.url==="/media/upload"?"http://"+location.host+"/media/upload?m=json"+eUser:o.url));
var buttonImageURL=$.browser.msie?sServer+"/matome_ver4/img/common/btn_upload.png":"";
var oFlashVars=$.extend({isDirectUpload:false,isSingleUploader:true,fuCall_getFileTypesFunc:"nj.directUploader.fileFilter",fuCall_getSendDataFunc:"",fuCall_errorMessageFunc:"nj.directUploader.call"+_h+"_error",fuCall_selectFileInfoFunc:"nj.directUploader.call"+_h+"_select",fuCall_uploadStartFileInfoFunc:"",fuCall_uploadProgressFileInfoFunc:"",fuCall_uploadCompleteFileInfoFunc:"",fuCall_uploadCompleteReturnDataFunc:"nj.directUploader.call"+_h+"_success",maxUploadFileCount:1,buttonImageURL:buttonImageURL,uploadURL:encodeUrl},o.flashVars);
var _fvars=[];
$.each(oFlashVars,function(key){_fvars.push(key+"="+this);
});
var sos=new SWFObject(_flashSrc,"directUploader"+_h,this._uploadBtn.width(),this._uploadBtn.height(),"9.0.0");
var nstat=(o._parentMode=="crop")?CONST.NSTAT.CROP_UPLOAD:CONST.NSTAT.DIRECT_UPLOAD;
sos.addParam("data-na",nstat);
sos.addParam("FlashVars",_fvars.join("&amp;"));
sos.addParam("menu","false");
sos.addParam("loop","false");
sos.addParam("quality","high");
if(!$.browser.msie){sos.addParam("wmode","transparent");
}sos.addParam("swLiveConnect","true");
sos.addParam("allowFullScreen","true");
sos.addParam("allowScriptAccess","always");
sos.write($("#_nj_uploader_direct_swf"+_h)[0]);
this._uploadFlash=$("#directUploader"+_h)[0];
},getFlash:function(){return this._uploadFlash;
},uploadStart:function(){this._uploadFlash.uploadStart();
},uploadCancel:function(){this._uploadFlash.uploadCancel();
},_directUploadComplete:function(res){if(this.isSizeOk){var self=this;
var _res=$.parseJSON(res);
self._callback_func(_res);
}},_selectFileInfo:function(res){var self=this,o=this.options;
var size=(o.fileSizeMax==10485760)?"10MB":"1024KB";
var isSizeOk=true;
this.failFileName=[];
$.each(res,function(){if(parseInt(this.fileSize)>=o.fileSizeMax){self.failFileName.push(this.name);
setTimeout(function(){self._alert(CONST.MESSAGE.UPLOAD_EXT.replace("%SIZE%",size));
},1);
isSizeOk=false;
}});
this.isSizeOk=isSizeOk;
if(isSizeOk){setTimeout($.proxy(function(){this._uploadFlash.uploadStart();
},this),0);
}else{this._uploadFlash.uploadCancel();
return false;
}},setDirectButton:function(button){var _b=(typeof button!="undefined")?button:this._uploadBtn;
var bleft=_b.offset().left-$(".LyContents").offset().left+12.5;
_b.prev().css({width:_b.width(),marginLeft:_b.width()/2*-1,height:_b.height(),left:bleft,top:_b[0].offsetTop});
},_setCrop:function(){var self=this,o=this.options,uploadBtn=this._uploadBtn,sServer=(typeof STATIC_SERVER!="undefined")?STATIC_SERVER:"";
uploadBtn.bind("click.njUploader",function(e){var cropLayer=CONST.TEMPLATE.CROP(sServer).replace("%cropSize%",o.cropSize);
var layerLeft=($("body").width()-622)/2;
var layerTop=($("html, body").scrollTop()+40);
var getImageSize=function(oiw,oih,_oiw,_oih){var riw=oiw,rih=oih,riw525=true,rih350=true;
var oScaledSize=nj.getScaledSize({width:riw,height:rih},{width:525,height:350});
return{height:oScaledSize.height,width:oScaledSize.width,originalHeight:oih,originalWidth:oiw,ratio:(oiw/oScaledSize.width)};
};
var _uploadComplate=function(res){self.cropImageFileName=res.fileName;
self.cropImageThumbnailUrl=res.thumbnailUrl;
if($("#_nj_uploader_crop_image").length>0){$(".jcrop-holder").remove();
$("#_nj_uploader_crop_image").remove();
}$("#_nj_uploader_crop_preview").attr("src","");
var _iw=parseInt(res.imageResolution.split("x")[0]);
var _ih=parseInt(res.imageResolution.split("x")[1]);
var _oiw=parseInt(o.cropSize.split("x")[0]);
var _oih=parseInt(o.cropSize.split("x")[1]);
if(_iw<=_oiw||_ih<=_oih){self.isCrop=false;
$(".crop_preview").html('<img id="_nj_uploader_crop_preview" src='+res.url+' style="width:95px;height:95px;left0;top0">');
}else{self.isCrop=true;
var imgSize=self._cropImageSize=getImageSize(_iw,_ih,_oiw,_oih);
$(".img_cropper").prepend('<img id="_nj_uploader_crop_image" src='+res.url+' style="width:'+imgSize.width+"px;height:"+imgSize.height+'px;left0;top0">');
self.previewImage=$("#_nj_uploader_crop_preview");
self.previewImage.attr("src",res.url);
self.previewImage.css({width:imgSize.width,height:imgSize.height});
self.jcrop=$.Jcrop("#_nj_uploader_crop_image",{setSelect:[0,0,_oiw,_oih],minSize:[Math.min(Math.max(Math.ceil(_oiw/imgSize.ratio),15),_oiw),Math.min(Math.max(Math.ceil(_oih/imgSize.ratio),15),_oih)],sideHandles:false,onChange:$.proxy(self.showPreview,self),onSelect:$.proxy(self.showPreview,self),aspectRatio:1,allowSelect:false});
$(".img_cropper p").remove();
}};
self._cropLayer=$.modal(cropLayer,{opacity:80,dataCss:{width:672,height:607},overlayCss:{backgroundColor:"#000000"},onShow:function(dialog){$(".simplemodal-wrap").css({overflow:"visible"});
if(self.options.prevUpload){_uploadComplate(self.options.prevUpload);
}}});
var oFlashVars={buttonImageURL:sServer+"/matome_ver4/img/common/btn_upload.png"};
$("._jWriteImageUploadBtn1").njUploader({mode:"direct",_parentMode:"crop",url:"/media/upload",fileSizeMax:1048576,onFileSelect:function(res){self._selectFileInfo(res);
},onUploadError:function(e,res){var failFileName=CONST.MESSAGE.UPLOAD_FAIL;
if(typeof this.failFileName!="undefined"){if(this.failFileName.length>0){failFileName+="\n・"+this.failFileName.join("\n");
}}alert(failFileName);
},onUploadComplete:function(e,res){if(res.result=="false"){self._trigger("onUploadError",null,res);
return false;
}_uploadComplate(res);
self._trigger("onUploadComplete",null,res);
}});
$(".btnUpload").bind("click.njUploader",function(e){if(typeof self.cropImageFileName=="undefined"){alert(CONST.MESSAGE.SELECT_IMAGE);
return;
}if(self.isCrop){var data={fileName:self.cropImageFileName,height:Math.floor(self._cropArea.h*self._cropImageSize.ratio),width:Math.floor(self._cropArea.w*self._cropImageSize.ratio),x:Math.floor(self._cropArea.x*self._cropImageSize.ratio),y:Math.floor(self._cropArea.y*self._cropImageSize.ratio)};
$.ajax({type:"POST",dataType:"json",url:"/media/crop",data:data,success:function(res){self._trigger("submit",null,res);
$.each(self._cropLayer.d,function(){if(this.hide){this.hide();
}});
},error:function(res){}});
}else{self._trigger("submit",null,{url:self.cropImageThumbnailUrl,result:true});
$.each(self._cropLayer.d,function(){if(this.hide){this.hide();
}});
}});
$(".layerClose").click(function(e){e.preventDefault();
self._cropLayer.close();
});
});
},_setMulti:function(){var self=this,o=this.options,uploadBtn=this._uploadBtn,sServer=(typeof STATIC_SERVER!="undefined")?STATIC_SERVER:"",headTitleTxt=document.title;
o.flashVars.uploadURL+=encodeURIComponent("&wl=true");
var _loadApi=$.extend(new nj.matome.common.RequestClient(),{locationCount:function(o){return this.request({requester:"rest",method:"get",url:nj.common.getAPI("MATOME_EDIT.LOCATION.COUNT",o)});
}});
uploadBtn.bind("click.njUploader",function(e){e.preventDefault();
var multiLayer=CONST.TEMPLATE.MULTI(sServer);
var layerLeft=($("body").width()-622)/2;
var layerTop=($("html, body").scrollTop()+40);
self._multiLayer=$.modal(multiLayer,{opacity:80,dataCss:{width:672,height:607},overlayCss:{backgroundColor:"#000000"},onShow:function(dialog){$(".simplemodal-wrap").css({overflow:"visible"});
},onClose:function(dialog){var _elFlash=$("#multiUploader")[0];
_elFlash.uploadCancel();
if(nj.matome.mtmMultiUploader){nj.matome.mtmMultiUploader.uploadedFile=0;
}$.modal.close();
}});
$("input",$(".imageTitle")).njPlaceholder();
$("textarea",$(".introduction")).njPlaceholder();
$("#simplemodal-container").css({width:622});
var _fvars=[];
$.each(o.flashVars,function(key){_fvars.push(key+"="+this);
});
var _h=new Date().getTime();
var so=new SWFObject(_flashSrc,"multiUploader",o.flashSize.width,o.flashSize.height,"9.0.0");
so.addParam("data-na",CONST.NSTAT.MULTI_UPLOAD);
so.addParam("FlashVars",_fvars.join("&amp;"));
so.addParam("menu","false");
so.addParam("loop","false");
so.addParam("quality","high");
so.addParam("wmode","transparent");
so.addParam("swLiveConnect","true");
so.addParam("allowFullScreen","true");
so.addParam("allowScriptAccess","always");
so.write("_jFlashUploader");
document.title=headTitleTxt;
$(".layerClose").click(function(e){e.preventDefault();
self._multiLayer.close();
});
$("li",$(".imagesList")).live("mouseover.njUploader",function(e){$(this).addClass("hover");
});
$("li",$(".imagesList")).live("mouseout.njUploader",function(e){$(this).removeClass("hover");
});
$("p.locationSetting input").bind("change.njUploader",function(e){var $locationInput=$(this);
$locationInput.data("restCount",null);
if($locationInput.attr("checked")===undefined){return;
}_loadApi.locationCount({missionId:o.missionId}).success(function(oResult){var restCount=1000-oResult;
$locationInput.data("restCount",restCount);
if(restCount<=18){return nj.common.message.alert("MATOME_EDIT.LOCATION_OVER_UPLOAD",{num:restCount});
}});
}).data("restCount",null);
$(".btnEnd").bind("click.njUploader",function(e){e.preventDefault();
$("input",$(".imageTitle")).triggerHandler("focus.njPlaceholder");
$("textarea",$(".introduction")).triggerHandler("focus.njPlaceholder");
var _info=$(".info");
var _data=[];
var _titleInput=$("input",$(".imageTitle")),_introText=$("textarea",$(".introduction"));
var _title=(_titleInput.njGetPlaceholderValue())?_titleInput.njGetPlaceholderValue():"";
var _des=(_introText.njGetPlaceholderValue())?_introText.njGetPlaceholderValue():"";
var _location=$("p.locationSetting input").data("restCount");
document.title=headTitleTxt;
if(_title.length>100){alert(CONST.MESSAGE.OVER_TITLE);
return false;
}if(_des.length>300){alert(CONST.MESSAGE.OVER_COMMENT);
return false;
}var _cleateItemData={options:{title:null,description:null,locationCount:0,data:[]},init:function(oOptions){var options=$.extend(this.options,oOptions);
this._itemLength=options.data.length;
this._i=0;
this._butLatlng="0";
this._result=[];
if(this._itemLength===0){alert(CONST.MESSAGE.SELECT_IMAGE);
return false;
}else{$(".uploadStatus02").show();
return this._cleateData();
}},_cleateData:function(){var that=this,options=this.options,res=$.parseJSON(decodeURIComponent($(options.data[this._i]).val())),locationFlag=(options.locationCount===undefined||options.locationCount===null||this._i>=options.locationCount||res.lat===this._butLatlng||res.lng===this._butLatlng);
if(locationFlag){this._pushData(res,null);
return this._checkEnd();
}else{$.gmapV3.load();
$.gmapV3.ready(function(){nj.gmaps.geocoder({lat:res.lat,lng:res.lng,success:function(oResult){that._pushData(res,oResult[0]);
return that._checkEnd();
},error:function(status){if(status==="OVER_QUERY_LIMIT"){setTimeout(function(){return that._cleateData();
},200);
}else{that._pushData(res,null);
return that._checkEnd();
}}});
});
}},_pushData:function(oData,locationData){var options=this.options;
if(locationData!==null){locationData.zoom=nj.gmaps.setting.zoomLevel.get(locationData.type);
delete locationData.type;
}delete oData.lat;
delete oData.lng;
$.extend(oData,{title:options.title,description:options.description,location:locationData});
this._result.push(oData);
return false;
},_checkEnd:function(){if(this._i<this._itemLength-1){this._i+=1;
return this._cleateData();
}else{this._i+=1;
return this._submitEnd();
}},_submitEnd:function(){self._trigger("submit",null,{result:this._result});
$(".uploadStatus02").hide();
return false;
}};
_cleateItemData.init({title:_title,description:_des,locationCount:_location,data:_info});
return false;
});
});
},showPreview:function(coords){if(coords.w===0&&coords.h===0){var _x=(coords.x===0)?0:coords.x-45;
var _y=(coords.y===0)?0:coords.y-45;
var _x2=(coords.x===0)?45:coords.x;
var _y2=(coords.y===0)?45:coords.y;
this.jcrop.setSelect([_x,_y,_x2,_y2]);
}var rx=95/coords.w;
var ry=95/coords.h;
this.previewImage.css({width:Math.round(rx*this._cropImageSize.width)+"px",height:Math.round(ry*this._cropImageSize.height)+"px",marginLeft:"-"+Math.round(rx*coords.x)+"px",marginTop:"-"+Math.round(ry*coords.y)+"px"});
this._cropArea={w:coords.w,h:coords.h,x:coords.x,y:coords.y};
},_callback_func:function(_res){if(_res.result=="true"){this._trigger("onUploadComplete",null,_res.qa);
}else{this._trigger("onUploadError",null,_res);
}},_alert:function(sMessage){this._uploadFlash.uploadCancel();
setTimeout(function(){alert(sMessage);
},300);
}};
})());
})(jQuery);
(function($){$.widget("nj.WidgetBase",{_jqElements:function($elContainer_$sKey,$oReferences_$jqElement){var sDataKey=this.widgetName+"_jqElements",sKey,fn=arguments.callee;
if(!arguments.length){return this.element.data(sDataKey);
}else{if(arguments.length===1&&typeof $elContainer_$sKey==="string"){sKey=$elContainer_$sKey;
return fn.call(this)&&fn.call(this)[sKey];
}else{if(arguments.length>=2){if(typeof $elContainer_$sKey==="string"){sKey=$elContainer_$sKey;
var oNewElementReference=$oReferences_$jqElement,jqElement=oNewElementReference?$(oNewElementReference,arguments[2]||this.element):oNewElementReference;
if(jqElement===null||jqElement===undefined||jqElement.length){var oElementReferences=fn.call(this)||this.element.data(sDataKey,{}).data(sDataKey);
if((oElementReferences[sKey]=jqElement)===undefined){delete oElementReferences[sKey];
}return oElementReferences[sKey];
}}else{var jqContainer=$elContainer_$sKey,oReferences=$oReferences_$jqElement;
for(sKey in oReferences){fn.call(this,sKey,oReferences[sKey],jqContainer);
}return fn.call(this);
}}}}return undefined;
},_data:function($sKey_$oReferences,$oValue){var sDataKey=this.widgetName+"_data",sKey,fn=arguments.callee;
if(!arguments.length){return this.element.data(sDataKey);
}else{if(arguments.length===1&&typeof $sKey_$oReferences==="string"){sKey=$sKey_$oReferences;
return fn.call(this)&&fn.call(this)[sKey];
}else{if(typeof $sKey_$oReferences==="string"){sKey=$sKey_$oReferences;
var oObjReferences=fn.call(this)||this.element.data(sDataKey,{}).data(sDataKey);
if((oObjReferences[sKey]=$oValue)===undefined){delete oObjReferences[sKey];
}return oObjReferences[sKey];
}else{if(typeof $sKey_$oReferences==="object"){var oNewObjReferences=$sKey_$oReferences;
for(sKey in oNewObjReferences){fn.call(this,sKey,oNewObjReferences[sKey]);
}return fn.call(this);
}}}}return undefined;
},_excuteWidget:function($sKey_$jqElement,$sWidgetName){var jqElement=(typeof $sKey_$jqElement==="string")?this._jqElements($sKey_$jqElement):$sKey_$jqElement;
if(arguments.length===1){return jqElement;
}else{if(jqElement&&typeof(jqElement[$sWidgetName])=="function"){return jqElement[$sWidgetName].apply(jqElement,[].slice.call(arguments,2,arguments.length));
}else{return undefined;
}}}});
})(jQuery);
(function($){$.widget("matome.mtmSearch",(function(WIDGET_NAME){var CONST={CONTENT_TYPE:{IMAGE:{TITLE:"画像",CATEGORY_SELECTOR_VISIBLE:false,TARGET_SELECTOR_STYLE:"TAB",TARGET_SELECTOR_ITEMS:[{name:"NAVER",value:"naver"},{name:"Google",value:"google"},{name:"Flickr",value:"flickr"}],ITEMS_TOTAL_VISIBLE:false,CONTENT_WIDGET_NAME:"mtmSearchImage",CONTENT_DETAIL_WIDGET_NAME:"mtmSearchImageDetail",CONTENT_ITEMS_PER_PAGE:undefined,N_STAT_CODE:"NA:search_layer_image"},VIDEO:{TITLE:"動画",CATEGORY_SELECTOR_VISIBLE:false,TARGET_SELECTOR_STYLE:"TAB",TARGET_SELECTOR_ITEMS:[{name:"NAVER",value:"naver"},{name:"Google",value:"google"},{name:"YouTube",value:"youtube"}],ITEMS_TOTAL_VISIBLE:false,CONTENT_WIDGET_NAME:"mtmSearchVideo",CONTENT_DETAIL_WIDGET_NAME:"mtmSearchVideoDetail",CONTENT_ITEMS_PER_PAGE:undefined,N_STAT_CODE:"NA:search_layer_video"},LINK:{TITLE:"リンク",CATEGORY_SELECTOR_VISIBLE:false,TARGET_SELECTOR_STYLE:"TAB",TARGET_SELECTOR_ITEMS:[{name:"NAVER",value:"naver"},{name:"Google",value:"google"}],ITEMS_TOTAL_VISIBLE:false,CONTENT_WIDGET_NAME:"mtmSearchLink",CONTENT_ITEMS_PER_PAGE:undefined,N_STAT_CODE:"NA:search_layer_link"},TWITTER:{TITLE:"ツイート",CATEGORY_SELECTOR_VISIBLE:false,TARGET_SELECTOR_STYLE:"RADIO",TARGET_SELECTOR_ITEMS:[{name:"ツイート",value:"tweet"},{name:"ユーザー名",value:"userName"}],ITEMS_TOTAL_VISIBLE:false,CONTENT_WIDGET_NAME:"mtmSearchTwitter",CONTENT_ITEMS_PER_PAGE:undefined,N_STAT_CODE:"NA:search_layer_twitter"}},TARGET_SELECTOR_STYLE:{NONE:"NONE",TAB:"TAB",RADIO:"RADIO"},TARGET_SELECTOR_RADIO_LABEL_FOR_PREFIX:WIDGET_NAME+".targetSelectorRadio.",TARGET_SELECTOR_RADIO_INPUT_NAME:WIDGET_NAME+".targetSelectorRadio",VIEW_TYPE:{LIST:0,DETAIL:1},N_STAT_CODE:{ATTRIBUTE:"data-na"}};
var EVENT={ON_OPEN:"onOpen",ON_ITEM_SELECT:"onItemSelect",ON_CLOSE:"onClose"};
var SELECTOR={TYPE_TITLE:"SPAN._jTypeTitle",CATEGORY_SELECTOR:"DIV.MdSelectBox01",QUERY_INPUT:"INPUT.mdSearch01Input01",SEARCH_BUTTON:"INPUT.mdBtn01Search02Btn",BODY:"DIV.mdLayer02Body",TARGET_SELECTOR_TAB:"UL.MdTabMenu01",TARGET_SELECTOR_TAB_SELECTED:"SPAN",TARGET_SELECTOR_TAB_SELECTABLE:"A",TARGET_SELECTOR_RADIO:"DIV.MdTabMenu02",TARGET_SELECTOR_RADIO_SELECTABLE:"INPUT",HEAD_AREA:"DIV.mdLayer02BodyHeadTxtR01",POWERED_BY:"SPAN.mdLayer02PoweredBy01",ITEM_COUNTER_SELECTED:"SPAN.MdCount01",ITEM_COUNTER_SELECTED_TEXT:"SPAN.mdCount01Inner",ITEM_COUNTER_TOTAL:"SPAN._jItemTotalCounter",ITEM_COUNTER_TOTAL_VALUE:"SPAN._jItemTotal",CONTENTS_AREA:"DIV.mdLayer02BodyCont",MORE_BUTTON:"P.mdLayer01BtnMore",MORE_BUTTON_DEFAULT:"A.mdBtn01More01Btn",MORE_BUTTON_PROGRESS:"SPAN.mdBtn01More01Loading",NO_RESULT_TEXT:"P.mdSearchLayer02Txt01",ERROR_TEXT:"P.mdSearchLayer02Txt02",BACK_TO_LIST_BUTTON:"P.mdLayer02BodyHeadTxtL01 > A",ALERT_ITEM_DUPLICATED_CLOSE_BUTTON:"A.mdBtn01Close02Btn"};
var CLASS={CLOSE_BUTTON:"mdBtn01Close01Btn",ITEM_COUNTER_SELECTED_EXIST:"mdCount01OverSize"};
var TEXT={QUERY_INPUT_PLACEHOLDER:"${typeTitle}を検索するキーワードを入力",NO_RESULT_TEXT_DEFAULT_TARGET1:"検索ワード",NO_RESULT_TEXT_DEFAULT_TARGET2:"キーワード",ALERT_EMPTY_QUERY:"検索するキーワードを入力してください。",ALERT_ITEM_ADDITION_LIMIT:"まとめ作成前に追加できる${type}数を超えました。\nこれ以上の${type}追加は、まとめ作成後に行ってください。",ALERT_ERROR:"一時的な問題により実行できませんでした。\nしばらくしてから再度お試しください。"};
var TEMPLATE={SEARCH_LAYER:['<div class="MdLayer02" style="width:912px;" data-na="${nStatCode}">','<div class="mdLayer02Wrap">','<div class="mdLayer02Head">','<fieldset class="MdSearch01 MdCF">',"<legend>検索</legend>",'<div class="mdSearch01H1"><span class="MdFontB"><span class="_jTypeTitle">${typeTitle}</span>を探す</span></div>','<div class="MdSelectBox01">','<div class="mdSelectBox01Search01 njSelectBox-labelContainer">','<span class="mdSelectBox01Search01Label njSelectBox-label">すべて</span>','<span class="mdSelectBox01Search01Ico njSelectBox-opener"></span>',"</div>",'<ul class="mdSelectBox01Option01 njSelectBox-optionContainer" style="display:none;">','<li njselectbox-value="Books">本</li>','<li njselectbox-value="ForeignBooks">洋書</li>','<li njselectbox-value="DVD">DVD</li>','<li njselectbox-value="Music">ミュージック</li>','<li njselectbox-value="Electronics">パソコン・周辺機器</li>','<li njselectbox-value="MusicalInstruments">楽器</li>','<li njselectbox-value="VideoGames">TVゲーム</li>','<li njselectbox-value="Software">PCソフト</li>','<li njselectbox-value="OfficeProducts">文房具・オフィス用品</li>','<li njselectbox-value="Kitchen">ホーム&キッチン</li>','<li njselectbox-value="Grocery">食品&飲料</li>','<li njselectbox-value="HealthPersonalCare">ヘルス&ビューティー</li>','<li njselectbox-value="Beauty">コスメ</li>','<li njselectbox-value="Baby">ベビー&マタニティ</li>','<li njselectbox-value="Toys">おもちゃ</li>','<li njselectbox-value="Apparel">服＆ファッション小物</li>','<li njselectbox-value="Shoes">シューズ＆バッグ</li>','<li njselectbox-value="Jewelry">ジュエリー</li>','<li njselectbox-value="Watches">時計</li>','<li njselectbox-value="SportingGoods">スポーツ&アウトドア</li>','<li njselectbox-value="Automotive">カー＆バイク用品</li>','<li njselectbox-value="Hobbies">ホビー</li>','<li njselectbox-value="HomeImprovement">DIY・工具</li>',"</ul>","<!--/MdSelectBox01--></div>",'<div class="mdSearch01Form01"><input type="text" value="" class="mdSearch01Input01" placeholder="$cursor$を検索するキーワードを入力"></div>','<p class="mdSearch01BtnSearch"><span class="MdBtn01Search02"><input type="button" value="検索" class="mdBtn01Search02Btn" data-na="NC:searchKeyword"></span></p>',"</fieldset>","<!--/mdLayer02Head--></div>",'<div class="mdLayer02Body" style="display:none">','<div class="mdLayer02BodyHead">','<ul class="MdTabMenu01 MdCF" style="display:none">',"</ul>",'<div class="MdTabMenu02" style="display:none">',"</div>",'<div class="mdLayer02BodyHeadTxtR01">追加した<span class="_jTypeTitle">${typeTitle}</span> ','<span class="MdCount01"><span class="mdCount01Inner">0</span></span> 件','<span class="_jItemTotalCounter" style="display:none">/<span class="_jItemTotal">0</span>件</span>',"</div>","<!--/mdLayer02BodyHead--></div>",'<div class="mdLayer02BodyCont mdLayer02Overflow">','<p class="mdLayer01BtnMore" style="display:none;"><span class="MdBtn01More01">','<a class="mdBtn01More01Btn MdLink04" href="#" data-na="NC:viewMore">もっと見る</a>','<span class="mdBtn01More01Loading" style="display:none">読み込み中</span>',"</span></p>",'<p class="mdSearchLayer02Txt01" style="display:none;"></p>','<p class="mdSearchLayer02Txt02" style="margin-top: 288px; display:none;"><span class="mdSearchLayer02Txt02Ico"></span><span class="mdSearchLayer02Txt02Txt">一時的な問題により実行できませんでした。<br>しばらくしてから再度お試しください。</span></p>',"<!--/mdLayer02BodyCont--></div>","<!--/mdLayer02Body--></div>",'<div class="mdLayer02Body" style="display:none">','<div class="mdLayer02BodyHead">','<p class="mdLayer02BodyHeadTxtL01"><a href="#" data-na="NC:backToList">リストへ戻る</a></p>','<div class="mdLayer02BodyHeadTxtR01">追加した<span class="_jTypeTitle">${typeTitle}</span> ','<span class="MdCount01"><span class="mdCount01Inner">0</span></span> 件',"</div>","<!--/mdLayer02BodyHead--></div>",'<div class="mdLayer02BodyCont">','<p class="mdSearchView01BtnMTM">','<a href="#" class="MdBtn02MTM01" data-na="NC:addItem"><span class="mdBtn02MTM01Ico"></span><span class="mdBtn02MTM01Txt">追加する</span></a>','<span class="MdBtn02MTM02" style="display:none;"><span class="mdBtn02MTM02Ico"></span><span class="mdBtn02MTM02Txt">追加済み</span></span>',"</p>",'<div class="_jContentDetailView">','<div class="_jContentContainer" />','<p class="mdSearchView01Pagination">','<a style="height: 700px;" href="#" class="mdSearchView01PaginationPrev" title="前の画像へ" data-na="NC:prevItem"><span>前の画像へ</span></a>','<a style="height: 700px;" href="#" class="mdSearchView01PaginationNext" title="次の画像へ" data-na="NC:nextItem"><span>次の画像へ</span></a>',"</p>","<!--/MdSearchView01--></div>","<!--/mdLayer02BodyCont--></div>","<!--/mdLayer02Body--></div>","<!--/mdLayer02Wrap--></div>",'<p class="mdLayer02BtnClose"><span class="MdBtn01Close01"><a href="#" class="mdBtn01Close01Btn" title="レイヤーを閉じる" data-na="NC:closeSearchLayer">レイヤーを閉じる</a></span></p>',"<!--/MdLayer02--></div>"].join(""),TARGET_SELECTOR_TAB:$.template(null,["<li>",'<span class="mdTabMenu01On" style="display:none">${name}</span>','<a href="#" value="${value}" class="mdTabMenu01Off" data-na="NC:${value}tab">${name}</a>',"</li>"].join("")),TARGET_SELECTOR_RADIO:$.template(null,['<label for="',CONST.TARGET_SELECTOR_RADIO_LABEL_FOR_PREFIX,'${value}" class="mdTabMenu02Chk">','<input type="radio" id="',CONST.TARGET_SELECTOR_RADIO_LABEL_FOR_PREFIX,'${value}" name="',CONST.TARGET_SELECTOR_RADIO_INPUT_NAME,'" value="${value}" data-na="NC:searchKeywordAt_${value}">${name}',"</label>"].join("")),ALERT_SEARCH_PROGRESS:['<div style="left: 700px; top: 17px;" class="MdLayer03">','<div class="mdLayer03Body">','<p class="MdLayer03Txt01"><span class="MdLayer03Loading01"></span><span class="MdFontB">検索中です</span></p>',"<!--/mdLayer03Body--></div>","<!--/MdLayer03--></div>"].join(""),ALERT_ITEM_DUPLICATED:['<div style="left: 415px; top: 17px;" class="MdLayer03">','<div class="mdLayer03Body">','<p class="MdLayer03Txt01"><span class="MdFontB">追加済みの<span class="_jTypeTitle">${typeTitle}</span>です。</span></p>','<p class="mdLayer03BtnClose"><span class="MdBtn01Close02"><a title="閉じる" class="mdBtn01Close02Btn" href="#" data-na="NC:"closeAlertDuplicated">閉じる</a></span></p>',"<!--/mdLayer03Body--></div>","<!--/MdLayer03--></div>"].join(""),NO_RESULT_TEXT:$.template(null,["${target1}",'<span class="MdColor07">「${query}」</span>',"{{if customMessage}}","${customMessage}","{{else}}","に一致する${type}は見つかりませんでした。<br>","${target2}が正しく入力されているかを確認してください。","{{/if}}"].join("")),ITEM_LIST:{IMAGE:'<ul class="MdSearchList01 MdCF">',VIDEO:'<ul class="MdSearchList02 MdCF">',LINK:'<ul class="MdSearchList03">',TWITTER:'<ul class="MdSearchList03">'},POWERED_BY:{google:$.template(null,['<span class="mdLayer02PoweredBy01">','<a href="http://www.google.com/" target="_blank" data-na="NL:url_google"><img src="${STATIC_SERVER}/matome_ver4/img/md/img_mdLayer02PoweredBy01Google.png" alt="Powered by Google" class="mdLayer02PoweredBy01Google"></a>','<span class="MdSeparator01P05">|</span>',"</span>"].join("")),youtube:$.template(null,['<span class="mdLayer02PoweredBy01">','<a href="http://www.youtube.com/" target="_blank" data-na="NL:url_youTube"><img src="${STATIC_SERVER}/matome_ver4/img/md/img_mdLayer02PoweredBy01YouTube.png" alt="Powered by YouTube" class="mdLayer02PoweredBy01YouTube"></a>','<span class="MdSeparator01P05">|</span>',"</span>"].join("")),flickr:$.template(null,['<span class="mdLayer02PoweredBy01">',"This product uses the Flickr API but is not endorsed or certified by Flickr.",'<span class="MdSeparator01P05">|</span>',"</span>"].join(""))}};
return{options:{animation:false,alertDisplayDuration:2000,marginTop:10,minHeight:580,maxHeight:1400,modal:{opacity:50,overlayCss:{backgroundColor:"#000"},focus:true},onOpen:function($e,$oData){},onItemSelect:function($e,$oData){},onClose:function($e,$oData){}},open:function($oOptions){if(!CONST.CONTENT_TYPE[$oOptions.type&&$oOptions.type.toUpperCase()]){return false;
}(this._jqSearchLayer||(this._jqSearchLayer=$(TEMPLATE.SEARCH_LAYER))).modal($.extend({},this.options.modal,{closeClass:CLASS.CLOSE_BUTTON,position:[this.options.marginTop,null],onOpen:this.options.animation?$.proxy(function($oDialog){$oDialog.overlay.fadeIn("fast",$.proxy(function(){$oDialog.container.show().css("top",-100).animate({top:this.options.marginTop+"px"},100);
$oDialog.data.show(1,$.proxy(function(){this._initSearchLayer($oOptions,$oDialog);
},this));
},this));
},this):undefined,onShow:!this.options.animation?$.proxy(function($oDialog){this._initSearchLayer($oOptions,$oDialog);
$.stopScrollBody();
},this):undefined,onClose:$.proxy(function($oDialog){this._clearSearchLayer();
this.options.animation?$oDialog.container.animate({top:-100+"px"},100,null,$.proxy(function(){$oDialog.data.hide();
$oDialog.overlay.fadeOut("fast",$.proxy(function(){$.modal.close();
},this));
})):$.modal.close();
$.stopScrollBody.release();
},this)}));
this._jqSearchLayer.njLayerSupport();
},close:function(){$.modal.close();
},checkItem:function($oSelectedItem,$bIsDuplicated){this._addedItems($oSelectedItem.key,$oSelectedItem.data);
this._excuteContentWidget("checkItem",$oSelectedItem,$bIsDuplicated);
if(!$bIsDuplicated){this._itemCounterSelected(this._itemCounterSelected()+1);
(this._itemAdditionAvailableLength()!=-1)&&this._itemAdditionAvailableLength(this._itemAdditionAvailableLength()-1);
}$oSelectedItem.triggeredByContentDetail&&this._excuteContentDetailWidget("check",$bIsDuplicated);
},showItemDuplicated:function($oSelectedItem){if(this._nAlertDisplayTimeout||this._jqAlertItemDuplicated.parent().length){clearTimeout(this._nAlertDisplayTimeout);
this._nAlertDisplayTimeout=null;
}this._appendAlertWindowToCenter(this._jqAlertItemDuplicated.show());
$(SELECTOR.TYPE_TITLE,this._jqAlertItemDuplicated).text(CONST.CONTENT_TYPE[this._sType].TITLE);
$(SELECTOR.ALERT_ITEM_DUPLICATED_CLOSE_BUTTON,this._jqAlertItemDuplicated).click($.proxy(function($e){$e.preventDefault();
this._removeAlertWindowFromCenter(this._jqAlertItemDuplicated);
},this));
this._nAlertDisplayTimeout=setTimeout($.proxy(function(){this._nAlertDisplayInterval=null;
this._removeAlertWindowFromCenter(this._jqAlertItemDuplicated);
},this),this.options.alertDisplayDuration);
this.checkItem($oSelectedItem,true);
},showError:function($oSelectedItem,$sMessages){alert($sMessages||TEXT.ALERT_ERROR);
},_create:function(){this._jqWindow=$(window);
this._jqDocument=$(document);
},_init:function(){},_initElementReferences:function(){this._jqCategorySelector=$(SELECTOR.CATEGORY_SELECTOR,this._jqSearchLayer);
this._jqQueryInput=$(SELECTOR.QUERY_INPUT,this._jqSearchLayer);
this._jqSearchButton=$(SELECTOR.SEARCH_BUTTON,this._jqSearchLayer);
this._jqBody=$(SELECTOR.BODY,this._jqSearchLayer);
this._jqTargetSelectorTab=$(SELECTOR.TARGET_SELECTOR_TAB,this._jqSearchLayer);
this._jqTargetSelectorRadio=$(SELECTOR.TARGET_SELECTOR_RADIO,this._jqSearchLayer);
this._jqHeadArea=$(SELECTOR.HEAD_AREA,this._jqSearchLayer);
this._jqItemCounterSelected=$(SELECTOR.ITEM_COUNTER_SELECTED,this._jqSearchLayer);
this._jqItemCounterTotal=$(SELECTOR.ITEM_COUNTER_TOTAL,this._jqSearchLayer);
this._jqContentsArea=$(SELECTOR.CONTENTS_AREA,this._jqSearchLayer);
this._jqMoreButton=$(SELECTOR.MORE_BUTTON,this._jqBody[CONST.VIEW_TYPE.LIST]);
this._jqMoreButtonDefault=$(SELECTOR.MORE_BUTTON_DEFAULT,this._jqMoreButton);
this._jqMoreButtonProgress=$(SELECTOR.MORE_BUTTON_PROGRESS,this._jqMoreButton);
this._jqNoResultText=$(SELECTOR.NO_RESULT_TEXT,this._jqBody[CONST.VIEW_TYPE.LIST]);
this._jqErrorText=$(SELECTOR.ERROR_TEXT,this._jqBody[CONST.VIEW_TYPE.LIST]);
this._jqBackToListButton=$(SELECTOR.BACK_TO_LIST_BUTTON,this._jqBody[CONST.VIEW_TYPE.DETAIL]);
this._jqDetailView=$(this._jqContentsArea[CONST.VIEW_TYPE.DETAIL]);
this._jqAlertSearchProgress=$(TEMPLATE.ALERT_SEARCH_PROGRESS);
this._jqAlertItemDuplicated=$(TEMPLATE.ALERT_ITEM_DUPLICATED);
this._bSearchLayerHasInitialized=true;
},_initSearchLayer:function($oOptions,$oDialog){$oOptions=$.extend(true,{type:"",targetSelectorStyle:"",targetSelectorItems:undefined,categorySelectorVisible:undefined,itemsTotalVisible:undefined,opener:null,addedItems:[],itemAdditionLimit:undefined},$oOptions);
!this._bSearchLayerHasInitialized&&this._initElementReferences();
this._oOpener=$oOptions.opener;
this._oSearchLayerDialog=$oDialog;
this._setType($oOptions.type);
this._setTargetSelectorStyle($oOptions.targetSelectorStyle)||this._setTargetSelectorStyle(CONST.CONTENT_TYPE[this._sType].TARGET_SELECTOR_STYLE);
this._setTargetSelectorItems(($oOptions.targetSelectorItems!=undefined)?$oOptions.targetSelectorItems:CONST.CONTENT_TYPE[this._sType].TARGET_SELECTOR_ITEMS);
this._itemCounterSelected(0);
this._setAddedItems(nj.matome.mtmSearchItemParser.getAddedItemsObject(this._sType,$oOptions.addedItems));
this._nItemAdditionLimit=($oOptions.itemAdditionLimit!=undefined)?$oOptions.itemAdditionLimit:(CONST.CONTENT_TYPE[this._sType].ITEM_ADDITION_LIMIT||-1);
this._itemAdditionAvailableLength((this._nItemAdditionLimit>-1)&&(this._nItemAdditionLimit-this._getAddedItemsLength(this._addedItems())));
(($oOptions.categorySelectorVisible!=undefined)?$oOptions.categorySelectorVisible:CONST.CONTENT_TYPE[this._sType].CATEGORY_SELECTOR_VISIBLE)?this._setCategorySelector(true):this._setCategorySelector(false);
(($oOptions.itemsTotalVisible!=undefined)?$oOptions.itemsTotalVisible:CONST.CONTENT_TYPE[this._sType].ITEMS_TOTAL_VISIBLE)?this._itemCounterTotal(this._itemAdditionAvailableLength()):this._itemCounterTotal(false);
this._jqMoreButtonDefault.click($.proxy(function($e){$e.preventDefault();
this._jqMoreButtonDefault.blur();
this._excuteContentWidget("searchMore");
},this));
this._jqBackToListButton.click($.proxy(function($e){$e.preventDefault();
this._viewType(CONST.VIEW_TYPE.LIST);
},this));
this._jqSearchButton.click($.proxy(function($e){this._jqQueryInput.triggerHandler("focus.njPlaceholder");
if(this._sQuery=this._verifyQuery(this._jqQueryInput.njGetPlaceholderValue())){this._search();
}},this));
this._jqQueryInput.keydown($.proxy(function($e){if($e.keyCode==13){this._jqSearchButton.click();
}},this));
this._jqQueryInput.focus($.proxy(function($e){setTimeout($.proxy(function(){this._jqQueryInput.njGetPlaceholderValue()&&this._jqQueryInput.select();
},this),1);
},this)).val(this._sQuery="").focus();
this._jqSearchLayer.attr(CONST.N_STAT_CODE.ATTRIBUTE,CONST.CONTENT_TYPE[this._sType].N_STAT_CODE);
this._jqWindow.resize($.proxy(this._checkLayerScrollable,this)).scroll($.proxy(this._updateLayerPosition,this));
this._checkLayerScrollable();
this._trigger(EVENT.ON_OPEN,null);
},_checkLayerScrollable:function($e){var nWindowHeight=parseInt(this._jqWindow.height(),10);
var nSearchLayerHeight=parseInt(this._jqSearchLayer.outerHeight(),10);
this._bIsLayerVerticalScrollable=nWindowHeight<nSearchLayerHeight+this.options.marginTop;
var nWindowWidth=parseInt(this._jqWindow.width(),10);
var nSearchLayerWidth=parseInt(this._jqSearchLayer.outerWidth(),10);
this._bIsLayerHorizontalScrollable=nWindowWidth<nSearchLayerWidth;
(this._bIsLayerVerticalScrollable||this._bIsLayerHorizontalScrollable)&&this._updateLayerPosition();
},_updateLayerPosition:function($e){var jqModalDialog=this._oSearchLayerDialog.container;
if(this._bIsLayerVerticalScrollable){var nWindowHeight=parseInt(this._jqWindow.height(),10);
var nDocumentHeight=parseInt(this._jqDocument.height(),10);
var nAvailableScrollHeight=nDocumentHeight-nWindowHeight;
if(Boolean(nAvailableScrollHeight)){var nDocumentScrollTop=parseInt(this._jqDocument.scrollTop(),10);
var nScrollTopRate=nDocumentScrollTop/nAvailableScrollHeight*100;
var nLayerHeight=parseInt(this._jqSearchLayer.outerHeight(),10)+this.options.marginTop;
var nLayerScrollHeight=nLayerHeight-nWindowHeight;
var nLayerTop=parseInt(nScrollTopRate*nLayerScrollHeight/100,10);
jqModalDialog.css("top",Math.min(-nLayerTop,0)+this.options.marginTop);
}}if(this._bIsLayerHorizontalScrollable){var nWindowWidth=parseInt(this._jqWindow.width(),10);
var nDocumentWidth=parseInt(this._jqDocument.width(),10);
var nAvailableScrollWidth=nDocumentWidth-nWindowWidth;
if(Boolean(nAvailableScrollWidth)){var nDocumentScrollLeft=parseInt(this._jqDocument.scrollLeft(),10);
var nScrollLeftRate=nDocumentScrollLeft/nAvailableScrollWidth*100;
var nLayerWidth=parseInt(this._jqSearchLayer.outerWidth(),10);
var nLayerScrollWidth=nLayerWidth-nWindowWidth;
var nLayerLeft=parseInt(nScrollLeftRate*nLayerScrollWidth/100,10);
jqModalDialog.css("left",Math.min(-nLayerLeft,0));
}}},_clearSearchLayer:function(){if(!this._bSearchLayerHasInitialized){return;
}var oAddedItems=$.extend(true,{},this._addedItems());
var nAddedLength=this._getAddedItemsLength(oAddedItems);
this._oOpener=null;
this._sContext=null;
this._oSearchLayerDialog=null;
this._itemCounterTotal(false);
this._setAddedItems(null);
this._clearContentsArea();
this._setTargetSelectorStyle(CONST.TARGET_SELECTOR_STYLE.NONE);
this._setTargetSelectorItems();
this._poweredByContextView(null);
this._body(false);
this._bIsLayerVerticalScrollable=this._bIsLayerHorizontalScrollable=false;
this._jqWindow.unbind("resize",this._checkLayerScrollable).unbind("scroll",this._updateLayerPosition);
this._trigger(EVENT.ON_CLOSE,null,{addedItems:oAddedItems,addedLength:nAddedLength});
},_initContentList:function(){this._clearContentsArea();
this._jqContentList=this._getContentWidgetName()&&$(TEMPLATE.ITEM_LIST[this._sType])[this._getContentWidgetName()]({itemsPerPage:CONST.CONTENT_TYPE[this._sType].CONTENT_ITEMS_PER_PAGE,addedItems:this._addedItems(),onSearchProgress:$.proxy(function($e,$oData){$oData.page?this._changeMoreButtonToProgress():this._appendAlertWindowToCenter(this._jqAlertSearchProgress);
},this),onSearchComplete:$.proxy(function($e,$oData){$oData.page?this._changeMoreButtonToDefault():this._removeAlertWindowFromCenter(this._jqAlertSearchProgress);
},this),onSearchResultData:$.proxy(function($e,$oData){this._searchedDataList($oData.dataList);
},this),onSearchResultOverflow:$.proxy(function(){this._hasResultMore(true);
},this),onSearchResultEnd:$.proxy(function(){this._hasResultMore(false);
},this),onSearchNoResult:$.proxy(function($e,$oData){$oData.page?this._hasResultMore(false):(($oData.target1&&$oData.target2)?this._noResultText($oData.query,$oData.target1,$oData.target2,$oData.customMessage):this._noResultText($oData.query));
},this),onSearchError:$.proxy(function($e,$oData){if($oData.page){this._changeMoreButtonToDefault();
alert(TEXT.ALERT_ERROR);
}else{this._removeAlertWindowFromCenter(this._jqAlertSearchProgress);
this._errorText(true);
}},this),onItemSelect:$.proxy(function($e,$oData){if(this._itemAdditionAvailableLength()!=-1&&this._itemAdditionAvailableLength()<=0){alert(nj.replaceStr(this._excuteContentWidget("getAdditionLimitMessage")||TEXT.ALERT_ITEM_ADDITION_LIMIT,{type:CONST.CONTENT_TYPE[this._sType].TITLE,itemAdditionLimit:this._nItemAdditionLimit}));
return;
}this._trigger(EVENT.ON_ITEM_SELECT,null,$.extend({},$oData,{opener:this._oOpener,type:this._sType,triggeredByContentDetail:$e.originalEvent?false:true}));
},this),onItemDetailView:$.proxy(function($e,$oData){var oContentDetailData=this._getContentDetailData($oData.index);
if(oContentDetailData){this._viewType(CONST.VIEW_TYPE.DETAIL);
this._excuteContentDetailWidget("show",oContentDetailData);
}},this)}).prependTo(this._jqContentsArea[CONST.VIEW_TYPE.LIST]);
this._getContentDetailWidgetName()&&this._jqDetailView[this._getContentDetailWidgetName()]({onItemSelect:$.proxy(function($e,$oData){this._excuteContentWidget("selectItem",$oData.index);
},this),onPrev:$.proxy(function($e,$oData){var oContentDetailData=this._getContentDetailData($oData.index-1);
oContentDetailData&&this._excuteContentDetailWidget("show",oContentDetailData);
},this),onNext:$.proxy(function($e,$oData){var nNextIndex=$oData.index+1;
var oContentDetailData=this._getContentDetailData(nNextIndex);
oContentDetailData&&this._excuteContentDetailWidget("show",oContentDetailData);
if(nNextIndex>=this._searchedDataList().length){this._excuteContentWidget("searchMore",$.proxy(function($e){this._excuteContentDetailWidget("show",this._getContentDetailData(nNextIndex));
},this));
}},this)});
this._excuteContentWidget("search",this._sQuery,this._sContext);
},_removeContentList:function(){if(!this._jqContentList){return;
}this._excuteContentWidget("destroy");
this._jqContentsArea.scrollTop(0);
this._jqContentList.remove();
this._jqContentList=null;
},_clearContentsArea:function(){this._removeContentList();
this._hasResultMore(false);
this._noResultText(null);
this._errorText(null);
this._removeAlertWindowFromCenter(this._jqAlertSearchProgress);
this._removeAlertWindowFromCenter(this._jqAlertItemDuplicated);
this._searchedDataList(null);
},_getContentWidgetName:function(){return this._sType?CONST.CONTENT_TYPE[this._sType].CONTENT_WIDGET_NAME:undefined;
},_getContentDetailWidgetName:function(){return this._sType?CONST.CONTENT_TYPE[this._sType].CONTENT_DETAIL_WIDGET_NAME:undefined;
},_excuteContentWidget:function(){if(!this._jqContentList){return;
}var data=this._jqContentList.data("matome-"+this._getContentWidgetName());
if(data&&data[arguments[0]]){return this._jqContentList[this._getContentWidgetName()].apply(this._jqContentList,arguments);
}},_excuteContentDetailWidget:function(){var fnWidgetFunction=this._jqDetailView[this._getContentDetailWidgetName()];
return fnWidgetFunction&&fnWidgetFunction.apply(this._jqDetailView,arguments);
},_verifyQuery:function($sInputtedValue){var sQuery=fnMatome.trim($sInputtedValue,true)||"";
if(!sQuery){alert(TEXT.ALERT_EMPTY_QUERY);
this._jqQueryInput.focus();
}return sQuery;
},_search:function(){if(!this._sQuery){return;
}if(!this._body()){this._body(true,this._initContentList);
}else{this._viewType(CONST.VIEW_TYPE.LIST);
this._initContentList();
}},_searchedDataList:function($aSearchedDataList){if(!arguments.length){return this._aSearchedDataList;
}else{if($aSearchedDataList&&$.isArray($aSearchedDataList)){return this._aSearchedDataList=(this._aSearchedDataList&&$.merge(this._aSearchedDataList,$aSearchedDataList))||$aSearchedDataList;
}else{return this._aSearchedDataList=null;
}}},_setAddedItems:function($oAddedItems){if(!$oAddedItems){return this._addedItems(null);
}for(var k in $oAddedItems){this._addedItems(k,$oAddedItems[k]);
}return this._addedItems();
},_addedItems:function($sKey,$oValue){if(!arguments.length){return this._oAddedItems;
}else{if($sKey){if($oValue){this._oAddedItems=this._oAddedItems||{};
return this._oAddedItems[$sKey]=$oValue;
}else{return this._oAddedItems?this._oAddedItems[$sKey]:undefined;
}}else{return this._oAddedItems=null;
}}},_getAddedItemsLength:function($oAddedItems){var nCount=0;
for(var k in $oAddedItems){nCount++;
}return nCount;
},_getContentDetailData:function($nIndex){var oData=this._searchedDataList()[$nIndex];
if(!oData){return null;
}var nListLength=this._searchedDataList().length;
var bHasResultMore=this._hasResultMore();
var sContentKey=this._excuteContentWidget("getItemByIndex",$nIndex).data("key");
var bIsAdded=(sContentKey&&this._addedItems(sContentKey))?true:false;
return{index:$nIndex,data:oData,listLength:nListLength,hasResultMore:bHasResultMore,isAdded:bIsAdded};
},_setType:function($sType){var sType=$sType&&$sType.toUpperCase();
if(!CONST.CONTENT_TYPE[sType]){return false;
}if(this._jqSearchLayer){var typeTitle=CONST.CONTENT_TYPE[sType].TITLE;
$(SELECTOR.TYPE_TITLE,this._jqSearchLayer).text(typeTitle);
this._jqQueryInput.attr("placeholder",nj.replaceStr(TEXT.QUERY_INPUT_PLACEHOLDER,{typeTitle:typeTitle})).njPlaceholder();
}return this._sType=sType;
},_body:function($bOpen,$fnOnShow){if(!arguments.length){return this._bBodyOpened;
}else{if($bOpen){var fnOpenBody=$.proxy(function(){if(!this._oSearchLayerDialog){return;
}this._jqWindow.resize($.proxy(this._resizeContentArea,this));
this._resizeContentArea();
this._checkLayerScrollable();
this._bBodyOpened=true;
this._nResizeOnOpenTimeout&&clearTimeout(this._nResizeOnOpenTimeout);
this._nResizeOnOpenTimeout=setTimeout($.proxy(function(){if(!this._nResizeOnOpenTimeout){return;
}this._resizeContentArea();
this._checkLayerScrollable();
this._nResizeOnOpenTimeout=null;
},this),100);
$fnOnShow.call(this);
},this);
if(this.options.animation){$(this._jqBody[CONST.VIEW_TYPE.LIST]).slideDown("fast",fnOpenBody);
}else{$(this._jqBody[CONST.VIEW_TYPE.LIST]).show();
fnOpenBody();
}}else{this._jqWindow.unbind("resize",this._resizeContentArea);
this._jqBody.hide();
this._bBodyOpened=false;
}}},_resizeContentArea:function($e){var nContentsAreaHeight=this._getContentsAreaHeight();
this._jqContentsArea.height(nContentsAreaHeight);
this._jqErrorText.css("margin-top",nContentsAreaHeight/2-this._jqErrorText.height()/2);
var nDetailViewWidth=this._jqDetailView.width();
nDetailViewWidth&&this._excuteContentDetailWidget("resize",nDetailViewWidth,nContentsAreaHeight);
},_getContentsAreaHeight:function(){var nWindowHeight=this._jqWindow.height();
var nAvailableHeight=nWindowHeight-(this.options.marginTop*2);
var nCurrentLayerHeight=this._jqSearchLayer.outerHeight();
var nCurrentContentsAreaHeight=this._jqContentsArea.outerHeight();
var nExContentsAreaHeight=nCurrentLayerHeight-nCurrentContentsAreaHeight;
var nLayerHeight=(nAvailableHeight<this.options.minHeight)?this.options.minHeight:(nAvailableHeight>this.options.maxHeight)?this.options.maxHeight:nAvailableHeight;
return nLayerHeight-nExContentsAreaHeight;
},_viewType:function($nViewTypeIndex){if(!arguments.length){return this._nViewTypeIndex;
}else{switch($nViewTypeIndex){case CONST.VIEW_TYPE.LIST:$(this._jqBody[CONST.VIEW_TYPE.DETAIL]).hide();
$(this._jqBody[CONST.VIEW_TYPE.LIST]).show();
this._nViewTypeIndex=CONST.VIEW_TYPE.LIST;
this._excuteContentDetailWidget("hide");
this._excuteContentWidget("isDetailView",false);
this._excuteContentWidget("update");
break;
case CONST.VIEW_TYPE.DETAIL:$(this._jqBody[CONST.VIEW_TYPE.LIST]).hide();
$(this._jqBody[CONST.VIEW_TYPE.DETAIL]).show();
this._nViewTypeIndex=CONST.VIEW_TYPE.DETAIL;
this._excuteContentWidget("isDetailView",true);
this._excuteContentDetailWidget("resize",this._jqDetailView.width(),this._getContentsAreaHeight());
break;
}return this._nViewTypeIndex;
}},_setCategorySelector:function($bShowCategorySelector){if($bShowCategorySelector){this._jqCategorySelector.njSelectBox({options:undefined,onOptionSelect:$.proxy(function($e,$oData){},this),onOptionChange:$.proxy(function($e,$oData){this._sContext=$oData.selectedValue;
},this)});
this._sContext=this._jqCategorySelector.njSelectBox("getSelectedValues")["selectedValue"];
this._jqCategorySelector.njSelectBox("show");
}else{this._jqCategorySelector.hide();
if(this._jqCategorySelector.data("ui-njSelectBox")){this._jqCategorySelector.njSelectBox("hide");
this._jqCategorySelector.njSelectBox("destroy");
}}},_setTargetSelectorStyle:function($sTargetSelectorStyle){var sTargetSelectorStyle=$sTargetSelectorStyle&&$sTargetSelectorStyle.toUpperCase();
if(!CONST.TARGET_SELECTOR_STYLE[sTargetSelectorStyle]){return false;
}switch(CONST.TARGET_SELECTOR_STYLE[sTargetSelectorStyle]){case CONST.TARGET_SELECTOR_STYLE.NONE:this._jqTargetSelectorTab.hide();
this._jqTargetSelectorRadio.show();
$(this._jqTargetSelectorRadio.children()).hide();
break;
case CONST.TARGET_SELECTOR_STYLE.TAB:this._jqTargetSelectorTab.show();
this._jqTargetSelectorRadio.hide();
break;
case CONST.TARGET_SELECTOR_STYLE.RADIO:this._jqTargetSelectorTab.hide();
this._jqTargetSelectorRadio.show();
$(this._jqTargetSelectorRadio.children()).show();
break;
}return this._sTargetSelectorStyle=sTargetSelectorStyle;
},_setTargetSelectorItems:function($aTargetSelectorItems,$nSelectedItemIndex){this._jqTargetSelectorTab.empty();
this._jqTargetSelectorRadio.empty();
if(this._sTargetSelectorStyle==CONST.TARGET_SELECTOR_STYLE.NONE){return;
}$($aTargetSelectorItems).each($.proxy(function($nIndex,$oTargetSelectorItem){var oTargetSelectorItem=$.extend({},$oTargetSelectorItem,{index:$nIndex});
$.tmpl(TEMPLATE.TARGET_SELECTOR_TAB,oTargetSelectorItem).appendTo(this._jqTargetSelectorTab);
$.tmpl(TEMPLATE.TARGET_SELECTOR_RADIO,oTargetSelectorItem).appendTo(this._jqTargetSelectorRadio);
},this));
if($aTargetSelectorItems&&$aTargetSelectorItems.length){$nSelectedItemIndex=(0<=$nSelectedItemIndex&&$nSelectedItemIndex<$aTargetSelectorItems.length)?$nSelectedItemIndex:0;
this._jqTargetSelectorTab.delegate(SELECTOR.TARGET_SELECTOR_TAB_SELECTABLE,"click",$.proxy(function($e){$e.preventDefault();
var jqSelectedTab=$($e.target);
var sSelectedValue=jqSelectedTab.attr("value");
var nSelectedIndex=jqSelectedTab.parent().index();
this._changeTargetSelectorTab(nSelectedIndex);
this._changeTargetSelectorRadioButton(nSelectedIndex);
this._nSelectedTargetIndex=nSelectedIndex;
this._sContext=sSelectedValue;
this._poweredByContextView(this._sContext);
this._search();
},this));
this._changeTargetSelectorTab($nSelectedItemIndex);
this._jqTargetSelectorRadio.delegate(SELECTOR.TARGET_SELECTOR_RADIO_SELECTABLE,"click",$.proxy(function($e){var jqSelectedRadioButton=$($e.target);
var sSelectedValue=jqSelectedRadioButton.attr("value");
var nSelectedIndex=jqSelectedRadioButton.parent().index();
this._changeTargetSelectorTab(nSelectedIndex);
this._nSelectedTargetIndex=nSelectedIndex;
this._sContext=sSelectedValue;
this._poweredByContextView(this._sContext);
this._search();
},this));
this._changeTargetSelectorRadioButton($nSelectedItemIndex);
this._nSelectedTargetIndex=$nSelectedItemIndex;
this._sContext=$aTargetSelectorItems[$nSelectedItemIndex].value;
}},_changeTargetSelectorTab:function($nSelectedItemIndex){if(this._nSelectedTargetIndex!=undefined){var jqPrevItem=$(this._jqTargetSelectorTab.children()[this._nSelectedTargetIndex]);
jqPrevItem.children(SELECTOR.TARGET_SELECTOR_TAB_SELECTED).hide();
jqPrevItem.children(SELECTOR.TARGET_SELECTOR_TAB_SELECTABLE).show();
}var jqCurrentItem=$(this._jqTargetSelectorTab.children()[$nSelectedItemIndex]);
jqCurrentItem.children(SELECTOR.TARGET_SELECTOR_TAB_SELECTED).show();
jqCurrentItem.children(SELECTOR.TARGET_SELECTOR_TAB_SELECTABLE).hide();
},_changeTargetSelectorRadioButton:function($nSelectedItemIndex){var jqCurrentItem=$(this._jqTargetSelectorRadio.children()[$nSelectedItemIndex]);
jqCurrentItem.children(SELECTOR.TARGET_SELECTOR_RADIO_SELECTABLE).attr("checked","checked");
},_itemCounterSelected:function($nSelectedItemCount){if(!arguments.length){return this._nSelectedItemCount;
}else{($nSelectedItemCount?this._jqItemCounterSelected.addClass(CLASS.ITEM_COUNTER_SELECTED_EXIST):this._jqItemCounterSelected.removeClass(CLASS.ITEM_COUNTER_SELECTED_EXIST)).children().text($nSelectedItemCount);
return this._nSelectedItemCount=$nSelectedItemCount;
}},_itemCounterTotal:function($argument){if(!arguments.length){return this._nTotalItemCount;
}else{if(typeof $argument=="number"){this._jqItemCounterTotal.show();
this._jqItemCounterTotal.children(SELECTOR.ITEM_COUNTER_TOTAL_VALUE).text(this._nTotalItemCount=$argument);
}else{if($argument){this._jqItemCounterTotal.show();
}else{this._jqItemCounterTotal.hide();
}}}},_itemAdditionAvailableLength:function($nLength){if(!arguments.length){return this._nItemAdditionAvailableLength;
}else{if(typeof $nLength=="number"){this._nItemAdditionAvailableLength=$nLength;
}else{this._nItemAdditionAvailableLength=-1;
}}},_appendAlertWindowToCenter:function($jqAlertWindow){$jqAlertWindow.appendTo(this._jqSearchLayer).css("left",this._jqSearchLayer.outerWidth()/2-$jqAlertWindow.outerWidth()/2).css("top",this._jqSearchLayer.outerHeight()/2-$jqAlertWindow.outerHeight()/2);
return $jqAlertWindow;
},_removeAlertWindowFromCenter:function($jqAlertWindow){$jqAlertWindow.remove();
},_hasResultMore:function($flag){if($flag!==undefined){if($flag){this._changeMoreButtonToDefault();
this._jqMoreButton.show();
this._bHasResultMore=true;
}else{this._changeMoreButtonToDefault();
this._jqMoreButton.hide();
this._bHasResultMore=false;
}}return this._bHasResultMore;
},_changeMoreButtonToProgress:function(){this._jqMoreButtonDefault.hide();
this._jqMoreButtonProgress.show();
},_changeMoreButtonToDefault:function(){this._jqMoreButtonDefault.show();
this._jqMoreButtonProgress.hide();
},_noResultText:function($sQuery,$sTarget1,$sTarget2,$sCustomMessage){if($sQuery){var oNoResultText={target1:$sTarget1||TEXT.NO_RESULT_TEXT_DEFAULT_TARGET1,query:$sQuery,type:CONST.CONTENT_TYPE[this._sType].TITLE,target2:$sTarget2||TEXT.NO_RESULT_TEXT_DEFAULT_TARGET2,customMessage:$sCustomMessage};
this._jqNoResultText.append($.tmpl(TEMPLATE.NO_RESULT_TEXT,oNoResultText)).show();
}else{this._jqNoResultText.hide().empty();
}},_errorText:function($bShow){if($bShow){this._jqErrorText.show();
}else{this._jqErrorText.hide();
}},_poweredByContextView:function($sContext){var jqContainer=$(this._jqHeadArea[CONST.VIEW_TYPE.LIST]);
$(SELECTOR.POWERED_BY,jqContainer).remove();
var fnTemplate=TEMPLATE.POWERED_BY[$sContext];
if(fnTemplate){var sStaticServer=STATIC_SERVER||"http://static.naver.jp";
jqContainer.prepend($.tmpl(fnTemplate,{STATIC_SERVER:sStaticServer}));
}},getSearchQuery:function(){return this._sQuery;
}};
})("matome.mtmSearch"));
$.widget("ui.njSelectBox",(function(WIDGET_NAME){var EVENT={ON_OPTION_SELECT:"onOptionSelect",ON_OPTION_CHANGE:"onOptionChange"},CONST={OPTION_ATTRIBUTE_NAME:"njselectbox-value"},CLASS={OPTION:"njSelectBox-option"},TEMPLATE={OPTION:$.template(null,["<li ",CONST.OPTION_ATTRIBUTE_NAME,'="${value}">',"${label}","</li>"].join(""))};
var fn={getClassSelector:function($sClass){var aClasses=$.trim($sClass).split(" ");
var sClassSelector="";
for(var i=0,l=aClasses.length;
i<l;
i++){sClassSelector+=aClasses[i]?("."+aClasses[i]):"";
}return sClassSelector;
}};
return{options:{height:272,labelContainerClass:"njSelectBox-labelContainer",labelClass:"njSelectBox-label",openerClass:"njSelectBox-opener",optionContainerClass:"njSelectBox-optionContainer",optionClass:"",options:[],slideDuration:100,onOptionSelect:function(){},onOptionChange:function(){}},_create:function(){this._jqLabelContainer=$(fn.getClassSelector(this.options.labelContainerClass),this.element);
this._jqLabel=$(fn.getClassSelector(this.options.labelClass),this.element);
this._jqOpenerButton=$(fn.getClassSelector(this.options.openerClass),this.element);
this._jqOptionContainer=$(fn.getClassSelector(this.options.optionContainerClass),this.element);
this._jqOptions=this._initOptions(this.options.optionClass||undefined);
this._isOpened(false);
this._selectedValues(0);
this._initEvents();
this.height(this.options.height);
},_optionClass:function(){return this.options.optionClass||CLASS.OPTION;
},_initOptions:function($sOptionClass){if(!this._jqOptionContainer){return;
}this._jqOptionContainer.children($sOptionClass).each($.proxy(function($nIndex,$elOption){this._parseOption($nIndex,$($elOption));
},this));
var nOptionLength=this._jqOptionContainer.children().length;
for(var i=0,l=this.options.options.length;
i<l;
i++){var nIndex=nOptionLength+i;
var sLabel=this.options.options[i].label;
var sValue=this.options.options[i].value;
(sLabel!==undefined)&&(sValue!==undefined)&&this._appendOption(nIndex,sLabel,sValue);
}return this._jqOptionContainer.children();
},_parseOption:function($nIndex,$jqOption){var $sLabel=$jqOption.text();
var $sValue=$jqOption.attr(CONST.OPTION_ATTRIBUTE_NAME)||$sLabel;
if(!$sLabel||!$sValue){return;
}$jqOption.addClass(this._optionClass()).data("index",$nIndex).data("value",$sValue).data("label",$sLabel);
},_appendOption:function($nIndex,$sLabel,$sValue){this._aAppendedOptions=this._aAppendedOptions||[];
var jqNewOption=$.tmpl(TEMPLATE.OPTION,{value:$sValue,label:$sLabel}).addClass(this._optionClass()).data("index",$nIndex).data("value",$sValue).data("label",$sLabel).appendTo(this._jqOptionContainer);
this._aAppendedOptions.push(jqNewOption[0]);
return jqNewOption;
},_initEvents:function(){this._jqLabelContainer.mousedown($.proxy(function($e){$e.preventDefault();
this._toggleOptionContainer();
},this));
this._jqOptionContainer.delegate(fn.getClassSelector(this._optionClass()),"mouseup",$.proxy(function($e){this._select($($e.currentTarget));
this._isOpened(false);
},this));
},_onDocumentMouseDown:function($e){if(!this.element.has($e.target).length){this._isOpened(false);
}},_isOpened:function($bDoOpen){if(!arguments.length){return this._bIsOpened;
}else{if($bDoOpen){this.options.slideDuration?this._jqOptionContainer.slideDown(this.options.slideDuration):this._jqOptionContainer.show();
$(document).mousedown($.proxy(this._onDocumentMouseDown,this));
return this._bIsOpened=true;
}else{this.options.slideDuration?this._jqOptionContainer.slideUp(this.options.slideDuration):this._jqOptionContainer.hide();
$(document).unbind("mousedown",this._onDocumentMouseDown);
return this._bIsOpened=false;
}}},_toggleOptionContainer:function(){this._isOpened(!this._isOpened());
},_selectedValues:function($nSelectedIndex){if(!arguments.length){return{selectedIndex:this._nSelectedIndex,selectedValue:this._sSelectedValue,selectedLabel:this._sSelectedLabel};
}else{var jqSelectedOption=$(this._jqOptions[$nSelectedIndex]);
var selectedValues={selectedIndex:$nSelectedIndex,selectedValue:jqSelectedOption.data("value"),selectedLabel:jqSelectedOption.data("label")};
var nPrevIndex=((this._nSelectedIndex!==undefined)&&(this._nSelectedIndex!=$nSelectedIndex))?this._nSelectedIndex:-1;
if(nPrevIndex>=0){$.extend(selectedValues,{prevIndex:nPrevIndex,prevValue:$(this._jqOptions[nPrevIndex]).data("value"),prevLabel:$(this._jqOptions[nPrevIndex]).data("label")});
}this._nSelectedIndex=selectedValues.selectedIndex;
this._sSelectedValue=selectedValues.selectedValue;
this._sSelectedLabel=selectedValues.selectedLabel;
this._jqLabel.text(this._sSelectedLabel);
return selectedValues;
}},_select:function($oTriggered,$e){var nSelectedIndex;
var nSelectedValue;
var eTriggeredEvent=$e||null;
if($oTriggered.jquery){nSelectedIndex=$oTriggered.data("index");
nSelectedValue=$oTriggered.data("value");
}var oSelectedValues=this._selectedValues(nSelectedIndex);
this._triggerEvent(EVENT.ON_OPTION_SELECT,oSelectedValues,eTriggeredEvent);
(oSelectedValues.prevIndex!==undefined)&&this._triggerEvent(EVENT.ON_OPTION_CHANGE,oSelectedValues,eTriggeredEvent);
},_triggerEvent:function($sEventType,$oData,$eTriggeredEvent){this._trigger($sEventType,$eTriggeredEvent,$oData);
},height:function($nHeight){if($nHeight){this._jqOptionContainer.css({height:$nHeight,overflow:"auto"});
}else{this._jqOptionContainer.css({height:null,overflow:null});
}},getSelectedValues:function(){return this._selectedValues();
},show:function(){this.element.show();
},hide:function(){this._isOpened(false);
this.element.hide();
},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);
$(document).unbind("mousedown",this._onDocumentMouseDown);
this._aAppendedOptions&&$(this._aAppendedOptions).remove();
}};
})("ui.njSelectBox"));
})(jQuery);
(function($){nj.getPackage("nj.matome.mtmSearchAbstractDetail",(function(CLASS_NAME){var EVENT={ON_ITEM_SELECT:"onItemSelect",ON_PREV:"onPrev",ON_NEXT:"onNext"};
var CONST={KEY_CODE:{LEFT_ARROW:37,RIGHT_ARROW:39,ENTER:13}};
var SELECTOR={KEY_EVENT_TARGET:document,ADD_BUTTON_SELECTABLE:"A.MdBtn02MTM01",ADD_BUTTON_CHECKED:"SPAN.MdBtn02MTM02",CONTENT_DETAIL_VIEW:"DIV._jContentDetailView",CONTENT_CONTAINER:"DIV._jContentContainer",PREV_PAGE_BUTTON:"A.mdSearchView01PaginationPrev",NEXT_PAGE_BUTTON:"A.mdSearchView01PaginationNext"};
var CLASS={PAGE_BUTTON_CLICKED:"ExHover"};
var TEMPLATE={ALERT_ADDED:$.template(null,['<p class="MdLayerAlert01">追加しました</p>'].join(""))};
return{options:{alertDisplayDuration:2000,alertFadeOutDuration:200,contentMaxWidth:720,contentMaxHeight:700,onItemSelect:function(){},onPrev:function(){},onNext:function(){}},_create:function(){this._jqAddButtonSelectable=$(SELECTOR.ADD_BUTTON_SELECTABLE,this.element).click($.proxy(function($e){$e.preventDefault();
this._trigger(EVENT.ON_ITEM_SELECT,$e,{index:this._nCurrentIndex});
},this));
this._jqAddButtonChecked=$(SELECTOR.ADD_BUTTON_CHECKED,this.element);
this._jqPrevPageButton=$(SELECTOR.PREV_PAGE_BUTTON,this.element).click($.proxy(function($e){$e.preventDefault();
this._prev($e);
},this));
this._jqNextPageButton=$(SELECTOR.NEXT_PAGE_BUTTON,this.element).click($.proxy(function($e){$e.preventDefault();
this._next($e);
},this));
this._jqContentDetailView=$(SELECTOR.CONTENT_DETAIL_VIEW,this.element);
this._jqContentContainer=$(SELECTOR.CONTENT_CONTAINER,this.element);
},_setPageButton:function($nSelectedIndex,$nDataListLength,$bHasResultMore){if(!$nSelectedIndex){this._jqPrevPageButton.removeClass(CLASS.PAGE_BUTTON_CLICKED);
this._jqPrevPageButton.hide();
this._bIsFirstItem=true;
}else{this._jqPrevPageButton.show();
this._bIsFirstItem=false;
}if(!$bHasResultMore&&($nSelectedIndex>=$nDataListLength-1)){this._jqNextPageButton.removeClass(CLASS.PAGE_BUTTON_CLICKED);
this._jqNextPageButton.hide();
this._bIsLastItem=true;
}else{this._jqNextPageButton.show();
this._bIsLastItem=false;
}},_addButton:function($bIsAdded){if(!arguments.length){return this._bIsAdded;
}else{if($bIsAdded){this._jqAddButtonSelectable.hide();
this._jqAddButtonChecked.show();
this._bIsAdded=true;
}else{this._jqAddButtonSelectable.show();
this._jqAddButtonChecked.hide();
this._bIsAdded=false;
}}},_getScaledSize:function($oTargetSize,$oLimitSize,$bFitToLimitSize){var nRatio=Math.min($oLimitSize.width/$oTargetSize.width,$oLimitSize.height/$oTargetSize.height);
nRatio=$bFitToLimitSize?nRatio:Math.min(nRatio,1);
return{width:parseInt($oTargetSize.width*nRatio),height:parseInt($oTargetSize.height*nRatio)};
},_getCenteredPosition:function($oTargetSize,$oLimitSize){return{top:parseInt(($oTargetSize.height&&($oTargetSize.height<$oLimitSize.height))?($oLimitSize.height-$oTargetSize.height)/2:0),left:parseInt(($oTargetSize.width&&($oTargetSize.width<$oLimitSize.width))?($oLimitSize.width-$oTargetSize.width)/2:0)};
},_alertAdded:function($bShow){if($bShow!==undefined){if($bShow){this._jqAlertAdded=this._jqAlertAdded||$.tmpl(TEMPLATE.ALERT_ADDED);
this._jqContentContainer.after(this._jqAlertAdded);
this._jqAlertAdded.css({top:this._getCenteredPosition({width:this._jqAlertAdded.width(),height:this._jqAlertAdded.height()},this._oLimitSize).top,"margin-top":0});
this._jqAlertAdded.delay(this.options.alertDisplayDuration).fadeOut(this.options.alertFadeOutDuration,$.proxy(function(){this._jqAlertAdded.remove();
this._jqAlertAdded=null;
},this));
}else{this._jqAlertAdded&&this._jqAlertAdded.clearQueue("fx").stop().remove();
this._jqAlertAdded=null;
}}return this._jqAlertAdded;
},_setKeyShortcut:function($enable){if($enable){if(this._isKeyShortcutEnabled){return;
}$(SELECTOR.KEY_EVENT_TARGET).keydown($.proxy(this._onKeydown,this));
$(SELECTOR.KEY_EVENT_TARGET).keyup($.proxy(this._onKeyup,this));
this._isKeyShortcutEnabled=true;
}else{$(SELECTOR.KEY_EVENT_TARGET).unbind("keydown",this._onKeydown);
$(SELECTOR.KEY_EVENT_TARGET).unbind("keyup",this._onKeyup);
this._isKeyShortcutEnabled=false;
}},_isFocusOnInput:function($e){return($e.target.tagName=="INPUT");
},_onKeydown:function($e){if(this._isFocusOnInput($e)){return;
}var nKeyCode=$e.keyCode;
if(nKeyCode==CONST.KEY_CODE.LEFT_ARROW&&!this._bIsFirstItem){this._jqPrevPageButton.addClass(CLASS.PAGE_BUTTON_CLICKED);
}else{if(nKeyCode==CONST.KEY_CODE.RIGHT_ARROW&&!this._bIsLastItem){this._jqNextPageButton.addClass(CLASS.PAGE_BUTTON_CLICKED);
}}},_onKeyup:function($e){if(this._isFocusOnInput($e)){return;
}var nKeyCode=$e.keyCode;
if(nKeyCode==CONST.KEY_CODE.LEFT_ARROW&&!this._bIsFirstItem){this._jqPrevPageButton.removeClass(CLASS.PAGE_BUTTON_CLICKED);
this._jqPrevPageButton.click();
}else{if(nKeyCode==CONST.KEY_CODE.RIGHT_ARROW&&!this._bIsLastItem){this._jqNextPageButton.removeClass(CLASS.PAGE_BUTTON_CLICKED);
this._jqNextPageButton.click();
}else{if(nKeyCode==CONST.KEY_CODE.ENTER){if(this._addButton()){return;
}this._jqAddButtonSelectable.click();
}}}},_prev:function($e){this._trigger(EVENT.ON_PREV,$e,{index:this._nCurrentIndex});
},_next:function($e){this._trigger(EVENT.ON_NEXT,$e,{index:this._nCurrentIndex});
},resize:function($nWidth,$nHeight){this._oLimitSize={width:parseInt(Math.min(this.options.contentMaxWidth,$nWidth)),height:parseInt($nHeight)};
this._jqPrevPageButton.height(this._oLimitSize.height);
this._jqNextPageButton.height(this._oLimitSize.height);
this._jqContentDetailView.height(this._oLimitSize.height);
},show:function($oOptions){$oOptions=$.extend({},{index:undefined,data:undefined,listLength:undefined,hasResultMore:undefined,isAdded:undefined},$oOptions);
this._alertAdded()&&this._alertAdded(false);
this._nCurrentIndex=$oOptions.index;
this._setPageButton($oOptions.index,$oOptions.listLength,$oOptions.hasResultMore);
this._addButton($oOptions.isAdded);
this._setContent($oOptions.data);
this._setKeyShortcut(true);
},check:function($bIsDuplicated){this._addButton(true);
!$bIsDuplicated&&this._alertAdded(true);
},hide:function(){this._alertAdded()&&this._alertAdded(false);
this._nCurrentIndex=undefined;
this._bIsFirstItem=false;
this._bIsLastItem=false;
this._jqContent=null;
this._jqContentContainer.empty();
this._setKeyShortcut(false);
},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);
this.hide();
}};
})("nj.matome.mtmSearchAbstractDetail"));
$.widget("matome.mtmSearchImageDetail",(function(WIDGET_NAME,$super){var CONST={LOADING_IMAGE:{SRC:"matome_ver4/img/js/searchLayer_Loading.gif",WIDTH:24,HEIGHT:24}},CLASS={CONTENT_DETAIL_VIEW:"MdSearchView01",CONTENT_CONTAINER:"mdSearchView01Thumb"},TEMPLATE={IMAGE:"<img />"};
return $.extend(true,{},nj.matome.mtmSearchAbstractDetail,{_create:function(){$super._create.apply(this,arguments);
this._jqContentDetailView.addClass(CLASS.CONTENT_DETAIL_VIEW);
this._jqContentContainer.addClass(CLASS.CONTENT_CONTAINER);
},_loadImage:function($oOptions){$oOptions=$.extend({},{src:"",onSuccess:function(){},onError:function(){}},$oOptions);
if(!$oOptions.src){return;
}var fnSuccess=$oOptions.onSuccess;
var fnError=$oOptions.onError;
var jqImage=$(new Image());
var fnLastCallBacks=nj.matome.mtmSearcher.getLastCallbacks({onSuccess:function($e){fnSuccess&&fnSuccess.apply(null,[{element:jqImage[0],src:jqImage.attr("src"),width:jqImage.attr("width"),height:jqImage.attr("height")}]);
},onError:function($e){fnError&&fnError.apply(null,[{element:jqImage[0],src:jqImage.attr("src"),width:jqImage.attr("width"),height:jqImage.attr("height")}]);
}},this);
jqImage.load(fnLastCallBacks.onSuccess);
jqImage.error(fnLastCallBacks.onError);
jqImage.attr("src",this._oImageInfo.src);
},_setContent:function($oData){this._jqContent=this._jqContent||this._getContent();
this._onLoadingImage(true);
this._oImageInfo=$.extend(this._oImageInfo||{},{src:$oData.originalUrl,alt:$oData.originalTitle,width:$oData.width,height:$oData.height});
this._loadImage({src:this._oImageInfo.src,onSuccess:$.proxy(function($oImage){if(!this._oImageInfo){return;
}if(!this._oImageInfo.width||!this._oImageInfo.height){this._oImageInfo.width=$oImage.width;
this._oImageInfo.height=$oImage.height;
}this._onLoadingImage(false);
this._resizeImage();
this._jqContent.hide().load($.proxy(function($e){this._jqContent.show();
},this)).attr({src:this._oImageInfo.src,alt:this._oImageInfo.alt});
},this),onError:$.proxy(function($oImage){if(!this._oImageInfo){return;
}var oErrorImage=errorImage.get("default");
var nWidth=oErrorImage.w;
var nHeight=oErrorImage.h;
this._oImageInfo.width=nWidth;
this._oImageInfo.height=nHeight;
this._onLoadingImage(false);
this._resizeImage();
this._jqContent.attr({src:oErrorImage.src,width:nWidth,height:nHeight});
},this)});
},_onLoadingImage:function($bDoShow){if(!arguments.length){return this._oLoadingImageInfo;
}else{if($bDoShow){this._jqContent.attr({src:nj.getCombinedUrl(window.STATIC_SERVER,CONST.LOADING_IMAGE.SRC)});
this._oLoadingImageInfo={width:CONST.LOADING_IMAGE.WIDTH,height:CONST.LOADING_IMAGE.HEIGHT};
this._resizeImage();
}else{this._oLoadingImageInfo=null;
}}},_getContent:function(){return $(TEMPLATE.IMAGE).appendTo(this._jqContentContainer);
},_resizeImage:function(){if(!this._jqContent){return;
}var oScaledSize=this._getScaledSize(this._oLoadingImageInfo||{width:this._oImageInfo.width,height:this._oImageInfo.height},this._oLimitSize);
var nTop=this._getCenteredPosition(oScaledSize,this._oLimitSize).top;
this._jqContent.attr({width:oScaledSize.width,height:oScaledSize.height}).css({top:nTop});
},resize:function($nWidth,$nHeight){$super.resize.apply(this,arguments);
this._oImageInfo&&this._resizeImage();
},hide:function(){$super.hide.apply(this,arguments);
this._oImageInfo=null;
},destroy:function(){$super.destroy.apply(this,arguments);
this._jqContentDetailView.removeClass(CLASS.CONTENT_DETAIL_VIEW);
this._jqContentContainer.removeClass(CLASS.CONTENT_CONTAINER);
}});
})("matome.mtmSearchImageDetail",nj.matome.mtmSearchAbstractDetail));
$.widget("matome.mtmSearchVideoDetail",(function(WIDGET_NAME,$super){var CONST={NO_THUMB_WIDTH:120,NO_THUMB_HEIGHT:90},CLASS={CONTENT_DETAIL_VIEW:"MdSearchView02",CONTENT_CONTAINER_MOVIE:"mdSearchView02Thumb",CONTENT_CONTAINER_NO_MOVIE:"MdSearchNone01"},TEMPLATE={NO_MOVIE:$.template(null,['<div style="position:relative">','<div class="mdSearchNone01Thumb">','<img alt="" ','width="${width}" ','height="${height}" ','src="${thumbUrl}"',">","{{if playTime}}",'<span class="MdLayerVideoTime01">',"${playTime}","</span>","{{/if}}","</div>",'<p class="MdMarginTop12"><a class="MdLink04 MdColor06" target="_blank" href="${sourceUrl}" data-na="NL:url">${source}</a></p>','<p class="MdMarginTop12 MdColor03">こちらの動画はこのページ上では再生できません。<br>下記のリンクより動画を確認できます。</p>','<p class="MdMarginTop15"><a class="MdLink03 MdColor04" target="_blank" href="${originalUrl}" data-na="NL:url">動画を確認する</a></p>',"</div>"].join(""))};
return $.extend(true,{},nj.matome.mtmSearchAbstractDetail,{_create:function(){$super._create.apply(this,arguments);
this._jqContentDetailView.addClass(CLASS.CONTENT_DETAIL_VIEW);
},_getContent:function($oData){if(this._oVideoFilter){this._jqContentContainer.removeClass(CLASS.CONTENT_CONTAINER_NO_MOVIE);
this._jqContentContainer.addClass(CLASS.CONTENT_CONTAINER_MOVIE);
if(this._oVideoFilter.url.match("nicovideo.jp")){mFilter.setNico($oData.url,this._jqContentContainer,this._oVideoFilter.width,this._oVideoFilter.height,$.proxy(function($e){var jqNicoVideo=$(this._jqContentContainer.children()[0]);
if(jqNicoVideo.length){this._jqContent=jqNicoVideo.css({position:"relative"});
this._repositionVideo();
}},this));
return null;
}else{var jqObject=$(this._oVideoFilter.html).appendTo(this._jqContentContainer).css({position:"relative"});
var jqEmbed=$("EMBED",jqObject).css({position:"relative"});
if($.browser.msie){$.ui.njVideoFilter.prototype.checkVideoCleanUp(this._jqContentContainer);
}return $.browser.msie?jqObject:jqEmbed;
}}else{this._jqContentContainer.removeClass(CLASS.CONTENT_CONTAINER_MOVIE);
this._jqContentContainer.addClass(CLASS.CONTENT_CONTAINER_NO_MOVIE);
return $.tmpl(TEMPLATE.NO_MOVIE,$.extend({},$oData,{width:CONST.NO_THUMB_WIDTH,height:CONST.NO_THUMB_HEIGHT})).appendTo(this._jqContentContainer);
}},_setContent:function($oData){this._oVideoFilter=mFilter.html($oData.originalUrl);
this._jqContent&&this._jqContentContainer.empty();
this._jqContent=this._getContent($oData);
this._jqContent&&this._repositionVideo();
},_repositionVideo:function(){var oPosition=this._getCenteredPosition({width:this._jqContent.width(),height:this._jqContent.height()},this._oLimitSize);
this._jqContent.css({top:oPosition.top});
},resize:function($nWidth,$nHeight){$super.resize.apply(this,arguments);
this._jqContent&&this._repositionVideo();
},destroy:function(){$super.destroy.apply(this,arguments);
this._jqContentContainer.removeClass(CLASS.CONTENT_CONTAINER_MOVIE);
this._jqContentContainer.removeClass(CLASS.CONTENT_CONTAINER_NO_MOVIE);
this._jqContentDetailView.removeClass(CLASS.CONTENT_DETAIL_VIEW);
this._oVideoFilter=null;
}});
})("matome.mtmSearchVideoDetail",nj.matome.mtmSearchAbstractDetail));
})(jQuery);
(function($){nj.getPackage("nj.matome.mtmSearchItemParser",(function(OBJECT_NAME){return{getAddedItemsObject:function($sType,$aAddedItems){var fnGetItem=this[$sType&&$sType.toUpperCase()];
if(!fnGetItem||!$aAddedItems.length||!$.isArray($aAddedItems)){return null;
}var oAddedItemsObject=null,oItem,sKey;
for(var i=0,l=$aAddedItems.length;
i<l;
i++){((oItem=fnGetItem($aAddedItems[i]))&&(sKey=oItem.key))&&(!oAddedItemsObject||(oAddedItemsObject&&!oAddedItemsObject[sKey]))&&((oAddedItemsObject||(oAddedItemsObject={}))[sKey]=$.extend({},oItem.data));
}return oAddedItemsObject;
}};
})("nj.matome.mtmSearchItemParser"));
nj.getPackage("nj.matome.mtmSearchAbstractContents",(function(CLASS_NAME){var EVENT={ON_SEARCH_PROGRESS:"onSearchProgress",ON_SEARCH_COMPLETE:"onSearchComplete",ON_SEARCH_ERROR:"onSearchError",ON_SEARCH_RESULT_DATA:"onSearchResultData",ON_SEARCH_RESULT_OVERFLOW:"onSearchResultOverflow",ON_SEARCH_RESULT_END:"onSearchResultEnd",ON_SEARCH_NO_RESULT:"onSearchNoResult",ON_ITEM_SELECT:"onItemSelect",ON_ITEM_DETAIL_VIEW:"onItemDetailView"};
var SELECTOR={ADD_BUTTON_SELECTABLE:"A.mdBtn01MTM01Btn",ADD_BUTTON_CHECKED:"A.mdBtn01MTM02Btn",DETAIL_VIEW_BUTTON:"IMG._jSearchDetailView",SEARCHED_ITEM:"LI._jSearchedItem",ALERT_ADDED:"P.MdLayerAlert01"};
var CLASS={ADD_BUTTON_SELECTABLE:"mdBtn01MTM01Btn",ADD_BUTTON_CHECKED:"mdBtn01MTM02Btn",SPAN_SELECTABLE:"MdBtn01MTM01",SPAN_CHECKED:"MdBtn01MTM02"};
var TEXT={ADD_BUTTON_CHECKED:"このアイテムは追加済みです"};
var TEMPLATE={ALERT_ADDED:'<p class="MdLayerAlert01">追加しました</p>'};
return{options:{addedItems:{},alertDisplayDuration:2000,alertFadeOutDuration:200,maxItemCount:null,onSearchProgress:function(){},onSearchComplete:function(){},onSearchError:function(){},onSearchResultData:function(){},onSearchResultOverflow:function(){},onSearchResultEnd:function(){},onSearchNoResult:function(){},onItemSelect:function(){},onItemDetailView:function(){}},_create:function(){this.element.delegate(SELECTOR.ADD_BUTTON_SELECTABLE,"click",$.proxy(function($e){$e.preventDefault();
this.selectItem($($e.target).parents(SELECTOR.SEARCHED_ITEM).data("index"),$e);
},this)).delegate(SELECTOR.DETAIL_VIEW_BUTTON,"click",$.proxy(function($e){$e.preventDefault();
var jqItem=$($e.target).parents(SELECTOR.SEARCHED_ITEM);
this._trigger(EVENT.ON_ITEM_DETAIL_VIEW,$e,{index:jqItem.data("index"),key:jqItem.data("key")});
},this)).delegate(SELECTOR.ADD_BUTTON_CHECKED,"click",$.proxy(function($e){$e.preventDefault();
},this));
},_request:function($nPage,$fnAfterSearchResultData){this._trigger(EVENT.ON_SEARCH_PROGRESS,null,this._getRequestInfo());
nj.matome.mtmSearcher.request(this._getRequestOptions(this._sQuery,this._sContext,($nPage?$nPage:1),{onSuccess:$.proxy(function($oResponse){this._trigger(EVENT.ON_SEARCH_COMPLETE,null,this._getRequestInfo());
var aItemList=this._getItemList($oResponse);
var sSearchKeyword=this._getSearchKeyword($oResponse);
if(aItemList.length){var aParsedItemList=this._makeList(aItemList,sSearchKeyword);
this._isResultOverflow($oResponse)?((this._nPage<=1)&&this._trigger(EVENT.ON_SEARCH_RESULT_OVERFLOW)):this._trigger(EVENT.ON_SEARCH_RESULT_END);
this._trigger(EVENT.ON_SEARCH_RESULT_DATA,null,$.extend(this._getRequestInfo(),{dataList:aParsedItemList}));
$fnAfterSearchResultData&&$fnAfterSearchResultData.apply(null,[this._getRequestInfo()]);
}else{this._trigger(EVENT.ON_SEARCH_NO_RESULT,null,$.extend(this._getRequestInfo(),this._getAdditionalNoResultTextInfo()));
}},this),onError:$.proxy(function($oError){this._trigger(EVENT.ON_SEARCH_ERROR,null,this._getRequestInfo());
},this)}));
},_getRequestInfo:function(){return{query:this._sQuery,context:this._sContext,page:this._nPage};
},_getSearchKeyword:function($oResponse){return this._sQuery;
},_getAdditionalNoResultTextInfo:function(){return null;
},_makeList:function($aItemList,$sSearchKeyword){var aParsedItemList=[];
$($aItemList).each($.proxy(function($nIndex,$oItem){var oItemData=this._getParsedItemData($oItem,$sSearchKeyword);
var nItemIndex=this._nPage*this.options.itemsPerPage+$nIndex;
aParsedItemList.push(oItemData);
this._checkAddedItem($(this._getItemElement(oItemData,nItemIndex)).appendTo(this.element));
},this));
this._nPage++;
return aParsedItemList;
},_checkAddedItem:function($jqItem){var sKey=$jqItem.data("key");
var nIndex=$jqItem.data("index");
if(this.options.addedItems&&this.options.addedItems[sKey]){this.checkItem({index:nIndex},true);
return true;
}return false;
},_getParsedItemData:function($oItem,$sSearchKeyword){return $.extend(this._refineData($oItem,this._sContext),{searchKeyword:$sSearchKeyword});
},_refineData:function($oEntry){return $oEntry;
},search:function($sQuery,$sContext){this._sQuery=$sQuery;
this._sContext=$sContext;
this._request(this._nPage=0);
},searchMore:function($fnAfterSearchResultData){if(!this._sQuery){return false;
}this._request(this._nPage+1,$fnAfterSearchResultData);
},checkItem:function($oSelectedItem,$bIsDuplicated){var jqSelectedItem=$oSelectedItem.jquery?$oSelectedItem:(($oSelectedItem.index!==undefined)?$(this.element.children()[$oSelectedItem.index]):null);
if(!jqSelectedItem){return;
}var jqButton=$(SELECTOR.ADD_BUTTON_SELECTABLE,jqSelectedItem);
jqButton.removeClass(CLASS.ADD_BUTTON_SELECTABLE).addClass(CLASS.ADD_BUTTON_CHECKED).attr("title",TEXT.ADD_BUTTON_CHECKED).text(TEXT.ADD_BUTTON_CHECKED).parent().removeClass(CLASS.SPAN_SELECTABLE).addClass(CLASS.SPAN_CHECKED);
jqSelectedItem.addClass("ExSeleted");
!$bIsDuplicated&&jqSelectedItem.append($(TEMPLATE.ALERT_ADDED)).children(SELECTOR.ALERT_ADDED).delay(this.options.alertDisplayDuration).fadeOut(this.options.alertFadeOutDuration,function(){$(this).remove();
});
},selectItem:function($nIndex,$e){var jqSelectedItem=$(this.element.children()[$nIndex]);
var sKey=jqSelectedItem.data("key");
var oData=jqSelectedItem.data("data");
this._trigger(EVENT.ON_ITEM_SELECT,$e,{index:$nIndex,key:sKey,data:oData});
},getItemByIndex:function($nIndex){return $(this.element.children()[$nIndex]);
},getAdditionLimitMessage:function(){return null;
}};
})("nj.matome.mtmSearchAbstractContents"));
nj.getPackage("nj.matome.mtmSearchAbstractDefault",(function(CLASS_NAME,$super){var CONST={API_URL:{INTERNAL_SEARCH:"http://partner.api.naver.jp/search/1.0",EXTERNAL_SEARCH:nj.getCombinedUrl(nj.getBaseUrl(),"externalsearch")},TYPE:{INTERNAL_SEARCH:{IMAGE:"image",VIDEO:"video",LINK:"web"},EXTERNAL_SEARCH:{IMAGE:"image",VIDEO:"video",LINK:"url"}},TARGET:{INTERNAL_SEARCH:"naver"},JSONP_CALLBACK_NAME:"_callback"};
return $.extend(true,{},nj.matome.mtmSearchAbstractContents,{_getRequestOptions:function($sQuery,$sTarget,$nPage,$oCallbacks){var bIsInternalSearch=($sTarget==CONST.TARGET.INTERNAL_SEARCH);
var sUrl=bIsInternalSearch?nj.getCombinedUrl(CONST.API_URL.INTERNAL_SEARCH,CONST.TYPE.INTERNAL_SEARCH[this._sType]):CONST.API_URL.EXTERNAL_SEARCH;
var oRequestData={q:$sQuery,start:parseInt($nPage-1)*this.options.itemsPerPage+1,display:this.options.itemsPerPage,siteId:"p_matome",partnerId:"naver","$format":"json"};
if(!bIsInternalSearch){$.extend(oRequestData,{type:CONST.TYPE.EXTERNAL_SEARCH[this._sType],target:$sTarget});
}var oRequestOptions={requester:"ajax",url:sUrl,data:oRequestData,dataType:bIsInternalSearch?"jsonp":"json"};
if(oRequestOptions.dataType=="jsonp"){oRequestOptions.jsonp=CONST.JSONP_CALLBACK_NAME;
}return $.extend(oRequestOptions,{onSuccess:function($oResponse){$oCallbacks.onSuccess.apply(null,arguments);
},onError:function(){$oCallbacks.onError.apply(null,arguments);
}});
},_isResultOverflow:function($oResponse){var nTotal,nStart,nPerPage,nSum,nMax=this.option("maxItemCount");
if($oResponse.opensearch){nTotal=parseInt($oResponse.opensearch.totalResults);
nStart=parseInt($oResponse.opensearch.startIndex);
nPerPage=parseInt($oResponse.opensearch.itemsPerPage);
}else{nTotal=parseInt($oResponse["n$options"]["n$maxIndex"]["$t"]);
nStart=parseInt($oResponse["n$options"]["n$startIndex"]["$t"]);
nPerPage=parseInt($oResponse["n$options"]["n$itemsPerPage"]["$t"]);
}nSum=nStart+nPerPage;
if(nMax&&this._sContext==="naver"&&nSum>nMax){return false;
}return nTotal>nSum?true:false;
},_getItemList:function($oResponse){var a;
if($oResponse.d){a=$oResponse.d.results&&$oResponse.d.results.length?$oResponse.d.results:[];
}else{a=$oResponse.entry.length?$oResponse.entry:[];
}return a;
},_getSearchKeyword:function($oResponse){var s;
if($oResponse.opensearch){s=$oResponse.opensearch.searchTerms||this._sQuery;
}else{s=$oResponse["opensearch$Query"]["searchTerms"]||this._sQuery;
}return s;
},_getParsedItemData:function($oItem,$sSearchKeyword){return $.extend(this._refineData($oItem,this._sContext),{searchKeyword:$sSearchKeyword,collectionType:this._getCollectionType(this._sContext)});
},_checkThumbType:function(oEntry,sSize){var sUrl="";
var o=oEntry["n$image"]||oEntry.image;
if(typeof o!=="undefined"){var sThumb;
if(o instanceof Array&&o.length){o=o[0];
}if(o.n$thumbnail){sThumb=o["n$thumbnail"]["$t"];
}else{if(o.thumbnailUrlNew){sThumb=o.thumbnailUrlNew.replace(/(size=\d+x\d+)/,"size=150x0");
}else{sThumb=o.thumbnailUrl;
}}sThumb=sThumb||"";
if(/\?.*type=etc[123]/i.test(sThumb)){sUrl=sThumb.replace(/(\?.*)(type=etc[123])/i,"$1type=etc"+sSize);
}else{if(/.*\/r.[0-9]{2,3}x[0-9]{2,3}/i.test(sThumb)){sUrl=sThumb.replace(/(.*\/r.)([0-9]{2,3}x[0-9]{2,3})/i,"$1150x0");
}else{sUrl=sThumb.replace(/120\/120$/,"160/140");
sUrl=sThumb.replace(/(size=\d+x\d+)/,"size=150x0");
}}}return sUrl;
},_cutStr:function(sText,nSize){var oStr=nj.cutStr(sText,nSize,{jp:11,upper:8,lower:6,others:6,regTag:"b"});
return oStr.size>88?oStr.str+"...":oStr.str;
},selectItem:function($nIndex,$e){$super.selectItem.apply(this,arguments);
},checkItem:function($nIndex,$e){$super.checkItem.apply(this,arguments);
}});
})("nj.matome.mtmSearchAbstractDefault",nj.matome.mtmSearchAbstractContents));
nj.getPackage("nj.matome.mtmSearcher",(function(OBJECT_NAME){return{getLastCallbacks:function($oCallbacks,$oTarget){if((typeof $oCallbacks!=="function")&&(typeof $oCallbacks!=="object")&&($oCallbacks===undefined)){return null;
}$oTarget._nLastCallbackId=$.now();
var getCallback=function($fnCallback){var fnCallback=function(){if(fnCallback.id!=$oTarget._nLastCallbackId){return;
}$oTarget._nLastCallbackId=null;
delete $oTarget._nLastCallbackId;
$fnCallback&&$fnCallback.apply(null,arguments);
};
fnCallback.id=$oTarget._nLastCallbackId;
return fnCallback;
};
if(typeof $oCallbacks=="function"){return getCallback($oCallbacks);
}else{if(typeof $oCallbacks=="object"){var oCallbacks=null;
for(var s in $oCallbacks){if(typeof $oCallbacks[s]=="function"){oCallbacks=oCallbacks||{};
oCallbacks[s]=getCallback($oCallbacks[s]);
}}return oCallbacks;
}else{return null;
}}},ajax:function($oOptions,$fnSuccess,$fnError){var fnLastCallBacks=this.getLastCallbacks({success:function($oResponse){$fnSuccess.apply(null,arguments);
},error:function(){$fnError.apply(null,arguments);
}},this),o=$.extend($oOptions,{success:fnLastCallBacks.success,error:fnLastCallBacks.error});
if(o.dataType==="jsonp"&&$.jsonp){$.jsonp($.extend(o,{callback:"jQuery_jsonp_"+(+new Date),callbackParameter:o.jsonp||"callback",complete:$.noop}));
}else{$.ajax(o);
}},rest:function($sMethod,$oOptions,$fnSuccess,$fnError){if(!$sMethod){return;
}var fnLastCallBacks=this.getLastCallbacks({success:function($oResponse){$fnSuccess.apply(null,arguments);
},error:function(){$fnError.apply(null,arguments);
}},this);
$.rest($sMethod,$.extend($oOptions,{success:fnLastCallBacks.success,error:fnLastCallBacks.error}));
},request:function($oOptions){$oOptions=$.extend(true,{requester:"",method:"",dataType:"",url:"",data:null,onSuccess:function(){},onError:function(){}},$oOptions);
var sRequester=$oOptions.requester.toLowerCase();
if(typeof this[sRequester]!=="function"){return;
}var sUrl=$oOptions.url;
var oData=$oOptions.data;
var fnSuccess=$oOptions.onSuccess;
var fnError=$oOptions.onError;
if(!sUrl){return;
}var oRequestOptions={url:sUrl,data:oData};
switch(sRequester){case"ajax":var sDataType=$oOptions.dataType.toLowerCase();
oRequestOptions.dataType=sDataType;
if($oOptions.dataType=="jsonp"&&$oOptions.jsonp){oRequestOptions.jsonp=$oOptions.jsonp;
}this.ajax(oRequestOptions,fnSuccess,fnError);
break;
case"rest":var sMethod=$oOptions.method.toUpperCase();
oRequestOptions.data=oRequestOptions.data?$.toJSON(oRequestOptions.data):null;
this.rest(sMethod,oRequestOptions,fnSuccess,fnError);
break;
}}};
})("nj.matome.mtmSearcher"));
})(jQuery);
(function($){$.widget("matome.mtmSearchImage",(function(WIDGET_NAME,$super){var EVENT={ON_ITEM_SELECT:"onItemSelect"};
var CONST={TYPE:"IMAGE",COLLECTION_TYPE:{naver:"IMAGE",google:"GOOGLE_IMAGE",flickr:"FLICKR"},THUMBNAIL_WIDTH:150,MARGIN:10};
var CLASS={NOT_RENDERED_ITEM_CONTAINER:"_jNotRenderedElements"};
var TEMPLATE={NOT_RENDERED_ITEM_CONTAINER:"<ul class='_jNotRenderedElements' style='display:none;' />",ITEM:$.template(null,['<li class="_jSearchedItem">','<div class="mdSearchList01Thumb">','<img data-na="NC:detailView" ','class="_jSearchDetailView" onerror="errorImage(this, \'default\');" ','src="${thumbUrl}" ','width="${thumbWidth}" ','height="${thumbHeight}" ',">","</div>",'<p class="mdSearchList01BtnMTM"><span class="MdBtn01MTM01"><a title="追加" class="mdBtn01MTM01Btn" href="#" data-na="NC:addItem">追加</a></span></p>',"</li>"].join(""))};
return $.extend(true,{},nj.matome.mtmSearchAbstractDefault,{options:{itemsPerPage:50,maxItemCount:2000},_init:function(){this._sType=CONST.TYPE;
},_makeList:function($aItemList,$sSearchKeyword){if(!this._nPage){this._notRenderedElements(null);
}var aParsedItemList=[];
var aItemElements=[];
$($aItemList).each($.proxy(function($nIndex,$oItem){var oItemData=this._getParsedItemData($oItem,$sSearchKeyword);
var nItemIndex=this._nPage*this.options.itemsPerPage+$nIndex;
aParsedItemList.push(oItemData);
aItemElements.push(this._getItemElement(oItemData,nItemIndex));
},this));
this._nPage++;
this.isDetailView()?this._notRenderedElements(aItemElements):this._render(aItemElements);
return aParsedItemList;
},_notRenderedElements:function($aItemElements){if(!arguments.length){return this._jqNotRenderedElements&&this._jqNotRenderedElements.children();
}else{if($aItemElements&&$.isArray($aItemElements)){this._jqNotRenderedElements=this._jqNotRenderedElements||$(TEMPLATE.NOT_RENDERED_ITEM_CONTAINER).prependTo(this.element.parent());
return this._jqNotRenderedElements.append($aItemElements);
}else{this.element.parent().children(CLASS.NOT_RENDERED_ITEM_CONTAINER).empty().remove();
this._jqNotRenderedElements&&this._jqNotRenderedElements.empty().remove();
return this._jqNotRenderedElements=null;
}}},_render:function($aItemElements){this.element.append($aItemElements);
$($aItemElements).each($.proxy(function($nIndex,$oItem){this._checkAddedItem($($oItem));
},this));
if(this._nPage==1){this.element.masonry({columnWidth:CONST.THUMBNAIL_WIDTH+CONST.MARGIN,resizeable:false,itemSelector:"LI"});
}else{this.element.masonry("reload");
}},_refineData:function(oEntry,sTab){var oSize,oRefinedData;
if(oEntry["n$image"]){oSize=this._getSize({image:oEntry["n$image"],width:oEntry["n$image"]["n$source"]["width"],height:oEntry["n$image"]["n$source"]["height"]},sTab);
oRefinedData={thumbUrl:this._checkThumbType(oEntry,""),originalUrl:oEntry.link["$t"],originalTitle:oEntry["n$originalTitle"]["$t"],fileSize:oEntry["n$fileSize"]["$t"],imageResolution:oEntry["n$image"]["n$source"]["width"]+"x"+oEntry["n$image"]["n$source"]["height"],shortSourceUrl:this._cutStr(oEntry["n$pgroupUrl"]["$t"],143),source:oEntry["n$domainName"]["$t"],sourceUrl:oEntry["n$pgroupUrl"]["$t"],width:oSize.width,height:oSize.height,thumbWidth:oSize.thumbWidth,thumbHeight:oSize.thumbHeight};
}else{oSize=this._getSize({image:oEntry.image,width:oEntry.image.width,height:oEntry.image.height},sTab);
oRefinedData={thumbUrl:this._checkThumbType(oEntry,""),originalUrl:oEntry.url,originalTitle:oEntry.originalTitle,fileSize:oEntry.fileSize,imageResolution:oEntry.image.width+"x"+oEntry.image.height,shortSourceUrl:this._cutStr(oEntry.refererUrl,143),source:oEntry.domainName,sourceUrl:oEntry.refererUrl,width:oSize.width,height:oSize.height,thumbWidth:oSize.thumbWidth,thumbHeight:oSize.thumbHeight};
}return oRefinedData;
},_getItemElement:function($oItemData,$nItemIndex){var oTemplateData=$.extend({},$oItemData);
return $.tmpl(TEMPLATE.ITEM,oTemplateData).data("index",$nItemIndex).data("key",$oItemData.originalUrl).data("data",$oItemData)[0];
},_getCollectionType:function($sTarget){return CONST.COLLECTION_TYPE[$sTarget]||"";
},_getSize:function(oEntry,sTab){var outSize=(sTab=="flickr")?{width:150,height:115}:{width:150,height:0};
var oSize={};
if(oEntry.image instanceof Array){newSize=this._convertThumbnailSize(outSize.width,outSize.height,oEntry.width,oEntry.height);
oSize.width=parseInt(oEntry.width,10);
oSize.height=parseInt(oEntry.height,10);
oSize.thumbWidth=Math.floor(newSize.width);
oSize.thumbHeight=Math.floor(newSize.height);
}else{newSize=this._convertThumbnailSize(outSize.width,outSize.height,oEntry.width,oEntry.height);
oSize.width=parseInt(oEntry.width,10);
oSize.height=parseInt(oEntry.height,10);
oSize.thumbWidth=Math.floor(newSize.width);
oSize.thumbHeight=Math.floor(newSize.height);
}return oSize;
},_convertThumbnailSize:function(newWidth,newHeight,width,height){newWidth=parseInt(newWidth,10);
newHeight=parseInt(newHeight,10);
width=parseInt(width,10);
height=parseInt(height,10);
var retWidth=newWidth;
var retHeight=newHeight;
if(newHeight==0){retHeight=newWidth*height/width;
return{width:Math.floor(retWidth),height:Math.floor(retHeight)};
}if((width>newWidth)||(height>newHeight)){if(newWidth>newHeight){if(width==height){retWidth=newHeight;
}else{if(width>height){if(width>newWidth){var tempHeight=newWidth*height/width;
if(tempHeight>newHeight){retWidth=newHeight*width/height;
}else{retHeight=tempHeight;
}}else{if(height>newHeight){retWidth=newHeight*width/height;
}}}else{if(height>newHeight){var tempWidth=newHeight*width/height;
if(tempWidth>newWidth){retHeight=newWidth*height/width;
}else{retWidth=tempWidth;
}}else{if(width>newWidth){retHeight=newWidth*height/width;
}}}}}else{if(newWidth<newHeight){if(width==height){retHeight=newWidth;
}else{if(width>height){if(height>newHeight){var tempWidth=newHeight*width/height;
if(tempWidth>newWidth){retHeight=newWidth*height/width;
}else{retWidth=tempWidth;
}}else{if(width>newWidth){retHeight=newWidth*height/width;
}}}else{if(width>newWidth){var tempHeight=newWidth*height/width;
if(tempHeight>newHeight){retWidth=newHeight*width/height;
}else{retHeight=tempHeight;
}}else{if(height>newHeight){retWidth=newHeight*width/height;
}}}}}else{if(width>height){retHeight=newWidth*height/width;
}else{if(width<height){retWidth=newHeight*width/height;
}}}}}else{retWidth=(width==0)?newWidth:width;
retHeight=(height==0)?newHeight:height;
}return{width:Math.floor(retWidth),height:Math.floor(retHeight)};
},isDetailView:function($isDetailView){if(!arguments.length){return this._bIsDetailView;
}else{switch($isDetailView){case true:this._bIsDetailView=true;
break;
case false:this._bIsDetailView=false;
break;
}}},update:function(){if(this._notRenderedElements()){var aNotRenderedElements=this._notRenderedElements();
$(aNotRenderedElements).appendTo(this.element);
}this.element.masonry("reload");
},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);
this._notRenderedElements(null);
},selectItem:function($nIndex,$e){if(this.element.children()[$nIndex]){$super.selectItem.apply(this,arguments);
}else{var nIndex=$nIndex-this.element.children().length;
var jqSelectedItem=$(this._notRenderedElements()[nIndex]);
var sKey=jqSelectedItem.data("key");
var oData=jqSelectedItem.data("data");
this._trigger(EVENT.ON_ITEM_SELECT,$e,{index:$nIndex,key:sKey,data:oData});
}},checkItem:function($oSelectedItem,$bIsDuplicated){if(this.element.children()[$oSelectedItem.index]){$super.checkItem.apply(this,arguments);
}else{var nIndex=$oSelectedItem.index-this.element.children().length;
var jqSelectedItem=$(this._notRenderedElements()[nIndex]);
$super.checkItem.apply(this,[jqSelectedItem,false]);
}},getItemByIndex:function($nIndex){return $(this.element.children()[$nIndex]||this._notRenderedElements()[$nIndex-this.element.children().length]);
}});
})("matome.mtmSearchImage",nj.matome.mtmSearchAbstractDefault));
})(jQuery);
nj.common.setAPI({EXTERNAL_ID:"/api/${service}/id",EXTERNAL_REDIRECT_CONNECT:"/${service}/connect?redirect=${redirect}",EXTERNAL_DISCONNECT_AUTH:"/api/${service}/clear",EXTERNAL_CONNECT_USE:"/api/${service}/crawl/${use}",SNS_CONNECTIONS:"/api/social/status",USER_PROFILE:"/api/user/profile/all",IMPORT_BOOKMARK:"/api/bookmark/import"});
nj.common.message.add({PROFILE:{INTRODUCTION_OVERFLOW:"自己紹介文は${maxLength}文字以内で入力してください。",SITE_URL_INVALID:"運営サイトは正しいURLを入力してください。",SAVE_SUCCESS:"プロフィールの設定が完了しました",SAVE_FAIL:"一時的な問題により、アクセスできません。しばらくしてからもう一度お試しください。",CONFIRM_DELETE:"プロフィール画像を削除しますか？",CONFIRM_AUTH:"認証を解除します。よろしいですか？"},IMPORT:{ERROR_FORMAT:"「${name}」はインポート可能なファイル形式(RSS)ではない可能性があります。",ERROR_OVER_SIZE:"「${name}」はインポート可能な容量（約${size}）を超えています。"}});
(function(){var REDIRECT_URL,_ajax,_external;
REDIRECT_URL=encodeURIComponent(location.protocol+"//"+location.hostname+location.pathname);
nj.getPackage("nj.matome.profile.external",function(o){return _external.init(o);
});
_external={option:{},init:function(o){o=o||{};
$.extend(true,this.option,o);
this._$serviceButtons=$(".MdMPConnect01");
this._$serviceButtons.externalAuthButton({onAuth:$.proxy(this._auth,this),onRemoveAuth:$.proxy(this._removeAuth,this),onUse:$.proxy(this._use,this),onRemoveUse:$.proxy(this._removeUse,this)});
nj.matome.profile.adopt(this.option);
},_auth:function(sService,bRedirect){location.href=nj.common.getAPI("EXTERNAL_REDIRECT_CONNECT",{service:sService,redirect:REDIRECT_URL});
},_removeAuth:function(s){var _this=this;
_ajax.disConnectAuth(s).success(function(sResult){_this._successConnect({result:sResult==="Y"?"deauth":false,service:s});
}).error(this._errorConnect);
},_use:function(s){var _this=this;
_ajax.connectUse(s,"Y").success(function(sResult){_this._successConnect({result:sResult==="Y"?"use":false,service:s});
}).error(this._errorConnect);
},_removeUse:function(s){var _this=this;
_ajax.connectUse(s,"N").success(function(sResult){_this._successConnect({result:sResult==="Y"?"unuse":false,service:s});
}).error(this._errorConnect);
},_successConnect:function(o){var $button;
if(o.result){$button=this._$serviceButtons.filter("[data-service="+o.service+"]");
switch(o.result){case"deauth":$button.externalAuthButton("enableAuth");
break;
case"use":$button.externalAuthButton("disableUse");
break;
case"unuse":$button.externalAuthButton("enableUse");
break;
}}else{nj.common.message.alert("PROFILE.SAVE_FAIL");
}},_errorConnect:function(){nj.common.message.alert("PROFILE.SAVE_FAIL");
}};
_ajax=$.extend(new nj.matome.common.RequestClient,{disConnectAuth:function(s){return this.request({requester:"rest",url:nj.common.getAPI("EXTERNAL_DISCONNECT_AUTH",{service:s})});
},connectUse:function(sService,sUse){return this.request({requester:"rest",url:nj.common.getAPI("EXTERNAL_CONNECT_USE",{service:sService,use:sUse})});
}});
})();
(function(){$.widget("matome.externalAuthButton",{options:{service:"",onAuth:$.noop,onRemoveAuth:$.noop,onRemoveUse:$.noop,authButton:'<span class="MdMPBtn01P01 FnAuth"><a class="mdMPBtn01P01Btn">認証</a></span>',useButton:'<span class="MdMPBtn01P01 FnUseFav"><a class="mdMPBtn01P01Btn">お気に入りに登録</a></span>',usedButton:'<span class="MdMPBtn01P02 FnUnUseFav"><a class="mdMPBtn01P02Btn">お気に入りに登録済み</a></span>'},_create:function(){this.element.delegate(".FnAuth a,.FnAuth input","click",$.proxy(this._onAuth,this)).delegate(".FnDeAuth a,.FnDeAuth input","click",$.proxy(this._onRemoveAuth,this)).delegate(".FnUseFav a,.FnUseFav input","click",$.proxy(this._onUse,this)).delegate(".FnUnUseFav a,.FnUnUseFav input","click",$.proxy(this._onRemoveUse,this));
},_init:function(){this.option("service",this.element.data("service"));
this._isAuth=!!this.element.find(".mdMPConnect01Option01").length;
},enableAuth:function(){this.element.find(".FnDeAuth").replaceWith(this.option("authButton"));
this.removeInfo({ignoreClass:["FnAuth"]});
},enableUse:function(){this.element.find(".FnUnUseFav").replaceWith(this.option("useButton"));
},disableUse:function(){this.element.find(".FnUseFav").replaceWith(this.option("usedButton"));
},removeInfo:function(option){var $target;
$target=this.element.find(".MdMPBtn01P01,.MdMPBtn01P02,.mdMPConnect01Option01");
if(option&&option.ignoreClass){$target=$target.filter(function(){var s,_i,_len,_ref;
_ref=option.ignoreClass;
for(_i=0,_len=_ref.length;
_i<_len;
_i++){s=_ref[_i];
if($(this).hasClass(s)){return false;
}}return true;
});
}$target.remove();
},_onAuth:function(e){var options;
options=this.option();
e.preventDefault();
options.onAuth(options.service);
},_onRemoveAuth:function(e){var bConfirm,options;
options=this.option();
e.preventDefault();
bConfirm=nj.common.message.confirm("PROFILE.CONFIRM_AUTH");
if(bConfirm){options.onRemoveAuth(options.service);
}},_onUse:function(e){var options;
options=this.option();
e.preventDefault();
options.onUse(options.service);
},_onRemoveUse:function(e){var options;
options=this.option();
e.preventDefault();
options.onRemoveUse(options.service);
}});
})();
(function($){(function(){var SELECTOR={PROFILE_IMAGE:"#FnSettingUserImage",INTRODUCTION:"TEXTAREA.mdMypageSetting01Form01Input",INTRODUCTION_COUNT:"SPAN.mdMypageSetting01Form01CountNum",SITE_URL:"INPUT.mdMypageSetting01Form02Input",SAVE_BUTTON:"INPUT.mdMyBtn01Set01Btn"},API={REQUESTER:"rest",METHOD:"post",URL:nj.common.getAPI("USER_PROFILE")};
$.widget("nj.mtmMyProfile",$.nj.WidgetBase,(function(){function mtmMyProfile(){}mtmMyProfile.prototype={options:{introductionMaxLength:100,onSuccess:$.noop},_create:function(){this._jqElements(this.element,{profileImage:SELECTOR.PROFILE_IMAGE,introduction:SELECTOR.INTRODUCTION,introductionCount:SELECTOR.INTRODUCTION_COUNT,siteUrl:SELECTOR.SITE_URL,saveButton:SELECTOR.SAVE_BUTTON});
this._excuteWidget("profileImage","mtmMyProfileImageSelector");
this._excuteWidget("introduction","mtmInput",{maxLength:this.options.introductionMaxLength,onBlur:$.proxy(function(e,oData){this._setIntroductionCounter(oData.value);
},this),onInput:$.proxy(function(e,oData){this._setIntroductionCounter(oData.value);
},this)});
this._setIntroductionCounter(this._excuteWidget("introduction","mtmInput","value"));
this._excuteWidget("siteUrl","mtmInput");
this._jqElements("saveButton").click($.proxy(function(e){e.preventDefault();
this.save();
},this));
},_setIntroductionCounter:function(sValue){this._jqElements("introductionCount").text(sValue.length);
},_verifyIntroduction:function(){if(this._excuteWidget("introduction","mtmInput","verify").error){nj.common.message.alert("PROFILE.INTRODUCTION_OVERFLOW",{maxLength:this.options.introductionMaxLength});
return false;
}return true;
},_verifySite:function(){var sSite=this._excuteWidget("siteUrl","mtmInput","value");
if(sSite&&!fnMatome.validateURL(sSite)){nj.common.message.alert("PROFILE.SITE_URL_INVALID");
return false;
}return true;
},_verify:function(){if(!this._verifyIntroduction()){return false;
}if(!this._verifySite()){return false;
}return true;
},_saveProfile:function(oProfileInfo){var sImage=oProfileInfo.profileImageUrl,sIntro=oProfileInfo.introduction,sUrl=oProfileInfo.siteUrl,sDisplay=oProfileInfo.matomeListDisplay;
nj.matome.mtmAPIRequester.request({requester:API.REQUESTER,method:API.METHOD,url:API.URL,data:{image:sImage,intro:sIntro,url:sUrl,display:sDisplay},onSuccess:$.proxy(function(oResponse){var bIsError=oResponse.error;
if(!bIsError){this._onProfileSaveSuccess(oProfileInfo);
}else{this._onProfileSaveFail.apply(this,arguments);
}},this),onError:$.proxy(function(){this._onListLoadFail.apply(this,arguments);
},this)});
},_onProfileSaveSuccess:function(o){nj.common.message.alert("PROFILE.SAVE_SUCCESS");
this.option("onSuccess")(o);
},_onProfileSaveFail:function(){nj.common.message.alert("PROFILE.SAVE_FAIL");
},getProfileInfo:function(){var sProfileImageUrl=this._excuteWidget("profileImage","mtmMyProfileImageSelector","imageUrl"),sIntroduction=this._excuteWidget("introduction","mtmInput","value"),sSite=this._excuteWidget("siteUrl","mtmInput","value");
return{profileImageUrl:sProfileImageUrl,introduction:sIntroduction,siteUrl:sSite};
},save:function(){if(this._verify()){this._saveProfile(this.getProfileInfo());
}}};
return new mtmMyProfile;
})());
})();
$.widget("nj.mtmMyProfileImageSelector",$.nj.WidgetBase,(function(){var SELECTOR={IMAGE:".mdMypageSetting01ImgAreaThumbnail IMG",DELETE_BUTTON:".mdBtn01Del03Btn",UPLOAD_BUTTON:".mdMyBtn01Upload01Btn",SEARCH_BUTTON:".mdMyBtn01Search04Btn"};
return{_create:function(){var sImageUrl;
this._jqElements(this.element,{image:SELECTOR.IMAGE,uploadButton:SELECTOR.UPLOAD_BUTTON,searchButton:SELECTOR.SEARCH_BUTTON,deleteButton:SELECTOR.DELETE_BUTTON});
this._jqElements("image").attr({width:120,height:120}).error(function(){errorImage(this,"user120x120");
});
sImageUrl=this._jqElements("image").attr("data-profileImageUrl")||"";
this.imageUrl(sImageUrl);
this._jqElements("uploadButton").njUploader({mode:"crop",prevUpload:null,cropSize:"120x120",onUploadComplete:function(e,oRes){$(this).njUploader("option","prevUpload",oRes);
},submit:$.proxy(function(e,oRes){this._setImage(changeProxyImage(this.imageUrl(oRes.url),120));
this._jqElements("deleteButton").show();
$.modal.close();
},this)});
this._jqElements("searchButton").mtmSearch({modal:{opacity:80},onItemSelect:$.proxy(function(e,oData){var sOriginalUrl;
oData=oData.data,sOriginalUrl=oData.originalUrl;
if(sOriginalUrl&&$.isFunction(window.filterUrl)&&filterUrl(sOriginalUrl)){nj.common.message.alert("COMMON.COPYRIGHT_ERROR",{type:"画像"});
return;
}this._setImage(changeProxyImage(this.imageUrl(oData?oData.thumbUrl:""),120));
this._jqElements("searchButton").mtmSearch("close");
this._jqElements("deleteButton").show();
},this)}).click($.proxy(function(e){$.modal.close();
e.preventDefault();
this._jqElements("searchButton").mtmSearch("open",{type:"image",itemAdditionLimit:1});
},this));
this._jqElements("deleteButton").click($.proxy(function(e){e.preventDefault();
if(confirm(nj.common.message.get("PROFILE.CONFIRM_DELETE"))){this._setImage(this.imageUrl("")||errorImage.get("user120x120").src);
this._jqElements("deleteButton").hide();
}},this));
},_setImage:function(sUrl){if(/\/r\.\d+x\d+$/.test(sUrl)){sUrl=sUrl.replace(/^(.+)\/r\.(\d+x\d+)$/,"$1/c.$2");
}this._jqElements("image").attr("src",sUrl);
},imageUrl:function(sUrl){var aKeyAndValues=["imageUrl"];
if(arguments.length){aKeyAndValues=aKeyAndValues.concat([fnMatome.trim(String(sUrl),true)]);
}return this._data.apply(this,aKeyAndValues);
}};
})());
$.widget("nj.mtmInput",$.nj.WidgetBase,(function(){var EVENT={ON_FOCUS:"onFocus",ON_INPUT:"onInput",ON_BLUR:"onBlur"};
return{options:{autoTrim:false,required:false,minLength:0,maxLength:0,onBlur:$.noop,onInput:$.noop,onFocus:$.noop},_create:function(){if(this.options.maxLength&&this.element.is("INPUT")){this.element.attr("maxlength",this.options.maxLength);
}this._sValue(this.element.attr("autocomplete","off").val());
this.element.focus($.proxy(function(){this._data("isFocused",true);
this._trigger(EVENT.ON_FOCUS,null,{error:this.verify().error,value:this._sValue()});
setTimeout($.proxy(function(){if(this.element.njGetPlaceholderValue()){this.element.select();
}},this),0);
},this)).blur($.proxy(function(){this.element.njSetPlaceholderValue(this._sValue());
this._data("isFocused",false);
this._trigger(EVENT.ON_BLUR,null,{error:this.verify().error,value:this._sValue()});
},this)).watchinput({input:$.proxy(function(e,oData){if(this._data("isFocused")){var sValue=oData.value;
this._trigger(EVENT.ON_INPUT,null,{error:this.verify().error,value:sValue});
this._sValue(sValue);
}},this)}).njPlaceholder({autoTrim:this.options.autoTrim});
this.value(this._sValue());
},_sValue:function(sValue){var aKeyAndValues=["value"];
if(arguments.length){aKeyAndValues=aKeyAndValues.concat([this.options.autoTrim?fnMatome.trim(sValue,true):sValue]);
}return this._data.apply(this,aKeyAndValues);
},value:function(sValue){if(!arguments.length){return this._sValue();
}else{sValue=nj.cutString(this.options.autoTrim?fnMatome.trim(sValue,true):sValue,this.options.maxLength,"…");
if(!sValue){this.element.njSetPlaceholderValue(this._sValue(sValue));
this.element.triggerHandler("blur.njPlaceholder");
}else{this.element.triggerHandler("focus.njPlaceholder");
this.element.njSetPlaceholderValue(this._sValue(sValue));
}return sValue;
}},verify:function(){var sValue=this._sValue(),oError=null;
if(this.options.required&&!sValue){(oError||(oError={})).required=true;
}if(this.options.minLength&&sValue.length<this.options.minLength){(oError||(oError={})).minLength=this.options.minLength;
}if(this.options.maxLength&&sValue.length>this.options.maxLength){(oError||(oError={})).maxLength=this.options.maxLength;
}return{error:oError};
}};
})());
})(jQuery);
(function(){var templates={PROFILE_TEXT:'<p class="mdMySubProf01Txt"></p>',PROFILE_SITE:'<p class="mdMySubProf01Link"><a class="MdBtn02Site01" target="_blank" data-na="NL:homepage"><span class="mdBtn02Site01Ico"></span><span class="mdBtn02Site01Txt">運営サイト</span></a></p>'},NONE_IMAGE="/img/Gone";
nj.getPackage("nj.matome.profile.setting",{init:function(options){this._$sideProfileBase=$(".mdMySubProf01Unit01");
this._$sideThumbnail=this._$sideProfileBase.find(".mdThumb01Inner IMG");
this._$sideText=this._$sideProfileBase.find(".mdMySubProf01Txt");
this._$sideSite=this._$sideProfileBase.find(".mdMySubProf01Link");
$(".MdMypageSetting01 > FIELDSET").mtmMyProfile({onSuccess:$.proxy(this._getProfileData,this)});
},_getProfileData:function(){var that=this;
$.rest("GET",{url:nj.common.getAPI("USER_PROFILE"),success:function(oData){if(oData&&oData.result){that._setProfile(oData.result);
}}});
},_setProfile:function(oData){if(!oData.profileImageUrl){oData.profileImageUrl=NONE_IMAGE;
}if(!this._$sideText.length&&oData.profile){this._$sideText=$(templates.PROFILE_TEXT);
this._$sideProfileBase.append(this._$sideText);
}if(!this._$sideSite.length&&oData.homepageUrl){this._$sideSite=$(templates.PROFILE_SITE);
this._$sideProfileBase.append(this._$sideSite);
}else{if(!oData.homepageUrl){this._$sideSite.remove();
this._$sideSite=$([]);
}}this._$sideThumbnail.removeAttr("onerror").attr("src",oData.profileImageUrl).bind("error",function(){errorImage(this,"user120x120");
});
this._$sideText.html(oData.profile||"");
if(oData.homepageUrl){this._$sideSite.find("A").attr("href",oData.homepageUrl);
}$.njObserver.notify("matome.navigate.gnb.changeProfileImage",oData.profileSmallImageUrl);
}});
})();


/* @release 1380010682 */